<html>
<head>
<title>mask_test.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #808080;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
mask_test.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">collections </span><span class="s0">import </span><span class="s1">OrderedDict</span>
<span class="s0">import </span><span class="s1">random</span>
<span class="s0">import </span><span class="s1">unittest</span>

<span class="s0">import </span><span class="s1">pygame</span>
<span class="s0">import </span><span class="s1">pygame.mask</span>
<span class="s0">from </span><span class="s1">pygame.locals </span><span class="s0">import </span><span class="s1">*</span>


<span class="s0">def </span><span class="s1">random_mask(size = (</span><span class="s2">100</span><span class="s0">,</span><span class="s2">100</span><span class="s1">)):</span>
    <span class="s3">&quot;&quot;&quot;random_mask(size=(100,100)): return Mask 
    Create a mask of the given size, with roughly half the bits set at random.&quot;&quot;&quot;</span>
    <span class="s1">m = pygame.Mask(size)</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(size[</span><span class="s2">0</span><span class="s1">] * size[</span><span class="s2">1</span><span class="s1">] // </span><span class="s2">2</span><span class="s1">):</span>
        <span class="s1">x</span><span class="s0">, </span><span class="s1">y = random.randint(</span><span class="s2">0</span><span class="s0">,</span><span class="s1">size[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">random.randint(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">size[</span><span class="s2">1</span><span class="s1">] - </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((x</span><span class="s0">,</span><span class="s1">y))</span>
    <span class="s0">return </span><span class="s1">m</span>

<span class="s0">def </span><span class="s1">maskFromSurface(surface</span><span class="s0">, </span><span class="s1">threshold = </span><span class="s2">127</span><span class="s1">):</span>
    <span class="s1">mask = pygame.Mask(surface.get_size())</span>
    <span class="s1">key = surface.get_colorkey()</span>
    <span class="s0">if </span><span class="s1">key:</span>
        <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(surface.get_height()):</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(surface.get_width()):</span>
                <span class="s0">if </span><span class="s1">surface.get_at((x+</span><span class="s2">0.1</span><span class="s0">,</span><span class="s1">y+</span><span class="s2">0.1</span><span class="s1">)) != key:</span>
                    <span class="s1">mask.set_at((x</span><span class="s0">,</span><span class="s1">y)</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(surface.get_height()):</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range (surface.get_width()):</span>
                <span class="s0">if </span><span class="s1">surface.get_at((x</span><span class="s0">,</span><span class="s1">y))[</span><span class="s2">3</span><span class="s1">] &gt; threshold:</span>
                    <span class="s1">mask.set_at((x</span><span class="s0">,</span><span class="s1">y)</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s0">return </span><span class="s1">mask</span>


<span class="s0">class </span><span class="s1">MaskTypeTest(unittest.TestCase):</span>
    <span class="s1">ORIGIN_OFFSETS = ((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)</span><span class="s0">,</span>
                      <span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">_assertMaskEqual(self</span><span class="s0">, </span><span class="s1">m1</span><span class="s0">, </span><span class="s1">m2</span><span class="s0">, </span><span class="s1">msg=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s4"># Checks to see if the 2 given masks are equal.</span>
        <span class="s1">m1_count = m1.count()</span>

        <span class="s1">self.assertEqual(m1.get_size()</span><span class="s0">, </span><span class="s1">m2.get_size()</span><span class="s0">, </span><span class="s1">msg=msg)</span>
        <span class="s1">self.assertEqual(m1_count</span><span class="s0">, </span><span class="s1">m2.count()</span><span class="s0">, </span><span class="s1">msg=msg)</span>
        <span class="s1">self.assertEqual(m1_count</span><span class="s0">, </span><span class="s1">m1.overlap_area(m2</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span><span class="s0">, </span><span class="s1">msg=msg)</span>

        <span class="s4"># This can be used to help debug exact locations.</span>
        <span class="s4">##for i in range(m1.get_size()[0]):</span>
        <span class="s4">##    for j in range(m1.get_size()[1]):</span>
        <span class="s4">##        self.assertEqual(m1.get_at((i, j)), m2.get_at((i, j)))</span>

    <span class="s0">def </span><span class="s1">test_mask(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure masks are created correctly without fill parameter.&quot;&quot;&quot;</span>
        <span class="s1">expected_count = </span><span class="s2">0</span>
        <span class="s1">expected_size = (</span><span class="s2">11</span><span class="s0">, </span><span class="s2">23</span><span class="s1">)</span>
        <span class="s1">mask1 = pygame.mask.Mask(expected_size)</span>
        <span class="s1">mask2 = pygame.mask.Mask(size=expected_size)</span>

        <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

        <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_mask__negative_size(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure the mask constructor handles negative sizes correctly.&quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)):</span>
            <span class="s0">with </span><span class="s1">self.assertRaises(ValueError):</span>
                <span class="s1">mask = pygame.Mask(size)</span>

    <span class="s0">def </span><span class="s1">test_mask__fill_kwarg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure masks are created correctly using the fill keyword.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">37</span><span class="s0">, </span><span class="s2">47</span>
        <span class="s1">expected_size = (width</span><span class="s0">, </span><span class="s1">height)</span>
        <span class="s1">fill_counts = {</span><span class="s0">True </span><span class="s1">: width * height</span><span class="s0">, False </span><span class="s1">: </span><span class="s2">0 </span><span class="s1">}</span>

        <span class="s0">for </span><span class="s1">fill</span><span class="s0">, </span><span class="s1">expected_count </span><span class="s0">in </span><span class="s1">fill_counts.items():</span>
            <span class="s1">msg = </span><span class="s5">'fill={}'</span><span class="s1">.format(fill)</span>

            <span class="s1">mask = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=fill)</span>

            <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_mask__fill_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure masks are created correctly using a fill arg.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">59</span><span class="s0">, </span><span class="s2">71</span>
        <span class="s1">expected_size = (width</span><span class="s0">, </span><span class="s1">height)</span>
        <span class="s1">fill_counts = {</span><span class="s0">True </span><span class="s1">: width * height</span><span class="s0">, False </span><span class="s1">: </span><span class="s2">0 </span><span class="s1">}</span>

        <span class="s0">for </span><span class="s1">fill</span><span class="s0">, </span><span class="s1">expected_count </span><span class="s0">in </span><span class="s1">fill_counts.items():</span>
            <span class="s1">msg = </span><span class="s5">'fill={}'</span><span class="s1">.format(fill)</span>

            <span class="s1">mask = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill)</span>

            <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_mask__size_kwarg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure masks are created correctly using the size keyword.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">73</span><span class="s0">, </span><span class="s2">83</span>
        <span class="s1">expected_size = (width</span><span class="s0">, </span><span class="s1">height)</span>
        <span class="s1">fill_counts = {</span><span class="s0">True </span><span class="s1">: width * height</span><span class="s0">, False </span><span class="s1">: </span><span class="s2">0 </span><span class="s1">}</span>

        <span class="s0">for </span><span class="s1">fill</span><span class="s0">, </span><span class="s1">expected_count </span><span class="s0">in </span><span class="s1">fill_counts.items():</span>
            <span class="s1">msg = </span><span class="s5">'fill={}'</span><span class="s1">.format(fill)</span>

            <span class="s1">mask1 = pygame.mask.Mask(fill=fill</span><span class="s0">, </span><span class="s1">size=expected_size)</span>
            <span class="s1">mask2 = pygame.mask.Mask(size=expected_size</span><span class="s0">, </span><span class="s1">fill=fill)</span>

            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_get_size(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask's size is correctly retrieved.&quot;&quot;&quot;</span>
        <span class="s1">expected_size = (</span><span class="s2">93</span><span class="s0">, </span><span class="s2">101</span><span class="s1">)</span>
        <span class="s1">mask = pygame.mask.Mask(expected_size)</span>

        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_get_at(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure individual mask bits are correctly retrieved.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span>
        <span class="s1">mask0 = pygame.mask.Mask((width</span><span class="s0">, </span><span class="s1">height))</span>
        <span class="s1">mask1 = pygame.mask.Mask((width</span><span class="s0">, </span><span class="s1">height)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask0_expected_bit = </span><span class="s2">0</span>
        <span class="s1">mask1_expected_bit = </span><span class="s2">1</span>
        <span class="s1">pos = (width - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">height - </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s4"># Check twice to make sure bits aren't toggled.</span>
        <span class="s1">self.assertEqual(mask0.get_at(pos)</span><span class="s0">, </span><span class="s1">mask0_expected_bit)</span>
        <span class="s1">self.assertEqual(mask0.get_at(pos)</span><span class="s0">, </span><span class="s1">mask0_expected_bit)</span>
        <span class="s1">self.assertEqual(mask1.get_at(pos)</span><span class="s0">, </span><span class="s1">mask1_expected_bit)</span>
        <span class="s1">self.assertEqual(mask1.get_at(pos)</span><span class="s0">, </span><span class="s1">mask1_expected_bit)</span>

    <span class="s0">def </span><span class="s1">test_get_at__out_of_bounds(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure get_at() checks bounds.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">11</span><span class="s0">, </span><span class="s2">3</span>
        <span class="s1">mask = pygame.mask.Mask((width</span><span class="s0">, </span><span class="s1">height))</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
            <span class="s1">mask.get_at((width</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
            <span class="s1">mask.get_at((</span><span class="s2">0</span><span class="s0">, </span><span class="s1">height))</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
            <span class="s1">mask.get_at((-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
            <span class="s1">mask.get_at((</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_set_at(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure individual mask bits are set to 1.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">13</span><span class="s0">, </span><span class="s2">17</span>
        <span class="s1">mask0 = pygame.mask.Mask((width</span><span class="s0">, </span><span class="s1">height))</span>
        <span class="s1">mask1 = pygame.mask.Mask((width</span><span class="s0">, </span><span class="s1">height)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask0_expected_count = </span><span class="s2">1</span>
        <span class="s1">mask1_expected_count = mask1.count()</span>
        <span class="s1">expected_bit = </span><span class="s2">1</span>
        <span class="s1">pos = (width - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">height - </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">mask0.set_at(pos</span><span class="s0">, </span><span class="s1">expected_bit)  </span><span class="s4"># set 0 to 1</span>
        <span class="s1">mask1.set_at(pos</span><span class="s0">, </span><span class="s1">expected_bit)  </span><span class="s4"># set 1 to 1</span>

        <span class="s1">self.assertEqual(mask0.get_at(pos)</span><span class="s0">, </span><span class="s1">expected_bit)</span>
        <span class="s1">self.assertEqual(mask0.count()</span><span class="s0">, </span><span class="s1">mask0_expected_count)</span>
        <span class="s1">self.assertEqual(mask1.get_at(pos)</span><span class="s0">, </span><span class="s1">expected_bit)</span>
        <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_expected_count)</span>

    <span class="s0">def </span><span class="s1">test_set_at__to_0(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure individual mask bits are set to 0.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">11</span><span class="s0">, </span><span class="s2">7</span>
        <span class="s1">mask0 = pygame.mask.Mask((width</span><span class="s0">, </span><span class="s1">height))</span>
        <span class="s1">mask1 = pygame.mask.Mask((width</span><span class="s0">, </span><span class="s1">height)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask0_expected_count = </span><span class="s2">0</span>
        <span class="s1">mask1_expected_count = mask1.count() - </span><span class="s2">1</span>
        <span class="s1">expected_bit = </span><span class="s2">0</span>
        <span class="s1">pos = (width - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">height - </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">mask0.set_at(pos</span><span class="s0">, </span><span class="s1">expected_bit)  </span><span class="s4"># set 0 to 0</span>
        <span class="s1">mask1.set_at(pos</span><span class="s0">, </span><span class="s1">expected_bit)  </span><span class="s4"># set 1 to 0</span>

        <span class="s1">self.assertEqual(mask0.get_at(pos)</span><span class="s0">, </span><span class="s1">expected_bit)</span>
        <span class="s1">self.assertEqual(mask0.count()</span><span class="s0">, </span><span class="s1">mask0_expected_count)</span>
        <span class="s1">self.assertEqual(mask1.get_at(pos)</span><span class="s0">, </span><span class="s1">expected_bit)</span>
        <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_expected_count)</span>

    <span class="s0">def </span><span class="s1">test_set_at__default_value(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure individual mask bits are set using the default value.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">3</span><span class="s0">, </span><span class="s2">21</span>
        <span class="s1">mask0 = pygame.mask.Mask((width</span><span class="s0">, </span><span class="s1">height))</span>
        <span class="s1">mask1 = pygame.mask.Mask((width</span><span class="s0">, </span><span class="s1">height)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask0_expected_count = </span><span class="s2">1</span>
        <span class="s1">mask1_expected_count = mask1.count()</span>
        <span class="s1">expected_bit = </span><span class="s2">1</span>
        <span class="s1">pos = (width - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">height - </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">mask0.set_at(pos)  </span><span class="s4"># set 0 to 1</span>
        <span class="s1">mask1.set_at(pos)  </span><span class="s4"># set 1 to 1</span>

        <span class="s1">self.assertEqual(mask0.get_at(pos)</span><span class="s0">, </span><span class="s1">expected_bit)</span>
        <span class="s1">self.assertEqual(mask0.count()</span><span class="s0">, </span><span class="s1">mask0_expected_count)</span>
        <span class="s1">self.assertEqual(mask1.get_at(pos)</span><span class="s0">, </span><span class="s1">expected_bit)</span>
        <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_expected_count)</span>

    <span class="s0">def </span><span class="s1">test_set_at__out_of_bounds(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure set_at() checks bounds.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">11</span><span class="s0">, </span><span class="s2">3</span>
        <span class="s1">mask = pygame.mask.Mask((width</span><span class="s0">, </span><span class="s1">height))</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
            <span class="s1">mask.set_at((width</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
            <span class="s1">mask.set_at((</span><span class="s2">0</span><span class="s0">, </span><span class="s1">height))</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
            <span class="s1">mask.set_at((-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
            <span class="s1">mask.set_at((</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_overlap(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure the overlap intersection is correctly calculated. 
 
        Testing the different combinations of full/empty masks: 
            (mask1-filled) 1 overlap 1 (mask2-filled) 
            (mask1-empty)  0 overlap 1 (mask2-filled) 
            (mask1-filled) 1 overlap 0 (mask2-empty) 
            (mask1-empty)  0 overlap 0 (mask2-empty) 
        &quot;&quot;&quot;</span>
        <span class="s1">expected_size = (</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">expected_default = </span><span class="s0">None</span>
        <span class="s1">expected_overlaps = {(</span><span class="s0">True, True</span><span class="s1">) : offset}</span>

        <span class="s0">for </span><span class="s1">fill2 </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
            <span class="s1">mask2 = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=fill2)</span>
            <span class="s1">mask2_count = mask2.count()</span>

            <span class="s0">for </span><span class="s1">fill1 </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
                <span class="s1">key = (fill1</span><span class="s0">, </span><span class="s1">fill2)</span>
                <span class="s1">msg = </span><span class="s5">'key={}'</span><span class="s1">.format(key)</span>
                <span class="s1">mask1 = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=fill1)</span>
                <span class="s1">mask1_count = mask1.count()</span>
                <span class="s1">expected_pos = expected_overlaps.get(key</span><span class="s0">, </span><span class="s1">expected_default)</span>

                <span class="s1">overlap_pos = mask1.overlap(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

                <span class="s1">self.assertEqual(overlap_pos</span><span class="s0">, </span><span class="s1">expected_pos</span><span class="s0">, </span><span class="s1">msg)</span>

                <span class="s4"># Ensure mask1/mask2 unchanged.</span>
                <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_overlap__offset(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure an offset overlap intersection is correctly calculated.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">65</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">66</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask1_count = mask1.count()</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">self.ORIGIN_OFFSETS:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>
            <span class="s1">expected_pos = (max(offset[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">max(offset[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

            <span class="s1">overlap_pos = mask1.overlap(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s1">self.assertEqual(overlap_pos</span><span class="s0">, </span><span class="s1">expected_pos</span><span class="s0">, </span><span class="s1">msg)</span>

            <span class="s4"># Ensure mask1/mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_overlap__offset_with_unset_bits(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure an offset overlap intersection is correctly calculated 
        when (0, 0) bits not set.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">65</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">66</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">unset_pos = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">mask1.set_at(unset_pos</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">mask2.set_at(unset_pos</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">mask1_count = mask1.count()</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">self.ORIGIN_OFFSETS:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>
            <span class="s1">x</span><span class="s0">, </span><span class="s1">y = offset</span>
            <span class="s1">expected_y = max(y</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s2">0 </span><span class="s1">== y:</span>
                <span class="s1">expected_x = max(x + </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
            <span class="s0">elif </span><span class="s2">0 </span><span class="s1">&lt; y:</span>
                <span class="s1">expected_x = max(x + </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">expected_x = max(x</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

            <span class="s1">overlap_pos = mask1.overlap(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s1">self.assertEqual(overlap_pos</span><span class="s0">, </span><span class="s1">(expected_x</span><span class="s0">, </span><span class="s1">expected_y)</span><span class="s0">, </span><span class="s1">msg)</span>

            <span class="s4"># Ensure mask1/mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_at(unset_pos)</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_at(unset_pos)</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_overlap__no_overlap(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure an offset overlap intersection is correctly calculated 
        when there is no overlap.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">65</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask1_count = mask1.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>

        <span class="s1">mask2_w</span><span class="s0">, </span><span class="s1">mask2_h = </span><span class="s2">67</span><span class="s0">, </span><span class="s2">5</span>
        <span class="s1">mask2_size = (mask2_w</span><span class="s0">, </span><span class="s1">mask2_h)</span>
        <span class="s1">mask2 = pygame.mask.Mask(mask2_size)</span>
        <span class="s1">set_pos = (mask2_w - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">mask2_h - </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">mask2.set_at(set_pos)</span>
        <span class="s1">mask2_count = </span><span class="s2">1</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">self.ORIGIN_OFFSETS:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>

            <span class="s1">overlap_pos = mask1.overlap(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s1">self.assertIsNone(overlap_pos</span><span class="s0">, </span><span class="s1">msg)</span>

            <span class="s4"># Ensure mask1/mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_at(set_pos)</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_overlap__offset_boundary(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures overlap handles offsets and boundaries correctly.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">13</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">7</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask1_count = mask1.count()</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>

        <span class="s4"># Check the 4 boundaries.</span>
        <span class="s1">offsets = ((mask1_size[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,   </span><span class="s4"># off right</span>
                   <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">mask1_size[</span><span class="s2">1</span><span class="s1">])</span><span class="s0">,   </span><span class="s4"># off bottom</span>
                   <span class="s1">(-mask2_size[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># off left</span>
                   <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-mask2_size[</span><span class="s2">1</span><span class="s1">]))  </span><span class="s4"># off top</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">offsets:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>

            <span class="s1">overlap_pos = mask1.overlap(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s1">self.assertIsNone(overlap_pos</span><span class="s0">, </span><span class="s1">msg)</span>

            <span class="s4"># Ensure mask1/mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_overlap__invalid_mask_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure overlap handles invalid mask arguments correctly.&quot;&quot;&quot;</span>
        <span class="s1">size = (</span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">mask = pygame.mask.Mask(size)</span>
        <span class="s1">invalid_mask = pygame.Surface(size)</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">overlap_pos = mask.overlap(invalid_mask</span><span class="s0">, </span><span class="s1">offset)</span>

    <span class="s0">def </span><span class="s1">test_overlap__invalid_offset_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure overlap handles invalid offset arguments correctly.&quot;&quot;&quot;</span>
        <span class="s1">size = (</span><span class="s2">2</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span>
        <span class="s1">offset = </span><span class="s5">'(0, 0)'</span>
        <span class="s1">mask1 = pygame.mask.Mask(size)</span>
        <span class="s1">mask2 = pygame.mask.Mask(size)</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">overlap_pos = mask1.overlap(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

    <span class="s0">def </span><span class="s1">test_overlap_area(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure the overlap_area is correctly calculated. 
 
        Testing the different combinations of full/empty masks: 
            (mask1-filled) 1 overlap_area 1 (mask2-filled) 
            (mask1-empty)  0 overlap_area 1 (mask2-filled) 
            (mask1-filled) 1 overlap_area 0 (mask2-empty) 
            (mask1-empty)  0 overlap_area 0 (mask2-empty) 
        &quot;&quot;&quot;</span>
        <span class="s1">expected_size = width</span><span class="s0">, </span><span class="s1">height = (</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">expected_default = </span><span class="s2">0</span>
        <span class="s1">expected_counts = {(</span><span class="s0">True, True</span><span class="s1">) : width * height}</span>

        <span class="s0">for </span><span class="s1">fill2 </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
            <span class="s1">mask2 = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=fill2)</span>
            <span class="s1">mask2_count = mask2.count()</span>

            <span class="s0">for </span><span class="s1">fill1 </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
                <span class="s1">key = (fill1</span><span class="s0">, </span><span class="s1">fill2)</span>
                <span class="s1">msg = </span><span class="s5">'key={}'</span><span class="s1">.format(key)</span>
                <span class="s1">mask1 = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=fill1)</span>
                <span class="s1">mask1_count = mask1.count()</span>
                <span class="s1">expected_count = expected_counts.get(key</span><span class="s0">, </span><span class="s1">expected_default)</span>

                <span class="s1">overlap_count = mask1.overlap_area(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

                <span class="s1">self.assertEqual(overlap_count</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>

                <span class="s4"># Ensure mask1/mask2 unchanged.</span>
                <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_overlap_area__offset(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure an offset overlap_area is correctly calculated.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">65</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">66</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask1_count = mask1.count()</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>

        <span class="s4"># Using rects to help determine the overlapping area.</span>
        <span class="s1">rect1 = pygame.Rect((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mask1_size)</span>
        <span class="s1">rect2 = pygame.Rect((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mask2_size)</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">self.ORIGIN_OFFSETS:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>
            <span class="s1">rect2.topleft = offset</span>
            <span class="s1">overlap_rect = rect1.clip(rect2)</span>
            <span class="s1">expected_count = overlap_rect.w * overlap_rect.h</span>

            <span class="s1">overlap_count = mask1.overlap_area(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s1">self.assertEqual(overlap_count</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>

            <span class="s4"># Ensure mask1/mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_overlap_area__offset_boundary(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures overlap_area handles offsets and boundaries correctly.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">11</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask1_count = mask1.count()</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>
        <span class="s1">expected_count = </span><span class="s2">0</span>

        <span class="s4"># Check the 4 boundaries.</span>
        <span class="s1">offsets = ((mask1_size[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,   </span><span class="s4"># off right</span>
                   <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">mask1_size[</span><span class="s2">1</span><span class="s1">])</span><span class="s0">,   </span><span class="s4"># off bottom</span>
                   <span class="s1">(-mask2_size[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># off left</span>
                   <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-mask2_size[</span><span class="s2">1</span><span class="s1">]))  </span><span class="s4"># off top</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">offsets:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>

            <span class="s1">overlap_count = mask1.overlap_area(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s1">self.assertEqual(overlap_count</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>

            <span class="s4"># Ensure mask1/mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_overlap_area__invalid_mask_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure overlap_area handles invalid mask arguments correctly.&quot;&quot;&quot;</span>
        <span class="s1">size = (</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">mask = pygame.mask.Mask(size)</span>
        <span class="s1">invalid_mask = pygame.Surface(size)</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">overlap_count = mask.overlap_area(invalid_mask</span><span class="s0">, </span><span class="s1">offset)</span>

    <span class="s0">def </span><span class="s1">test_overlap_area__invalid_offset_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure overlap_area handles invalid offset arguments correctly.&quot;&quot;&quot;</span>
        <span class="s1">size = (</span><span class="s2">7</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">offset = </span><span class="s5">'(0, 0)'</span>
        <span class="s1">mask1 = pygame.mask.Mask(size)</span>
        <span class="s1">mask2 = pygame.mask.Mask(size)</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">overlap_count = mask1.overlap_area(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

    <span class="s0">def </span><span class="s1">test_overlap_mask(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure overlap_mask's mask has correct bits set. 
 
        Testing the different combinations of full/empty masks: 
            (mask1-filled) 1 overlap_mask 1 (mask2-filled) 
            (mask1-empty)  0 overlap_mask 1 (mask2-filled) 
            (mask1-filled) 1 overlap_mask 0 (mask2-empty) 
            (mask1-empty)  0 overlap_mask 0 (mask2-empty) 
        &quot;&quot;&quot;</span>
        <span class="s1">expected_size = (</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">expected_default = pygame.mask.Mask(expected_size)</span>
        <span class="s1">expected_masks = {</span>
            <span class="s1">(</span><span class="s0">True, True</span><span class="s1">) : pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)}</span>

        <span class="s0">for </span><span class="s1">fill2 </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
            <span class="s1">mask2 = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=fill2)</span>
            <span class="s1">mask2_count = mask2.count()</span>

            <span class="s0">for </span><span class="s1">fill1 </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
                <span class="s1">key = (fill1</span><span class="s0">, </span><span class="s1">fill2)</span>
                <span class="s1">msg = </span><span class="s5">'key={}'</span><span class="s1">.format(key)</span>
                <span class="s1">mask1 = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=fill1)</span>
                <span class="s1">mask1_count = mask1.count()</span>
                <span class="s1">expected_mask = expected_masks.get(key</span><span class="s0">, </span><span class="s1">expected_default)</span>

                <span class="s1">overlap_mask = mask1.overlap_mask(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

                <span class="s1">self._assertMaskEqual(overlap_mask</span><span class="s0">, </span><span class="s1">expected_mask</span><span class="s0">, </span><span class="s1">msg)</span>

                <span class="s4"># Ensure mask1/mask2 unchanged.</span>
                <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_overlap_mask__bits_set(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure overlap_mask's mask has correct bits set.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">50</span><span class="s0">, </span><span class="s2">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">300</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask1_count = mask1.count()</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>

        <span class="s1">mask3 = mask1.overlap_mask(mask2</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">50</span><span class="s1">):</span>
            <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">10</span><span class="s1">):</span>
                <span class="s1">self.assertEqual(mask3.get_at((i</span><span class="s0">, </span><span class="s1">j))</span><span class="s0">, </span><span class="s2">1</span><span class="s0">,</span>
                                 <span class="s5">'({}, {})'</span><span class="s1">.format(i</span><span class="s0">, </span><span class="s1">j))</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">50</span><span class="s1">):</span>
            <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">11</span><span class="s0">, </span><span class="s2">50</span><span class="s1">):</span>
                <span class="s1">self.assertEqual(mask3.get_at((i</span><span class="s0">, </span><span class="s1">j))</span><span class="s0">, </span><span class="s2">0</span><span class="s0">,</span>
                                 <span class="s5">'({}, {})'</span><span class="s1">.format(i</span><span class="s0">, </span><span class="s1">j))</span>

        <span class="s4"># Ensure mask1/mask2 unchanged.</span>
        <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count)</span>
        <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count)</span>
        <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size)</span>
        <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size)</span>

    <span class="s0">def </span><span class="s1">test_overlap_mask__offset(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure an offset overlap_mask's mask is correctly calculated.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">65</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">66</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask1_count = mask1.count()</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">expected_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>

        <span class="s4"># Using rects to help determine the overlapping area.</span>
        <span class="s1">rect1 = pygame.Rect((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected_size)</span>
        <span class="s1">rect2 = pygame.Rect((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mask2_size)</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">self.ORIGIN_OFFSETS:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>
            <span class="s1">rect2.topleft = offset</span>
            <span class="s1">overlap_rect = rect1.clip(rect2)</span>
            <span class="s1">expected_count = overlap_rect.w * overlap_rect.h</span>

            <span class="s1">overlap_mask = mask1.overlap_mask(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s1">self.assertEqual(overlap_mask.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(overlap_mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>

            <span class="s4"># Ensure mask1/mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_overlap_mask__offset_boundary(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures overlap_mask handles offsets and boundaries correctly.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">11</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask1_count = mask1.count()</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>
        <span class="s1">expected_count = </span><span class="s2">0</span>
        <span class="s1">expected_size = mask1_size</span>

        <span class="s4"># Check the 4 boundaries.</span>
        <span class="s1">offsets = ((mask1_size[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,   </span><span class="s4"># off right</span>
                   <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">mask1_size[</span><span class="s2">1</span><span class="s1">])</span><span class="s0">,   </span><span class="s4"># off bottom</span>
                   <span class="s1">(-mask2_size[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># off left</span>
                   <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-mask2_size[</span><span class="s2">1</span><span class="s1">]))  </span><span class="s4"># off top</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">offsets:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>

            <span class="s1">overlap_mask = mask1.overlap_mask(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s1">self.assertEqual(overlap_mask.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(overlap_mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>

            <span class="s4"># Ensure mask1/mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_overlap_mask__invalid_mask_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure overlap_mask handles invalid mask arguments correctly.&quot;&quot;&quot;</span>
        <span class="s1">size = (</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">mask = pygame.mask.Mask(size)</span>
        <span class="s1">invalid_mask = pygame.Surface(size)</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">overlap_mask = mask.overlap_mask(invalid_mask</span><span class="s0">, </span><span class="s1">offset)</span>

    <span class="s0">def </span><span class="s1">test_overlap_mask__invalid_offset_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure overlap_mask handles invalid offset arguments correctly.&quot;&quot;&quot;</span>
        <span class="s1">size = (</span><span class="s2">5</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">offset = </span><span class="s5">'(0, 0)'</span>
        <span class="s1">mask1 = pygame.mask.Mask(size)</span>
        <span class="s1">mask2 = pygame.mask.Mask(size)</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">overlap_mask = mask1.overlap_mask(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

    <span class="s0">def </span><span class="s1">test_mask_access( self ):</span>
        <span class="s3">&quot;&quot;&quot; do the set_at, and get_at parts work correctly? 
        &quot;&quot;&quot;</span>
        <span class="s1">m = pygame.Mask((</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">))</span>
        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(m.get_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">))</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">9</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(m.get_at((</span><span class="s2">9</span><span class="s0">,</span><span class="s2">0</span><span class="s1">))</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s4">#s = pygame.Surface((10,10))</span>
        <span class="s4">#s.set_at((1,0), (0, 0, 1, 255))</span>
        <span class="s4">#self.assertEqual(s.get_at((1,0)), (0, 0, 1, 255))</span>
        <span class="s4">#s.set_at((-1,0), (0, 0, 1, 255))</span>

        <span class="s4"># out of bounds, should get IndexError</span>
        <span class="s1">self.assertRaises(IndexError</span><span class="s0">, lambda </span><span class="s1">: m.get_at((-</span><span class="s2">1</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)) )</span>
        <span class="s1">self.assertRaises(IndexError</span><span class="s0">, lambda </span><span class="s1">: m.set_at((-</span><span class="s2">1</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">) )</span>
        <span class="s1">self.assertRaises(IndexError</span><span class="s0">, lambda </span><span class="s1">: m.set_at((</span><span class="s2">10</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">) )</span>
        <span class="s1">self.assertRaises(IndexError</span><span class="s0">, lambda </span><span class="s1">: m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">) )</span>

    <span class="s0">def </span><span class="s1">test_fill(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask can be filled.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">11</span><span class="s0">, </span><span class="s2">23</span>
        <span class="s1">expected_count = width * height</span>
        <span class="s1">expected_size = (width</span><span class="s0">, </span><span class="s1">height)</span>
        <span class="s1">mask = pygame.mask.Mask(expected_size)</span>

        <span class="s1">mask.fill()</span>

        <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_clear(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask can be cleared.&quot;&quot;&quot;</span>
        <span class="s1">expected_count = </span><span class="s2">0</span>
        <span class="s1">expected_size = (</span><span class="s2">13</span><span class="s0">, </span><span class="s2">27</span><span class="s1">)</span>
        <span class="s1">mask = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s1">mask.clear()</span>

        <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_invert(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask can be inverted.&quot;&quot;&quot;</span>
        <span class="s1">side = </span><span class="s2">73</span>
        <span class="s1">expected_size = (side</span><span class="s0">, </span><span class="s1">side)</span>
        <span class="s1">mask1 = pygame.mask.Mask(expected_size)</span>
        <span class="s1">mask2 = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected_count1 = side * side</span>
        <span class="s1">expected_count2 = </span><span class="s2">0</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(side):</span>
            <span class="s1">expected_count1 -= </span><span class="s2">1</span>
            <span class="s1">expected_count2 += </span><span class="s2">1</span>
            <span class="s1">pos = (i</span><span class="s0">, </span><span class="s1">i)</span>
            <span class="s1">mask1.set_at(pos)</span>
            <span class="s1">mask2.set_at(pos</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

        <span class="s1">mask1.invert()</span>
        <span class="s1">mask2.invert()</span>

        <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">expected_count1)</span>
        <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">expected_count2)</span>
        <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>
        <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(side):</span>
            <span class="s1">pos = (i</span><span class="s0">, </span><span class="s1">i)</span>
            <span class="s1">msg = </span><span class="s5">'pos={}'</span><span class="s1">.format(pos)</span>

            <span class="s1">self.assertEqual(mask1.get_at(pos)</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_at(pos)</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_invert__full(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a full mask can be inverted.&quot;&quot;&quot;</span>
        <span class="s1">expected_count = </span><span class="s2">0</span>
        <span class="s1">expected_size = (</span><span class="s2">43</span><span class="s0">, </span><span class="s2">97</span><span class="s1">)</span>
        <span class="s1">mask = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s1">mask.invert()</span>

        <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_invert__empty(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure an empty mask can be inverted.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">43</span><span class="s0">, </span><span class="s2">97</span>
        <span class="s1">expected_size = (width</span><span class="s0">, </span><span class="s1">height)</span>
        <span class="s1">expected_count = width * height</span>
        <span class="s1">mask = pygame.mask.Mask(expected_size)</span>

        <span class="s1">mask.invert()</span>

        <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_scale(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask can be scaled.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">43</span><span class="s0">, </span><span class="s2">61</span>
        <span class="s1">original_size = (width</span><span class="s0">, </span><span class="s1">height)</span>

        <span class="s0">for </span><span class="s1">fill </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
            <span class="s1">original_mask = pygame.mask.Mask(original_size</span><span class="s0">, </span><span class="s1">fill=fill)</span>
            <span class="s1">original_count = width * height </span><span class="s0">if </span><span class="s1">fill </span><span class="s0">else </span><span class="s2">0</span>

            <span class="s4"># Test a range of sizes. Also tests scaling to 'same'</span>
            <span class="s4"># size when new_w, new_h = width, height</span>
            <span class="s0">for </span><span class="s1">new_w </span><span class="s0">in </span><span class="s1">range(width - </span><span class="s2">10</span><span class="s0">, </span><span class="s1">width + </span><span class="s2">10</span><span class="s1">):</span>
                <span class="s0">for </span><span class="s1">new_h </span><span class="s0">in </span><span class="s1">range(height - </span><span class="s2">10</span><span class="s0">, </span><span class="s1">height + </span><span class="s2">10</span><span class="s1">):</span>
                    <span class="s1">expected_size = (new_w</span><span class="s0">, </span><span class="s1">new_h)</span>
                    <span class="s1">expected_count = new_w * new_h </span><span class="s0">if </span><span class="s1">fill </span><span class="s0">else </span><span class="s2">0</span>
                    <span class="s1">msg = </span><span class="s5">'size={}'</span><span class="s1">.format(expected_size)</span>

                    <span class="s1">mask = original_mask.scale(expected_size)</span>

                    <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>
                    <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

                    <span class="s4"># Ensure the original mask is unchanged.</span>
                    <span class="s1">self.assertEqual(original_mask.count()</span><span class="s0">, </span><span class="s1">original_count</span><span class="s0">,</span>
                                     <span class="s1">msg)</span>
                    <span class="s1">self.assertEqual(original_mask.get_size()</span><span class="s0">, </span><span class="s1">original_size</span><span class="s0">,</span>
                                     <span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_scale__negative_size(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure scale handles negative sizes correctly.&quot;&quot;&quot;</span>
        <span class="s1">mask = pygame.Mask((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">100</span><span class="s1">))</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(ValueError):</span>
            <span class="s1">mask.scale((-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">))</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(ValueError):</span>
            <span class="s1">mask.scale((-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(ValueError):</span>
            <span class="s1">mask.scale((</span><span class="s2">10</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_draw(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask can be drawn onto another mask. 
 
        Testing the different combinations of full/empty masks: 
            (mask1-filled) 1 draw 1 (mask2-filled) 
            (mask1-empty)  0 draw 1 (mask2-filled) 
            (mask1-filled) 1 draw 0 (mask2-empty) 
            (mask1-empty)  0 draw 0 (mask2-empty) 
        &quot;&quot;&quot;</span>
        <span class="s1">expected_size = (</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">expected_default = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected_masks = {(</span><span class="s0">False, False</span><span class="s1">) : pygame.mask.Mask(expected_size)}</span>

        <span class="s0">for </span><span class="s1">fill2 </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
            <span class="s1">mask2 = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=fill2)</span>
            <span class="s1">mask2_count = mask2.count()</span>

            <span class="s0">for </span><span class="s1">fill1 </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
                <span class="s1">key = (fill1</span><span class="s0">, </span><span class="s1">fill2)</span>
                <span class="s1">msg = </span><span class="s5">'key={}'</span><span class="s1">.format(key)</span>
                <span class="s1">mask1 = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=fill1)</span>
                <span class="s1">expected_mask = expected_masks.get(key</span><span class="s0">, </span><span class="s1">expected_default)</span>

                <span class="s1">mask1.draw(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

                <span class="s1">self._assertMaskEqual(mask1</span><span class="s0">, </span><span class="s1">expected_mask</span><span class="s0">, </span><span class="s1">msg)</span>

                <span class="s4"># Ensure mask2 unchanged.</span>
                <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_draw__offset(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure an offset mask can be drawn onto another mask.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">65</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">66</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>

        <span class="s4"># Using rects to help determine the overlapping area.</span>
        <span class="s1">rect1 = pygame.Rect((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mask1_size)</span>
        <span class="s1">rect2 = pygame.Rect((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mask2_size)</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">self.ORIGIN_OFFSETS:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>
            <span class="s1">rect2.topleft = offset</span>
            <span class="s1">overlap_rect = rect1.clip(rect2)</span>
            <span class="s1">expected_count = overlap_rect.w * overlap_rect.h</span>
            <span class="s1">mask1.clear()  </span><span class="s4"># Ensure it's empty for testing each offset.</span>

            <span class="s1">mask1.draw(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size</span><span class="s0">, </span><span class="s1">msg)</span>

            <span class="s4"># Ensure mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_draw__offset_boundary(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures draw handles offsets and boundaries correctly.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">13</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">7</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask1_count = mask1.count()</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>

        <span class="s4"># Check the 4 boundaries.</span>
        <span class="s1">offsets = ((mask1_size[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,   </span><span class="s4"># off right</span>
                   <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">mask1_size[</span><span class="s2">1</span><span class="s1">])</span><span class="s0">,   </span><span class="s4"># off bottom</span>
                   <span class="s1">(-mask2_size[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># off left</span>
                   <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-mask2_size[</span><span class="s2">1</span><span class="s1">]))  </span><span class="s4"># off top</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">offsets:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>

            <span class="s1">mask1.draw(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s4"># Ensure mask1/mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_draw__invalid_mask_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure draw handles invalid mask arguments correctly.&quot;&quot;&quot;</span>
        <span class="s1">size = (</span><span class="s2">7</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">mask = pygame.mask.Mask(size)</span>
        <span class="s1">invalid_mask = pygame.Surface(size)</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">mask.draw(invalid_mask</span><span class="s0">, </span><span class="s1">offset)</span>

    <span class="s0">def </span><span class="s1">test_draw__invalid_offset_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure draw handles invalid offset arguments correctly.&quot;&quot;&quot;</span>
        <span class="s1">size = (</span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span>
        <span class="s1">offset = </span><span class="s5">'(0, 0)'</span>
        <span class="s1">mask1 = pygame.mask.Mask(size)</span>
        <span class="s1">mask2 = pygame.mask.Mask(size)</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">mask1.draw(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

    <span class="s0">def </span><span class="s1">test_erase(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask can erase another mask. 
 
        Testing the different combinations of full/empty masks: 
            (mask1-filled) 1 erase 1 (mask2-filled) 
            (mask1-empty)  0 erase 1 (mask2-filled) 
            (mask1-filled) 1 erase 0 (mask2-empty) 
            (mask1-empty)  0 erase 0 (mask2-empty) 
        &quot;&quot;&quot;</span>
        <span class="s1">expected_size = (</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">expected_default = pygame.mask.Mask(expected_size)</span>
        <span class="s1">expected_masks = {</span>
                <span class="s1">(</span><span class="s0">True, False</span><span class="s1">) : pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)}</span>

        <span class="s0">for </span><span class="s1">fill2 </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
            <span class="s1">mask2 = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=fill2)</span>
            <span class="s1">mask2_count = mask2.count()</span>

            <span class="s0">for </span><span class="s1">fill1 </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
                <span class="s1">key = (fill1</span><span class="s0">, </span><span class="s1">fill2)</span>
                <span class="s1">msg = </span><span class="s5">'key={}'</span><span class="s1">.format(key)</span>
                <span class="s1">mask1 = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=fill1)</span>
                <span class="s1">expected_mask = expected_masks.get(key</span><span class="s0">, </span><span class="s1">expected_default)</span>

                <span class="s1">mask1.erase(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

                <span class="s1">self._assertMaskEqual(mask1</span><span class="s0">, </span><span class="s1">expected_mask</span><span class="s0">, </span><span class="s1">msg)</span>

                <span class="s4"># Ensure mask2 unchanged.</span>
                <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_erase__offset(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure an offset mask can erase another mask.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">65</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">66</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>

        <span class="s4"># Using rects to help determine the overlapping area.</span>
        <span class="s1">rect1 = pygame.Rect((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mask1_size)</span>
        <span class="s1">rect2 = pygame.Rect((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mask2_size)</span>
        <span class="s1">rect1_area = rect1.w * rect1.h</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">self.ORIGIN_OFFSETS:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>
            <span class="s1">rect2.topleft = offset</span>
            <span class="s1">overlap_rect = rect1.clip(rect2)</span>
            <span class="s1">expected_count = rect1_area - (overlap_rect.w * overlap_rect.h)</span>
            <span class="s1">mask1.fill()  </span><span class="s4"># Ensure it's filled for testing each offset.</span>

            <span class="s1">mask1.erase(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size</span><span class="s0">, </span><span class="s1">msg)</span>

            <span class="s4"># Ensure mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_erase__offset_boundary(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures erase handles offsets and boundaries correctly.&quot;&quot;&quot;</span>
        <span class="s1">mask1 = pygame.mask.Mask((</span><span class="s2">7</span><span class="s0">, </span><span class="s2">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">13</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">mask1_count = mask1.count()</span>
        <span class="s1">mask2_count = mask2.count()</span>
        <span class="s1">mask1_size = mask1.get_size()</span>
        <span class="s1">mask2_size = mask2.get_size()</span>

        <span class="s4"># Check the 4 boundaries.</span>
        <span class="s1">offsets = ((mask1_size[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,   </span><span class="s4"># off right</span>
                   <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">mask1_size[</span><span class="s2">1</span><span class="s1">])</span><span class="s0">,   </span><span class="s4"># off bottom</span>
                   <span class="s1">(-mask2_size[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># off left</span>
                   <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-mask2_size[</span><span class="s2">1</span><span class="s1">]))  </span><span class="s4"># off top</span>

        <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">offsets:</span>
            <span class="s1">msg = </span><span class="s5">'offset={}'</span><span class="s1">.format(offset)</span>

            <span class="s1">mask1.erase(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

            <span class="s4"># Ensure mask1/mask2 unchanged.</span>
            <span class="s1">self.assertEqual(mask1.count()</span><span class="s0">, </span><span class="s1">mask1_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.count()</span><span class="s0">, </span><span class="s1">mask2_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask1.get_size()</span><span class="s0">, </span><span class="s1">mask1_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">mask2_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_erase__invalid_mask_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure erase handles invalid mask arguments correctly.&quot;&quot;&quot;</span>
        <span class="s1">size = (</span><span class="s2">3</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">mask = pygame.mask.Mask(size)</span>
        <span class="s1">invalid_mask = pygame.Surface(size)</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">mask.erase(invalid_mask</span><span class="s0">, </span><span class="s1">offset)</span>

    <span class="s0">def </span><span class="s1">test_erase__invalid_offset_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure erase handles invalid offset arguments correctly.&quot;&quot;&quot;</span>
        <span class="s1">size = (</span><span class="s2">7</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">offset = </span><span class="s5">'(0, 0)'</span>
        <span class="s1">mask1 = pygame.mask.Mask(size)</span>
        <span class="s1">mask2 = pygame.mask.Mask(size)</span>

        <span class="s0">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">mask1.erase(mask2</span><span class="s0">, </span><span class="s1">offset)</span>

    <span class="s0">def </span><span class="s1">test_count(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask's set bits are correctly counted.&quot;&quot;&quot;</span>
        <span class="s1">side = </span><span class="s2">67</span>
        <span class="s1">expected_size = (side</span><span class="s0">, </span><span class="s1">side)</span>
        <span class="s1">expected_count = </span><span class="s2">0</span>
        <span class="s1">mask = pygame.mask.Mask(expected_size)</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(side):</span>
            <span class="s1">expected_count += </span><span class="s2">1</span>
            <span class="s1">mask.set_at((i</span><span class="s0">, </span><span class="s1">i))</span>

        <span class="s1">count = mask.count()</span>

        <span class="s1">self.assertEqual(count</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_count__full_mask(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a full mask's set bits are correctly counted.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">17</span><span class="s0">, </span><span class="s2">97</span>
        <span class="s1">expected_size = (width</span><span class="s0">, </span><span class="s1">height)</span>
        <span class="s1">expected_count = width * height</span>
        <span class="s1">mask = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s1">count = mask.count()</span>

        <span class="s1">self.assertEqual(count</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_count__empty_mask(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure an empty mask's set bits are correctly counted.&quot;&quot;&quot;</span>
        <span class="s1">expected_count = </span><span class="s2">0</span>
        <span class="s1">expected_size = (</span><span class="s2">13</span><span class="s0">, </span><span class="s2">27</span><span class="s1">)</span>
        <span class="s1">mask = pygame.mask.Mask(expected_size)</span>

        <span class="s1">count = mask.count()</span>

        <span class="s1">self.assertEqual(count</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">todo_test_centroid(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask's centroid is correctly calculated.&quot;&quot;&quot;</span>
        <span class="s1">self.fail()</span>

    <span class="s0">def </span><span class="s1">test_centroid__empty_mask(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure an empty mask's centroid is correctly calculated.&quot;&quot;&quot;</span>
        <span class="s1">expected_centroid = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">expected_size = (</span><span class="s2">101</span><span class="s0">, </span><span class="s2">103</span><span class="s1">)</span>
        <span class="s1">mask = pygame.mask.Mask(expected_size)</span>

        <span class="s1">centroid = mask.centroid()</span>

        <span class="s1">self.assertEqual(centroid</span><span class="s0">, </span><span class="s1">expected_centroid)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">todo_test_angle(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask's orientation angle is correctly calculated.&quot;&quot;&quot;</span>
        <span class="s1">self.fail()</span>

    <span class="s0">def </span><span class="s1">test_angle__empty_mask(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure an empty mask's angle is correctly calculated.&quot;&quot;&quot;</span>
        <span class="s1">expected_angle = </span><span class="s2">0.0</span>
        <span class="s1">expected_size = (</span><span class="s2">107</span><span class="s0">, </span><span class="s2">43</span><span class="s1">)</span>
        <span class="s1">mask = pygame.mask.Mask(expected_size)</span>

        <span class="s1">angle = mask.angle()</span>

        <span class="s1">self.assertIsInstance(angle</span><span class="s0">, </span><span class="s1">float)</span>
        <span class="s1">self.assertAlmostEqual(angle</span><span class="s0">, </span><span class="s1">expected_angle)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_drawing(self):</span>
        <span class="s3">&quot;&quot;&quot; Test fill, clear, invert, draw, erase 
        &quot;&quot;&quot;</span>
        <span class="s1">m = pygame.Mask((</span><span class="s2">100</span><span class="s0">,</span><span class="s2">100</span><span class="s1">))</span>
        <span class="s1">self.assertEqual(m.count()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

        <span class="s1">m.fill()</span>
        <span class="s1">self.assertEqual(m.count()</span><span class="s0">, </span><span class="s2">10000</span><span class="s1">)</span>

        <span class="s1">m2 = pygame.Mask((</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">m.erase(m2</span><span class="s0">, </span><span class="s1">(</span><span class="s2">50</span><span class="s0">,</span><span class="s2">50</span><span class="s1">))</span>
        <span class="s1">self.assertEqual(m.count()</span><span class="s0">, </span><span class="s2">9900</span><span class="s1">)</span>

        <span class="s1">m.invert()</span>
        <span class="s1">self.assertEqual(m.count()</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span>

        <span class="s1">m.draw(m2</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">))</span>
        <span class="s1">self.assertEqual(m.count()</span><span class="s0">, </span><span class="s2">200</span><span class="s1">)</span>

        <span class="s1">m.clear()</span>
        <span class="s1">self.assertEqual(m.count()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_outline(self):</span>
        <span class="s3">&quot;&quot;&quot; 
        &quot;&quot;&quot;</span>

        <span class="s1">m = pygame.Mask((</span><span class="s2">20</span><span class="s0">,</span><span class="s2">20</span><span class="s1">))</span>
        <span class="s1">self.assertEqual(m.outline()</span><span class="s0">, </span><span class="s1">[])</span>

        <span class="s1">m.set_at((</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(m.outline()</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">)])</span>

        <span class="s1">m.set_at((</span><span class="s2">10</span><span class="s0">,</span><span class="s2">12</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(m.outline(</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">)])</span>

        <span class="s1">m.set_at((</span><span class="s2">11</span><span class="s0">,</span><span class="s2">11</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(m.outline()</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">11</span><span class="s0">,</span><span class="s2">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">,</span><span class="s2">12</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">11</span><span class="s0">,</span><span class="s2">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">)])</span>
        <span class="s1">self.assertEqual(m.outline(</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">,</span><span class="s2">12</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">)])</span>

        <span class="s4">#TODO: Test more corner case outlines.</span>

    <span class="s0">def </span><span class="s1">test_convolve__size(self):</span>
        <span class="s1">sizes = [(</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">31</span><span class="s0">,</span><span class="s2">31</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">32</span><span class="s0">,</span><span class="s2">32</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">100</span><span class="s0">,</span><span class="s2">100</span><span class="s1">)]</span>
        <span class="s0">for </span><span class="s1">s1 </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">m1 = pygame.Mask(s1)</span>
            <span class="s0">for </span><span class="s1">s2 </span><span class="s0">in </span><span class="s1">sizes:</span>
                <span class="s1">m2 = pygame.Mask(s2)</span>
                <span class="s1">o = m1.convolve(m2)</span>
                <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">(</span><span class="s2">0</span><span class="s0">,</span><span class="s2">1</span><span class="s1">):</span>
                    <span class="s1">self.assertEqual(o.get_size()[i]</span><span class="s0">,</span>
                                     <span class="s1">m1.get_size()[i] + m2.get_size()[i] - </span><span class="s2">1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_convolve__point_identities(self):</span>
        <span class="s3">&quot;&quot;&quot;Convolving with a single point is the identity, while convolving a point with something flips it.&quot;&quot;&quot;</span>
        <span class="s1">m = random_mask((</span><span class="s2">100</span><span class="s0">,</span><span class="s2">100</span><span class="s1">))</span>
        <span class="s1">k = pygame.Mask((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">))</span>
        <span class="s1">k.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">))</span>

        <span class="s1">self._assertMaskEqual(m</span><span class="s0">, </span><span class="s1">m.convolve(k))</span>
        <span class="s1">self._assertMaskEqual(m</span><span class="s0">, </span><span class="s1">k.convolve(k.convolve(m)))</span>

    <span class="s0">def </span><span class="s1">test_convolve__with_output(self):</span>
        <span class="s3">&quot;&quot;&quot;checks that convolution modifies only the correct portion of the output&quot;&quot;&quot;</span>

        <span class="s1">m = random_mask((</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">))</span>
        <span class="s1">k = pygame.Mask((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">k.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">))</span>

        <span class="s1">o = pygame.Mask((</span><span class="s2">50</span><span class="s0">,</span><span class="s2">50</span><span class="s1">))</span>
        <span class="s1">test = pygame.Mask((</span><span class="s2">50</span><span class="s0">,</span><span class="s2">50</span><span class="s1">))</span>

        <span class="s1">m.convolve(k</span><span class="s0">,</span><span class="s1">o)</span>
        <span class="s1">test.draw(m</span><span class="s0">,</span><span class="s1">(</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">))</span>
        <span class="s1">self._assertMaskEqual(o</span><span class="s0">, </span><span class="s1">test)</span>

        <span class="s1">o.clear()</span>
        <span class="s1">test.clear()</span>

        <span class="s1">m.convolve(k</span><span class="s0">,</span><span class="s1">o</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">))</span>
        <span class="s1">test.draw(m</span><span class="s0">,</span><span class="s1">(</span><span class="s2">11</span><span class="s0">,</span><span class="s2">11</span><span class="s1">))</span>
        <span class="s1">self._assertMaskEqual(o</span><span class="s0">, </span><span class="s1">test)</span>

    <span class="s0">def </span><span class="s1">test_convolve__out_of_range(self):</span>
        <span class="s1">full = pygame.Mask((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s1">self.assertEqual(full.convolve(full</span><span class="s0">, None, </span><span class="s1">( </span><span class="s2">0</span><span class="s0">,  </span><span class="s2">3</span><span class="s1">)).count()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(full.convolve(full</span><span class="s0">, None, </span><span class="s1">( </span><span class="s2">0</span><span class="s0">,  </span><span class="s2">2</span><span class="s1">)).count()</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(full.convolve(full</span><span class="s0">, None, </span><span class="s1">(-</span><span class="s2">2</span><span class="s0">, </span><span class="s1">-</span><span class="s2">2</span><span class="s1">)).count()</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(full.convolve(full</span><span class="s0">, None, </span><span class="s1">(-</span><span class="s2">3</span><span class="s0">, </span><span class="s1">-</span><span class="s2">3</span><span class="s1">)).count()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_convolve(self):</span>
        <span class="s3">&quot;&quot;&quot;Tests the definition of convolution&quot;&quot;&quot;</span>
        <span class="s1">m1 = random_mask((</span><span class="s2">100</span><span class="s0">,</span><span class="s2">100</span><span class="s1">))</span>
        <span class="s1">m2 = random_mask((</span><span class="s2">100</span><span class="s0">,</span><span class="s2">100</span><span class="s1">))</span>
        <span class="s1">conv = m1.convolve(m2)</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(conv.get_size()[</span><span class="s2">0</span><span class="s1">]):</span>
            <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(conv.get_size()[</span><span class="s2">1</span><span class="s1">]):</span>
                <span class="s1">self.assertEqual(conv.get_at((i</span><span class="s0">,</span><span class="s1">j)) == </span><span class="s2">0</span><span class="s0">,</span>
                                 <span class="s1">m1.overlap(m2</span><span class="s0">, </span><span class="s1">(i - </span><span class="s2">99</span><span class="s0">, </span><span class="s1">j - </span><span class="s2">99</span><span class="s1">)) </span><span class="s0">is None</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">_draw_component_pattern_box(self</span><span class="s0">, </span><span class="s1">mask</span><span class="s0">, </span><span class="s1">size</span><span class="s0">, </span><span class="s1">pos</span><span class="s0">, </span><span class="s1">inverse=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s4"># Helper method to create/draw a 'box' pattern for testing.</span>
        <span class="s4">#</span>
        <span class="s4"># 111</span>
        <span class="s4"># 101  3x3 example pattern</span>
        <span class="s4"># 111</span>
        <span class="s1">pattern = pygame.mask.Mask((size</span><span class="s0">, </span><span class="s1">size)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">pattern.set_at((size // </span><span class="s2">2</span><span class="s0">, </span><span class="s1">size // </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

        <span class="s0">if </span><span class="s1">inverse:</span>
            <span class="s1">mask.erase(pattern</span><span class="s0">, </span><span class="s1">pos)</span>
            <span class="s1">pattern.invert()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">mask.draw(pattern</span><span class="s0">, </span><span class="s1">pos)</span>

        <span class="s0">return </span><span class="s1">pattern</span>

    <span class="s0">def </span><span class="s1">_draw_component_pattern_x(self</span><span class="s0">, </span><span class="s1">mask</span><span class="s0">, </span><span class="s1">size</span><span class="s0">, </span><span class="s1">pos</span><span class="s0">, </span><span class="s1">inverse=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s4"># Helper method to create/draw an 'X' pattern for testing.</span>
        <span class="s4">#</span>
        <span class="s4"># 101</span>
        <span class="s4"># 010  3x3 example pattern</span>
        <span class="s4"># 101</span>
        <span class="s1">pattern = pygame.mask.Mask((size</span><span class="s0">, </span><span class="s1">size))</span>

        <span class="s1">ymax = size - </span><span class="s2">1</span>
        <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(size):</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(size):</span>
                <span class="s0">if </span><span class="s1">x == y </span><span class="s0">or </span><span class="s1">x == ymax - y:</span>
                    <span class="s1">pattern.set_at((x</span><span class="s0">, </span><span class="s1">y))</span>

        <span class="s0">if </span><span class="s1">inverse:</span>
            <span class="s1">mask.erase(pattern</span><span class="s0">, </span><span class="s1">pos)</span>
            <span class="s1">pattern.invert()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">mask.draw(pattern</span><span class="s0">, </span><span class="s1">pos)</span>

        <span class="s0">return </span><span class="s1">pattern</span>

    <span class="s0">def </span><span class="s1">_draw_component_pattern_plus(self</span><span class="s0">, </span><span class="s1">mask</span><span class="s0">, </span><span class="s1">size</span><span class="s0">, </span><span class="s1">pos</span><span class="s0">, </span><span class="s1">inverse=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s4"># Helper method to create/draw a '+' pattern for testing.</span>
        <span class="s4">#</span>
        <span class="s4"># 010</span>
        <span class="s4"># 111  3x3 example pattern</span>
        <span class="s4"># 010</span>
        <span class="s1">pattern = pygame.mask.Mask((size</span><span class="s0">, </span><span class="s1">size))</span>

        <span class="s1">xmid = ymid = size // </span><span class="s2">2</span>
        <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(size):</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(size):</span>
                <span class="s0">if </span><span class="s1">x == xmid </span><span class="s0">or </span><span class="s1">y == ymid:</span>
                    <span class="s1">pattern.set_at((x</span><span class="s0">, </span><span class="s1">y))</span>

        <span class="s0">if </span><span class="s1">inverse:</span>
            <span class="s1">mask.erase(pattern</span><span class="s0">, </span><span class="s1">pos)</span>
            <span class="s1">pattern.invert()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">mask.draw(pattern</span><span class="s0">, </span><span class="s1">pos)</span>

        <span class="s0">return </span><span class="s1">pattern</span>

    <span class="s0">def </span><span class="s1">test_connected_component(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask's connected component is correctly calculated.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">41</span><span class="s0">, </span><span class="s2">27</span>
        <span class="s1">expected_size = (width</span><span class="s0">, </span><span class="s1">height)</span>
        <span class="s1">original_mask = pygame.mask.Mask(expected_size)</span>
        <span class="s1">patterns = []  </span><span class="s4"># Patterns and offsets.</span>

        <span class="s4"># Draw some connected patterns on the original mask.</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">pattern = self._draw_component_pattern_x(original_mask</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s1">offset)</span>
        <span class="s1">patterns.append((pattern</span><span class="s0">, </span><span class="s1">offset))</span>

        <span class="s1">size = </span><span class="s2">4</span>
        <span class="s1">offset = (width - size</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">pattern = self._draw_component_pattern_plus(original_mask</span><span class="s0">, </span><span class="s1">size</span><span class="s0">,</span>
                                                    <span class="s1">offset)</span>
        <span class="s1">patterns.append((pattern</span><span class="s0">, </span><span class="s1">offset))</span>

        <span class="s4"># Make this one the largest connected component.</span>
        <span class="s1">offset = (width // </span><span class="s2">2</span><span class="s0">, </span><span class="s1">height // </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">pattern = self._draw_component_pattern_box(original_mask</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s1">offset)</span>
        <span class="s1">patterns.append((pattern</span><span class="s0">, </span><span class="s1">offset))</span>

        <span class="s1">expected_pattern</span><span class="s0">, </span><span class="s1">expected_offset = patterns[-</span><span class="s2">1</span><span class="s1">]</span>
        <span class="s1">expected_count = expected_pattern.count()</span>
        <span class="s1">original_count = sum(p.count() </span><span class="s0">for </span><span class="s1">p</span><span class="s0">, </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">patterns)</span>

        <span class="s1">mask = original_mask.connected_component()</span>

        <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>
        <span class="s1">self.assertEqual(mask.overlap_area(expected_pattern</span><span class="s0">, </span><span class="s1">expected_offset)</span><span class="s0">,</span>
                         <span class="s1">expected_count)</span>

        <span class="s4"># Ensure the original mask is unchanged.</span>
        <span class="s1">self.assertEqual(original_mask.count()</span><span class="s0">, </span><span class="s1">original_count)</span>
        <span class="s1">self.assertEqual(original_mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

        <span class="s0">for </span><span class="s1">pattern</span><span class="s0">, </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">patterns:</span>
            <span class="s1">self.assertEqual(original_mask.overlap_area(pattern</span><span class="s0">, </span><span class="s1">offset)</span><span class="s0">,</span>
                             <span class="s1">pattern.count())</span>

    <span class="s0">def </span><span class="s1">test_connected_component__full_mask(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask's connected component is correctly calculated 
        when the mask is full.&quot;&quot;&quot;</span>
        <span class="s1">expected_size = (</span><span class="s2">23</span><span class="s0">, </span><span class="s2">31</span><span class="s1">)</span>
        <span class="s1">original_mask = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected_count = original_mask.count()</span>

        <span class="s1">mask = original_mask.connected_component()</span>

        <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

        <span class="s4"># Ensure the original mask is unchanged.</span>
        <span class="s1">self.assertEqual(original_mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(original_mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_connected_component__empty_mask(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask's connected component is correctly calculated 
        when the mask is empty.&quot;&quot;&quot;</span>
        <span class="s1">expected_size = (</span><span class="s2">37</span><span class="s0">, </span><span class="s2">43</span><span class="s1">)</span>
        <span class="s1">original_mask = pygame.mask.Mask(expected_size)</span>
        <span class="s1">original_count = original_mask.count()</span>
        <span class="s1">expected_count = </span><span class="s2">0</span>

        <span class="s1">mask = original_mask.connected_component()</span>

        <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

        <span class="s4"># Ensure the original mask is unchanged.</span>
        <span class="s1">self.assertEqual(original_mask.count()</span><span class="s0">, </span><span class="s1">original_count)</span>
        <span class="s1">self.assertEqual(original_mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_connected_component__one_set_bit(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask's connected component is correctly calculated 
        when the coordinate's bit is set with a connected component of 1 bit. 
        &quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">71</span><span class="s0">, </span><span class="s2">67</span>
        <span class="s1">expected_size = (width</span><span class="s0">, </span><span class="s1">height)</span>
        <span class="s1">original_mask = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">xset</span><span class="s0">, </span><span class="s1">yset = width // </span><span class="s2">2</span><span class="s0">, </span><span class="s1">height // </span><span class="s2">2</span>
        <span class="s1">set_pos = (xset</span><span class="s0">, </span><span class="s1">yset)</span>
        <span class="s1">expected_offset = (xset - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">yset - </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s4"># This isolates the bit at set_pos from all the other bits.</span>
        <span class="s1">expected_pattern = self._draw_component_pattern_box(original_mask</span><span class="s0">, </span><span class="s2">3</span><span class="s0">,</span>
            <span class="s1">expected_offset</span><span class="s0">, </span><span class="s1">inverse=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected_count = </span><span class="s2">1</span>
        <span class="s1">original_count = original_mask.count()</span>

        <span class="s1">mask = original_mask.connected_component(set_pos)</span>

        <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>
        <span class="s1">self.assertEqual(mask.overlap_area(expected_pattern</span><span class="s0">, </span><span class="s1">expected_offset)</span><span class="s0">,</span>
                         <span class="s1">expected_count)</span>

        <span class="s4"># Ensure the original mask is unchanged.</span>
        <span class="s1">self.assertEqual(original_mask.count()</span><span class="s0">, </span><span class="s1">original_count)</span>
        <span class="s1">self.assertEqual(original_mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>
        <span class="s1">self.assertEqual(original_mask.overlap_area(</span>
            <span class="s1">expected_pattern</span><span class="s0">, </span><span class="s1">expected_offset)</span><span class="s0">, </span><span class="s1">expected_count)</span>

    <span class="s0">def </span><span class="s1">test_connected_component__multi_set_bits(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask's connected component is correctly calculated 
        when the coordinate's bit is set with a connected component of &gt; 1 bit. 
        &quot;&quot;&quot;</span>
        <span class="s1">expected_size = (</span><span class="s2">113</span><span class="s0">, </span><span class="s2">67</span><span class="s1">)</span>
        <span class="s1">original_mask = pygame.mask.Mask(expected_size)</span>
        <span class="s1">p_width</span><span class="s0">, </span><span class="s1">p_height = </span><span class="s2">11</span><span class="s0">, </span><span class="s2">13</span>
        <span class="s1">set_pos = xset</span><span class="s0">, </span><span class="s1">yset = </span><span class="s2">11</span><span class="s0">, </span><span class="s2">21</span>
        <span class="s1">expected_offset = (xset - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">yset - </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">expected_pattern = pygame.mask.Mask((p_width</span><span class="s0">, </span><span class="s1">p_height)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s4"># Make an unsymmetrical pattern. All the set bits need to be connected</span>
        <span class="s4"># in the resulting pattern for this to work properly.</span>
        <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">p_height):</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">p_width):</span>
                <span class="s0">if </span><span class="s1">x == y </span><span class="s0">or </span><span class="s1">x == y - </span><span class="s2">3 </span><span class="s0">or </span><span class="s1">x == p_width - </span><span class="s2">4</span><span class="s1">:</span>
                    <span class="s1">expected_pattern.set_at((x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

        <span class="s1">expected_count = expected_pattern.count()</span>
        <span class="s1">original_mask.draw(expected_pattern</span><span class="s0">, </span><span class="s1">expected_offset)</span>

        <span class="s1">mask = original_mask.connected_component(set_pos)</span>

        <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>
        <span class="s1">self.assertEqual(mask.overlap_area(expected_pattern</span><span class="s0">, </span><span class="s1">expected_offset)</span><span class="s0">,</span>
                         <span class="s1">expected_count)</span>

        <span class="s4"># Ensure the original mask is unchanged.</span>
        <span class="s1">self.assertEqual(original_mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(original_mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>
        <span class="s1">self.assertEqual(original_mask.overlap_area(</span>
            <span class="s1">expected_pattern</span><span class="s0">, </span><span class="s1">expected_offset)</span><span class="s0">, </span><span class="s1">expected_count)</span>

    <span class="s0">def </span><span class="s1">test_connected_component__unset_bit(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure a mask's connected component is correctly calculated 
        when the coordinate's bit is unset. 
        &quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">109</span><span class="s0">, </span><span class="s2">101</span>
        <span class="s1">expected_size = (width</span><span class="s0">, </span><span class="s1">height)</span>
        <span class="s1">original_mask = pygame.mask.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">unset_pos = (width // </span><span class="s2">2</span><span class="s0">, </span><span class="s1">height // </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">original_mask.set_at(unset_pos</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">original_count = original_mask.count()</span>
        <span class="s1">expected_count = </span><span class="s2">0</span>

        <span class="s1">mask = original_mask.connected_component(unset_pos)</span>

        <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count)</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>

        <span class="s4"># Ensure the original mask is unchanged.</span>
        <span class="s1">self.assertEqual(original_mask.count()</span><span class="s0">, </span><span class="s1">original_count)</span>
        <span class="s1">self.assertEqual(original_mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size)</span>
        <span class="s1">self.assertEqual(original_mask.get_at(unset_pos)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_connected_component__out_of_bounds(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensure connected_component() checks bounds.&quot;&quot;&quot;</span>
        <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s2">19</span><span class="s0">, </span><span class="s2">11</span>
        <span class="s1">original_size = (width</span><span class="s0">, </span><span class="s1">height)</span>
        <span class="s1">original_mask = pygame.mask.Mask(original_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">original_count = original_mask.count()</span>

        <span class="s0">for </span><span class="s1">pos </span><span class="s0">in </span><span class="s1">((</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">height + </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(width + </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
                <span class="s1">mask = original_mask.connected_component(pos)</span>

            <span class="s4"># Ensure the original mask is unchanged.</span>
            <span class="s1">self.assertEqual(original_mask.count()</span><span class="s0">, </span><span class="s1">original_count)</span>
            <span class="s1">self.assertEqual(original_mask.get_size()</span><span class="s0">, </span><span class="s1">original_size)</span>

    <span class="s0">def </span><span class="s1">test_connected_components(self):</span>
        <span class="s3">&quot;&quot;&quot; 
        &quot;&quot;&quot;</span>

        <span class="s1">m = pygame.Mask((</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">))</span>
        <span class="s1">self.assertEqual(repr(m.connected_components())</span><span class="s0">, </span><span class="s5">&quot;[]&quot;</span><span class="s1">)</span>

        <span class="s1">comp = m.connected_component()</span>
        <span class="s1">self.assertEqual(m.count()</span><span class="s0">, </span><span class="s1">comp.count())</span>

        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">comp = m.connected_component()</span>
        <span class="s1">comps = m.connected_components()</span>
        <span class="s1">comps1 = m.connected_components(</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">comps2 = m.connected_components(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">comps3 = m.connected_components(</span><span class="s2">3</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(comp.count()</span><span class="s0">, </span><span class="s1">comps[</span><span class="s2">0</span><span class="s1">].count())</span>
        <span class="s1">self.assertEqual(comps1[</span><span class="s2">0</span><span class="s1">].count()</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(comps2[</span><span class="s2">0</span><span class="s1">].count()</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(repr(comps3)</span><span class="s0">, </span><span class="s5">&quot;[]&quot;</span><span class="s1">)</span>

        <span class="s1">m.set_at((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">9</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">comp = m.connected_component()</span>
        <span class="s1">comp1 = m.connected_component((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span>
        <span class="s1">comp2 = m.connected_component((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">comps = m.connected_components()</span>
        <span class="s1">comps1 = m.connected_components(</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">comps2 = m.connected_components(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">comps3 = m.connected_components(</span><span class="s2">3</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(comp.count()</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(comp1.count()</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(comp2.count()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(len(comps)</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(len(comps1)</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(len(comps2)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(len(comps3)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_get_bounding_rects(self):</span>
        <span class="s3">&quot;&quot;&quot; 
        &quot;&quot;&quot;</span>

        <span class="s1">m = pygame.Mask((</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">))</span>
        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">r = m.get_bounding_rects()</span>

        <span class="s1">self.assertEqual(</span>
                <span class="s1">repr(r)</span><span class="s0">,</span>
                <span class="s5">&quot;[&lt;rect(0, 0, 2, 2)&gt;, &lt;rect(0, 3, 1, 1)&gt;, &lt;rect(3, 3, 1, 1)&gt;]&quot;</span><span class="s1">)</span>

        <span class="s4">#1100</span>
        <span class="s4">#1111</span>
        <span class="s1">m = pygame.Mask((</span><span class="s2">4</span><span class="s0">,</span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">r = m.get_bounding_rects()</span>
        <span class="s1">self.assertEqual(repr(r)</span><span class="s0">, </span><span class="s5">&quot;[&lt;rect(0, 0, 4, 2)&gt;]&quot;</span><span class="s1">)</span>

        <span class="s4">#00100</span>
        <span class="s4">#01110</span>
        <span class="s4">#00100</span>
        <span class="s1">m = pygame.Mask((</span><span class="s2">5</span><span class="s0">,</span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">4</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">4</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">4</span><span class="s0">,</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

        <span class="s1">r = m.get_bounding_rects()</span>
        <span class="s1">self.assertEqual(repr(r)</span><span class="s0">, </span><span class="s5">&quot;[&lt;rect(1, 0, 3, 3)&gt;]&quot;</span><span class="s1">)</span>

        <span class="s4">#00010</span>
        <span class="s4">#00100</span>
        <span class="s4">#01000</span>
        <span class="s1">m = pygame.Mask((</span><span class="s2">5</span><span class="s0">,</span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">4</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">4</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">4</span><span class="s0">,</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

        <span class="s1">r = m.get_bounding_rects()</span>
        <span class="s1">self.assertEqual(repr(r)</span><span class="s0">, </span><span class="s5">&quot;[&lt;rect(1, 0, 3, 3)&gt;]&quot;</span><span class="s1">)</span>

        <span class="s4">#00011</span>
        <span class="s4">#11111</span>
        <span class="s1">m = pygame.Mask((</span><span class="s2">5</span><span class="s0">,</span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">4</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">m.set_at((</span><span class="s2">0</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">m.set_at((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">r = m.get_bounding_rects()</span>
        <span class="s4">#TODO: this should really make one bounding rect.</span>
        <span class="s4">#self.assertEqual(repr(r), &quot;[&lt;rect(0, 0, 5, 2)&gt;]&quot;)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask(self):</span>
        <span class="s1">mask = pygame.mask.Mask((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s1">mask = pygame.mask.Mask((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s1">mask = pygame.mask.Mask((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">))</span>
        <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_get_size(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures get_size correctly handles zero sized masks.&quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">expected_size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">41</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">40</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask = pygame.mask.Mask(expected_size)</span>

            <span class="s1">size = mask.get_size()</span>

            <span class="s1">self.assertEqual(size</span><span class="s0">, </span><span class="s1">expected_size)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_get_at(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures get_at correctly handles zero sized masks.&quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">51</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>

            <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
                <span class="s1">value = mask.get_at((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_set_at(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures set_at correctly handles zero sized masks.&quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">31</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">30</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>

            <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
                <span class="s1">mask.set_at((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_overlap(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>
            <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">100</span><span class="s1">))</span>
            <span class="s1">self.assertEqual(mask.overlap(mask2</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span><span class="s0">, None</span><span class="s1">)</span>
            <span class="s1">self.assertEqual(mask2.overlap(mask</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span><span class="s0">, None</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_overlap_area(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>
            <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">100</span><span class="s1">))</span>
            <span class="s1">self.assertEqual(mask.overlap_area(mask2</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
            <span class="s1">self.assertEqual(mask2.overlap_area(mask</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_overlap_mask(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>
            <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">100</span><span class="s1">))</span>

            <span class="s1">overlap_mask = mask.overlap_mask(mask2</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>
            <span class="s1">overlap_mask2 = mask2.overlap_mask(mask</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

            <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">overlap_mask.get_size())</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">overlap_mask2.get_size())</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_fill(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
            <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_clear(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>
            <span class="s1">mask.clear()</span>
            <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_flip(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>
            <span class="s1">mask.invert()</span>
            <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_scale(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>
            <span class="s1">mask2 = mask.scale((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
            <span class="s1">self.assertEqual(mask2.get_size()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_draw(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>
            <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
            <span class="s1">before = [mask2.get_at((x</span><span class="s0">, </span><span class="s1">y)) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">100</span><span class="s1">)]</span>
            <span class="s1">mask.draw(mask2</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>
            <span class="s1">after = [mask2.get_at((x</span><span class="s0">, </span><span class="s1">y)) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">100</span><span class="s1">)]</span>
            <span class="s1">self.assertEqual(before</span><span class="s0">, </span><span class="s1">after)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_erase(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>
            <span class="s1">mask2 = pygame.mask.Mask((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
            <span class="s1">before = [mask2.get_at((x</span><span class="s0">, </span><span class="s1">y)) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">100</span><span class="s1">)]</span>
            <span class="s1">mask.erase(mask2</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>
            <span class="s1">after = [mask2.get_at((x</span><span class="s0">, </span><span class="s1">y)) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">100</span><span class="s1">)]</span>
            <span class="s1">self.assertEqual(before</span><span class="s0">, </span><span class="s1">after)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_count(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
            <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_centroid(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>
            <span class="s1">self.assertEqual(mask.centroid()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_angle(self):</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>
            <span class="s1">self.assertEqual(mask.angle()</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_outline(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures outline correctly handles zero sized masks.&quot;&quot;&quot;</span>
        <span class="s1">expected_points = []</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">61</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">60</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>

            <span class="s1">points = mask.outline()</span>

            <span class="s1">self.assertListEqual(points</span><span class="s0">, </span><span class="s1">expected_points</span><span class="s0">,</span>
                                 <span class="s5">'size={}'</span><span class="s1">.format(size))</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_outline__with_arg(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures outline correctly handles zero sized masks 
        when using the skip pixels argument.&quot;&quot;&quot;</span>
        <span class="s1">expected_points = []</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">66</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">65</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>

            <span class="s1">points = mask.outline(</span><span class="s2">10</span><span class="s1">)</span>

            <span class="s1">self.assertListEqual(points</span><span class="s0">, </span><span class="s1">expected_points</span><span class="s0">,</span>
                                 <span class="s5">'size={}'</span><span class="s1">.format(size))</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_convolve(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures convolve correctly handles zero sized masks. 
 
        Tests the different combinations of sized and zero sized masks. 
        &quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">size1 </span><span class="s0">in </span><span class="s1">((</span><span class="s2">17</span><span class="s0">, </span><span class="s2">13</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">71</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">70</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask1 = pygame.mask.Mask(size1</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>

            <span class="s0">for </span><span class="s1">size2 </span><span class="s0">in </span><span class="s1">((</span><span class="s2">11</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">81</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">60</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
                <span class="s1">msg = </span><span class="s5">'sizes={}, {}'</span><span class="s1">.format(size1</span><span class="s0">, </span><span class="s1">size2)</span>
                <span class="s1">mask2 = pygame.mask.Mask(size2</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
                <span class="s1">expected_size = (max(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">size1[</span><span class="s2">0</span><span class="s1">] + size2[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">1</span><span class="s1">)</span><span class="s0">,</span>
                                 <span class="s1">max(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">size1[</span><span class="s2">1</span><span class="s1">] + size2[</span><span class="s2">1</span><span class="s1">] - </span><span class="s2">1</span><span class="s1">))</span>

                <span class="s1">mask = mask1.convolve(mask2)</span>

                <span class="s1">self.assertIsNot(mask</span><span class="s0">, </span><span class="s1">mask2</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_convolve__with_output_mask(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures convolve correctly handles zero sized masks 
        when using an output mask argument. 
 
        Tests the different combinations of sized and zero sized masks. 
        &quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">size1 </span><span class="s0">in </span><span class="s1">((</span><span class="s2">11</span><span class="s0">, </span><span class="s2">17</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">91</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">90</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask1 = pygame.mask.Mask(size1</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>

            <span class="s0">for </span><span class="s1">size2 </span><span class="s0">in </span><span class="s1">((</span><span class="s2">13</span><span class="s0">, </span><span class="s2">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">83</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">62</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
                <span class="s1">mask2 = pygame.mask.Mask(size2</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>

                <span class="s0">for </span><span class="s1">output_size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">7</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">71</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">70</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
                    <span class="s1">msg = </span><span class="s5">'sizes={}, {}, {}'</span><span class="s1">.format(size1</span><span class="s0">, </span><span class="s1">size2</span><span class="s0">, </span><span class="s1">output_size)</span>
                    <span class="s1">output_mask = pygame.mask.Mask(output_size)</span>

                    <span class="s1">mask = mask1.convolve(mask2</span><span class="s0">, </span><span class="s1">output_mask)</span>

                    <span class="s1">self.assertIs(mask</span><span class="s0">, </span><span class="s1">output_mask</span><span class="s0">, </span><span class="s1">msg)</span>
                    <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">output_size</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_connected_component(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures connected_component correctly handles zero sized masks.&quot;&quot;&quot;</span>
        <span class="s1">expected_count = </span><span class="s2">0</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">81</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">80</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>

            <span class="s1">cc_mask = mask.connected_component()</span>

            <span class="s1">self.assertEqual(cc_mask.get_size()</span><span class="s0">, </span><span class="s1">size)</span>
            <span class="s1">self.assertEqual(cc_mask.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">,</span>
                             <span class="s5">'size={}'</span><span class="s1">.format(size))</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_connected_component__indexed(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures connected_component correctly handles zero sized masks 
        when using an index argument.&quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">91</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">90</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>

            <span class="s0">with </span><span class="s1">self.assertRaises(IndexError):</span>
                <span class="s1">cc_mask = mask.connected_component((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_connected_components(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures connected_components correctly handles zero sized masks.&quot;&quot;&quot;</span>
        <span class="s1">expected_cc_masks = []</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">11</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>

            <span class="s1">cc_masks = mask.connected_components()</span>

            <span class="s1">self.assertListEqual(cc_masks</span><span class="s0">, </span><span class="s1">expected_cc_masks</span><span class="s0">,</span>
                                 <span class="s5">'size={}'</span><span class="s1">.format(size))</span>

    <span class="s0">def </span><span class="s1">test_zero_mask_get_bounding_rects(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures get_bounding_rects correctly handles zero sized masks.&quot;&quot;&quot;</span>
        <span class="s1">expected_bounding_rects = []</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">21</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask = pygame.mask.Mask(size)</span>

            <span class="s1">bounding_rects = mask.get_bounding_rects()</span>

            <span class="s1">self.assertListEqual(bounding_rects</span><span class="s0">, </span><span class="s1">expected_bounding_rects</span><span class="s0">,</span>
                                 <span class="s5">'size={}'</span><span class="s1">.format(size))</span>


<span class="s0">class </span><span class="s1">MaskModuleTest(unittest.TestCase):</span>
    <span class="s4"># The @unittest.expectedFailure decorator can be removed when issue #897</span>
    <span class="s4"># is fixed.</span>
    <span class="s1">@unittest.expectedFailure</span>
    <span class="s0">def </span><span class="s1">test_from_surface(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures from_surface creates a mask with the correct bits set. 
 
        This test checks the masks created by the from_surface function using 
        16 and 32 bit surfaces. Each alpha value (0-255) is tested against 
        several different threshold values. 
        Note: On 16 bit surface the requested alpha value can differ from what 
              is actually set. This test uses the value read from the surface. 
        &quot;&quot;&quot;</span>
        <span class="s1">threshold_count = </span><span class="s2">256</span>
        <span class="s1">surface_color = [</span><span class="s2">55</span><span class="s0">, </span><span class="s2">155</span><span class="s0">, </span><span class="s2">255</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span>
        <span class="s1">expected_size = (</span><span class="s2">11</span><span class="s0">, </span><span class="s2">9</span><span class="s1">)</span>
        <span class="s1">all_set_count = expected_size[</span><span class="s2">0</span><span class="s1">] * expected_size[</span><span class="s2">1</span><span class="s1">]</span>
        <span class="s1">none_set_count = </span><span class="s2">0</span>

        <span class="s0">for </span><span class="s1">depth </span><span class="s0">in </span><span class="s1">(</span><span class="s2">16</span><span class="s0">, </span><span class="s2">32</span><span class="s1">):</span>
            <span class="s1">surface = pygame.Surface(expected_size</span><span class="s0">, </span><span class="s1">SRCALPHA</span><span class="s0">, </span><span class="s1">depth)</span>

            <span class="s0">for </span><span class="s1">alpha </span><span class="s0">in </span><span class="s1">range(threshold_count):</span>
                <span class="s1">surface_color[</span><span class="s2">3</span><span class="s1">] = alpha</span>
                <span class="s1">surface.fill(surface_color)</span>

                <span class="s0">if </span><span class="s1">depth &lt; </span><span class="s2">32</span><span class="s1">:</span>
                    <span class="s4"># On surfaces with depths &lt; 32 the requested alpha can be</span>
                    <span class="s4"># different than what gets set. Use the value read from the</span>
                    <span class="s4"># surface.</span>
                    <span class="s1">alpha = surface.get_at((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))[</span><span class="s2">3</span><span class="s1">]</span>

                <span class="s4"># Test the mask created at threshold values low, high and</span>
                <span class="s4"># around alpha.</span>
                <span class="s1">threshold_test_values = set(</span>
                    <span class="s1">[-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">alpha - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">alpha</span><span class="s0">, </span><span class="s1">alpha + </span><span class="s2">1</span><span class="s0">, </span><span class="s2">255</span><span class="s0">, </span><span class="s2">256</span><span class="s1">])</span>

                <span class="s0">for </span><span class="s1">threshold </span><span class="s0">in </span><span class="s1">threshold_test_values:</span>
                    <span class="s1">msg = </span><span class="s5">'depth={}, alpha={}, threshold={}'</span><span class="s1">.format(</span>
                        <span class="s1">depth</span><span class="s0">, </span><span class="s1">alpha</span><span class="s0">, </span><span class="s1">threshold)</span>

                    <span class="s0">if </span><span class="s1">alpha &gt; threshold:</span>
                        <span class="s1">expected_count = all_set_count</span>
                    <span class="s0">else</span><span class="s1">:</span>
                        <span class="s1">expected_count = none_set_count</span>

                    <span class="s1">mask = pygame.mask.from_surface(surface</span><span class="s0">, </span><span class="s1">threshold)</span>

                    <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>
                    <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">test_from_surface__different_alphas_32bit(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures from_surface creates a mask with the correct bits set 
        when pixels have different alpha values (32 bits surfaces). 
 
        This test checks the masks created by the from_surface function using 
        a 32 bit surface. The surface is created with each pixel having a 
        different alpha value (0-255). This surface is tested over a range 
        of threshold values (0-255). 
        &quot;&quot;&quot;</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">threshold_count = </span><span class="s2">256</span>
        <span class="s1">surface_color = [</span><span class="s2">10</span><span class="s0">, </span><span class="s2">20</span><span class="s0">, </span><span class="s2">30</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span>
        <span class="s1">expected_size = (threshold_count</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">expected_mask = pygame.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">surface = pygame.Surface(expected_size</span><span class="s0">, </span><span class="s1">SRCALPHA</span><span class="s0">, </span><span class="s2">32</span><span class="s1">)</span>

        <span class="s4"># Give each pixel a different alpha.</span>
        <span class="s1">surface.lock()  </span><span class="s4"># Lock for possible speed up.</span>
        <span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">range(threshold_count):</span>
            <span class="s1">surface_color[</span><span class="s2">3</span><span class="s1">] = a</span>
            <span class="s1">surface.set_at((a</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">surface_color)</span>
        <span class="s1">surface.unlock()</span>

        <span class="s4"># Test the mask created for each different alpha threshold.</span>
        <span class="s0">for </span><span class="s1">threshold </span><span class="s0">in </span><span class="s1">range(threshold_count):</span>
            <span class="s1">msg = </span><span class="s5">'threshold={}'</span><span class="s1">.format(threshold)</span>
            <span class="s1">expected_mask.set_at((threshold</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
            <span class="s1">expected_count = expected_mask.count()</span>

            <span class="s1">mask = pygame.mask.from_surface(surface</span><span class="s0">, </span><span class="s1">threshold)</span>

            <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>
            <span class="s1">self.assertEqual(mask.overlap_area(expected_mask</span><span class="s0">, </span><span class="s1">offset)</span><span class="s0">,</span>
                             <span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s4"># The @unittest.expectedFailure decorator can be removed when issue #897</span>
    <span class="s4"># is fixed.</span>
    <span class="s1">@unittest.expectedFailure</span>
    <span class="s0">def </span><span class="s1">test_from_surface__different_alphas_16bit(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures from_surface creates a mask with the correct bits set 
        when pixels have different alpha values (16 bit surfaces). 
 
        This test checks the masks created by the from_surface function using 
        a 16 bit surface. Each pixel of the surface is set with a different 
        alpha value (0-255), but since this is a 16 bit surface the requested 
        alpha value can differ from what is actually set. The resulting surface 
        will have groups of alpha values which complicates the test as the 
        alpha groups will all be set/unset at a given threshold. The setup 
        calculates these groups and an expected mask for each. This test data 
        is then used to test each alpha grouping over a range of threshold 
        values. 
        &quot;&quot;&quot;</span>
        <span class="s1">threshold_count = </span><span class="s2">256</span>
        <span class="s1">surface_color = [</span><span class="s2">110</span><span class="s0">, </span><span class="s2">120</span><span class="s0">, </span><span class="s2">130</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span>
        <span class="s1">expected_size = (threshold_count</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">surface = pygame.Surface(expected_size</span><span class="s0">, </span><span class="s1">SRCALPHA</span><span class="s0">, </span><span class="s2">16</span><span class="s1">)</span>

        <span class="s4"># Give each pixel a different alpha.</span>
        <span class="s1">surface.lock()  </span><span class="s4"># Lock for possible speed up.</span>
        <span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">range(threshold_count):</span>
            <span class="s1">surface_color[</span><span class="s2">3</span><span class="s1">] = a</span>
            <span class="s1">surface.set_at((a</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">surface_color)</span>
        <span class="s1">surface.unlock()</span>

        <span class="s1">alpha_thresholds = OrderedDict()</span>
        <span class="s1">special_thresholds = set()</span>

        <span class="s4"># Create the threshold ranges and identify any thresholds that need</span>
        <span class="s4"># special handling.</span>
        <span class="s0">for </span><span class="s1">threshold </span><span class="s0">in </span><span class="s1">range(threshold_count):</span>
            <span class="s4"># On surfaces with depths &lt; 32 the requested alpha can be different</span>
            <span class="s4"># than what gets set. Use the value read from the surface.</span>
            <span class="s1">alpha = surface.get_at((threshold</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))[</span><span class="s2">3</span><span class="s1">]</span>

            <span class="s0">if </span><span class="s1">alpha </span><span class="s0">not in </span><span class="s1">alpha_thresholds:</span>
                <span class="s1">alpha_thresholds[alpha] = [threshold]</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">alpha_thresholds[alpha].append(threshold)</span>

            <span class="s0">if </span><span class="s1">threshold &lt; alpha:</span>
                <span class="s1">special_thresholds.add(threshold)</span>

        <span class="s4"># Use each threshold group to create an expected mask.</span>
        <span class="s1">test_data = []  </span><span class="s4"># [(from_threshold, to_threshold, expected_mask), ...]</span>
        <span class="s1">offset = (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">erase_mask = pygame.Mask(expected_size)</span>
        <span class="s1">exp_mask = pygame.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s0">for </span><span class="s1">thresholds </span><span class="s0">in </span><span class="s1">alpha_thresholds.values():</span>
            <span class="s0">for </span><span class="s1">threshold </span><span class="s0">in </span><span class="s1">thresholds:</span>
                <span class="s0">if </span><span class="s1">threshold </span><span class="s0">in </span><span class="s1">special_thresholds:</span>
                    <span class="s4"># Any special thresholds just reuse previous exp_mask.</span>
                    <span class="s1">test_data.append((threshold</span><span class="s0">, </span><span class="s1">threshold + </span><span class="s2">1</span><span class="s0">, </span><span class="s1">exp_mask))</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">to_threshold = thresholds[-</span><span class="s2">1</span><span class="s1">] + </span><span class="s2">1</span>

                    <span class="s4"># Make the expected mask by erasing the unset bits.</span>
                    <span class="s0">for </span><span class="s1">thres </span><span class="s0">in </span><span class="s1">range(to_threshold):</span>
                        <span class="s1">erase_mask.set_at((thres</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

                    <span class="s1">exp_mask = pygame.Mask(expected_size</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
                    <span class="s1">exp_mask.erase(erase_mask</span><span class="s0">, </span><span class="s1">offset)</span>
                    <span class="s1">test_data.append((threshold</span><span class="s0">, </span><span class="s1">to_threshold</span><span class="s0">, </span><span class="s1">exp_mask))</span>
                    <span class="s0">break</span>

        <span class="s4"># All the setup is done. Now test the masks created over the threshold</span>
        <span class="s4"># ranges.</span>
        <span class="s0">for </span><span class="s1">from_threshold</span><span class="s0">, </span><span class="s1">to_threshold</span><span class="s0">, </span><span class="s1">expected_mask </span><span class="s0">in </span><span class="s1">test_data:</span>
            <span class="s1">expected_count = expected_mask.count()</span>

            <span class="s0">for </span><span class="s1">threshold </span><span class="s0">in </span><span class="s1">range(from_threshold</span><span class="s0">, </span><span class="s1">to_threshold):</span>
                <span class="s1">msg = </span><span class="s5">'threshold={}'</span><span class="s1">.format(threshold)</span>

                <span class="s1">mask = pygame.mask.from_surface(surface</span><span class="s0">, </span><span class="s1">threshold)</span>

                <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">expected_size</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>
                <span class="s1">self.assertEqual(mask.overlap_area(expected_mask</span><span class="s0">, </span><span class="s1">offset)</span><span class="s0">,</span>
                                 <span class="s1">expected_count</span><span class="s0">, </span><span class="s1">msg)</span>

    <span class="s0">def </span><span class="s1">todo_test_from_surface__with_colorkey(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures from_surface creates a mask with the correct bits set 
        when the surface uses a colorkey. 
        &quot;&quot;&quot;</span>
        <span class="s1">self.fail()</span>

    <span class="s0">def </span><span class="s1">test_from_threshold(self):</span>
        <span class="s3">&quot;&quot;&quot; Does mask.from_threshold() work correctly? 
        &quot;&quot;&quot;</span>

        <span class="s1">a = [</span><span class="s2">16</span><span class="s0">, </span><span class="s2">24</span><span class="s0">, </span><span class="s2">32</span><span class="s1">]</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">a:</span>
            <span class="s1">surf = pygame.surface.Surface((</span><span class="s2">70</span><span class="s0">,</span><span class="s2">70</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">i)</span>
            <span class="s1">surf.fill((</span><span class="s2">100</span><span class="s0">,</span><span class="s2">50</span><span class="s0">,</span><span class="s2">200</span><span class="s1">)</span><span class="s0">,</span><span class="s1">(</span><span class="s2">20</span><span class="s0">,</span><span class="s2">20</span><span class="s0">,</span><span class="s2">20</span><span class="s0">,</span><span class="s2">20</span><span class="s1">))</span>
            <span class="s1">mask = pygame.mask.from_threshold(surf</span><span class="s0">,</span><span class="s1">(</span><span class="s2">100</span><span class="s0">,</span><span class="s2">50</span><span class="s0">,</span><span class="s2">200</span><span class="s0">,</span><span class="s2">255</span><span class="s1">)</span><span class="s0">,</span><span class="s1">(</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s0">,</span><span class="s2">255</span><span class="s1">))</span>

            <span class="s1">rects = mask.get_bounding_rects()</span>

            <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s2">400</span><span class="s1">)</span>
            <span class="s1">self.assertEqual(mask.get_bounding_rects()</span><span class="s0">, </span><span class="s1">[pygame.Rect((</span><span class="s2">20</span><span class="s0">,</span><span class="s2">20</span><span class="s0">,</span><span class="s2">20</span><span class="s0">,</span><span class="s2">20</span><span class="s1">))])</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">a:</span>
            <span class="s1">surf = pygame.surface.Surface((</span><span class="s2">70</span><span class="s0">,</span><span class="s2">70</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">i)</span>
            <span class="s1">surf2 = pygame.surface.Surface((</span><span class="s2">70</span><span class="s0">,</span><span class="s2">70</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">i)</span>
            <span class="s1">surf.fill((</span><span class="s2">100</span><span class="s0">,</span><span class="s2">100</span><span class="s0">,</span><span class="s2">100</span><span class="s1">))</span>
            <span class="s1">surf2.fill((</span><span class="s2">150</span><span class="s0">,</span><span class="s2">150</span><span class="s0">,</span><span class="s2">150</span><span class="s1">))</span>
            <span class="s1">surf2.fill((</span><span class="s2">100</span><span class="s0">,</span><span class="s2">100</span><span class="s0">,</span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">40</span><span class="s0">,</span><span class="s2">40</span><span class="s0">,</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">))</span>
            <span class="s1">mask = pygame.mask.from_threshold(surf</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s0">,</span><span class="s2">255</span><span class="s1">)</span><span class="s0">, </span><span class="s1">surf2)</span>

            <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span>
            <span class="s1">self.assertEqual(mask.get_bounding_rects()</span><span class="s0">, </span><span class="s1">[pygame.Rect((</span><span class="s2">40</span><span class="s0">,</span><span class="s2">40</span><span class="s0">,</span><span class="s2">10</span><span class="s0">,</span><span class="s2">10</span><span class="s1">))])</span>

    <span class="s0">def </span><span class="s1">test_zero_size_from_surface(self):</span>
        <span class="s3">&quot;&quot;&quot;Ensures from_surface can create masks from zero sized surfaces.&quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)):</span>
            <span class="s1">mask = pygame.mask.from_surface(pygame.Surface(size))</span>

            <span class="s1">self.assertIsInstance(mask</span><span class="s0">, </span><span class="s1">pygame.mask.MaskType</span><span class="s0">,</span>
                                  <span class="s5">'size={}'</span><span class="s1">.format(size))</span>
            <span class="s1">self.assertEqual(mask.get_size()</span><span class="s0">, </span><span class="s1">size)</span>

    <span class="s0">def </span><span class="s1">test_zero_size_from_threshold(self):</span>
        <span class="s1">a = [</span><span class="s2">16</span><span class="s0">, </span><span class="s2">24</span><span class="s0">, </span><span class="s2">32</span><span class="s1">]</span>
        <span class="s1">sizes = ((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">sizes:</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">a:</span>
                <span class="s1">surf = pygame.surface.Surface(size</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">i)</span>
                <span class="s1">surf.fill((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">50</span><span class="s0">, </span><span class="s2">200</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">20</span><span class="s0">, </span><span class="s2">20</span><span class="s0">, </span><span class="s2">20</span><span class="s0">, </span><span class="s2">20</span><span class="s1">))</span>
                <span class="s1">mask = pygame.mask.from_threshold(surf</span><span class="s0">, </span><span class="s1">(</span><span class="s2">100</span><span class="s0">, </span><span class="s2">50</span><span class="s0">, </span><span class="s2">200</span><span class="s0">, </span><span class="s2">255</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">255</span><span class="s1">))</span>

                <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

                <span class="s1">rects = mask.get_bounding_rects()</span>
                <span class="s1">self.assertEqual(rects</span><span class="s0">, </span><span class="s1">[])</span>

            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">a:</span>
                <span class="s1">surf = pygame.surface.Surface(size</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">i)</span>
                <span class="s1">surf2 = pygame.surface.Surface(size</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">i)</span>
                <span class="s1">surf.fill((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">100</span><span class="s0">, </span><span class="s2">100</span><span class="s1">))</span>
                <span class="s1">surf2.fill((</span><span class="s2">150</span><span class="s0">, </span><span class="s2">150</span><span class="s0">, </span><span class="s2">150</span><span class="s1">))</span>
                <span class="s1">surf2.fill((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">100</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">40</span><span class="s0">, </span><span class="s2">40</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>
                <span class="s1">mask = pygame.mask.from_threshold(surf</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">255</span><span class="s1">)</span><span class="s0">, </span><span class="s1">surf2)</span>

                <span class="s1">self.assertEqual(mask.count()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

                <span class="s1">rects = mask.get_bounding_rects()</span>
                <span class="s1">self.assertEqual(rects</span><span class="s0">, </span><span class="s1">[])</span>

<span class="s0">if </span><span class="s1">__name__ == </span><span class="s5">'__main__'</span><span class="s1">:</span>
    <span class="s1">unittest.main()</span>
</pre>
</body>
</html>