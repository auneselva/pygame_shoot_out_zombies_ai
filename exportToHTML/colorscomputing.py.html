<html>
<head>
<title>colorscomputing.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
colorscomputing.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Provides treatment of colors&quot;&quot;&quot;</span>
<span class="s2">import </span><span class="s1">math</span>
<span class="s2">from </span><span class="s1">random </span><span class="s2">import </span><span class="s1">random</span>

<span class="s2">from </span><span class="s1">thorpy._utils.functions </span><span class="s2">import </span><span class="s1">random_sign</span>

<span class="s2">def </span><span class="s1">get_alpha_color(c</span><span class="s2">, </span><span class="s1">alpha=</span><span class="s2">None</span><span class="s1">):</span>
    <span class="s2">if </span><span class="s1">alpha </span><span class="s2">is None</span><span class="s1">:</span>
        <span class="s2">return </span><span class="s1">c</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s2">return </span><span class="s1">(c[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">c[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">c[</span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">alpha)</span>

<span class="s2">def </span><span class="s1">to_rgba(color):</span>
    <span class="s2">if </span><span class="s1">len(color) == </span><span class="s3">3</span><span class="s1">:</span>
        <span class="s2">return </span><span class="s1">(color[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">color[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">color[</span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s3">255</span><span class="s1">)</span>
    <span class="s2">elif </span><span class="s1">len(color) == </span><span class="s3">4</span><span class="s1">:</span>
        <span class="s2">return </span><span class="s1">color</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s2">raise </span><span class="s1">Exception(</span><span class="s4">&quot;Invalid color argument&quot;</span><span class="s1">)</span>

<span class="s2">def </span><span class="s1">make_compatible(c1</span><span class="s2">, </span><span class="s1">c2):</span>
    <span class="s0">&quot;&quot;&quot;Adapt c1 to c2&quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">len(c1) &lt; len(c2):</span>
        <span class="s2">return </span><span class="s1">to_rgba(c1)</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s2">return </span><span class="s1">c1</span>

<span class="s2">def </span><span class="s1">normalize_color(c):</span>
    <span class="s1">colors = [int(c[</span><span class="s3">0</span><span class="s1">])</span><span class="s2">, </span><span class="s1">int(c[</span><span class="s3">1</span><span class="s1">])</span><span class="s2">, </span><span class="s1">int(c[</span><span class="s3">2</span><span class="s1">])]</span>
    <span class="s2">for </span><span class="s1">(i</span><span class="s2">, </span><span class="s1">color) </span><span class="s2">in </span><span class="s1">enumerate(colors):</span>
        <span class="s2">if </span><span class="s1">color &lt; </span><span class="s3">0</span><span class="s1">:</span>
            <span class="s1">colors[i] = </span><span class="s3">0</span>
        <span class="s2">elif </span><span class="s1">color &gt; </span><span class="s3">255</span><span class="s1">:</span>
            <span class="s1">colors[i] = </span><span class="s3">255</span>
    <span class="s2">return </span><span class="s1">colors</span>


<span class="s2">def </span><span class="s1">get_random_color(basis</span><span class="s2">, </span><span class="s1">mask):</span>
    <span class="s0">&quot;&quot;&quot;For example, if mask[0] = 12, the red component of the color si in the 
    range [basis[0] - mask, basis[0] + mask] 
    &quot;&quot;&quot;</span>
    <span class="s1">r = basis[</span><span class="s3">0</span><span class="s1">] + random_sign() * random() * mask[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">g = basis[</span><span class="s3">1</span><span class="s1">] + random_sign() * random() * mask[</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">b = basis[</span><span class="s3">2</span><span class="s1">] + random_sign() * random() * mask[</span><span class="s3">2</span><span class="s1">]</span>
    <span class="s2">return </span><span class="s1">normalize_color((r</span><span class="s2">, </span><span class="s1">g</span><span class="s2">, </span><span class="s1">b))</span>

<span class="s2">def </span><span class="s1">square_color_norm(c):</span>
    <span class="s2">return </span><span class="s1">c[</span><span class="s3">0</span><span class="s1">]**</span><span class="s3">2 </span><span class="s1">+ c[</span><span class="s3">1</span><span class="s1">]**</span><span class="s3">2 </span><span class="s1">+ c[</span><span class="s3">2</span><span class="s1">]**</span><span class="s3">2</span>

<span class="s2">def </span><span class="s1">color_norm(c):</span>
    <span class="s2">return </span><span class="s1">math.sqrt(square_color_norm(c))</span>

<span class="s2">def </span><span class="s1">lightness(c):</span>
    <span class="s2">return </span><span class="s1">(max(c) + min(c)) / </span><span class="s3">2</span>

<span class="s2">def </span><span class="s1">color_average(c):</span>
    <span class="s2">return </span><span class="s1">sum(c) / </span><span class="s3">3</span>

<span class="s2">def </span><span class="s1">luminosity(c):</span>
    <span class="s2">return </span><span class="s3">0.21</span><span class="s1">*c[</span><span class="s3">0</span><span class="s1">] + </span><span class="s3">0.72</span><span class="s1">*c[</span><span class="s3">1</span><span class="s1">] + </span><span class="s3">0.07</span><span class="s1">*c[</span><span class="s3">2</span><span class="s1">]</span>

<span class="s2">def </span><span class="s1">dot_product(v1</span><span class="s2">, </span><span class="s1">v2):</span>
    <span class="s0">&quot;&quot;&quot;Returns the dot product of two vectors that are modeled as dicts&quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">v1[</span><span class="s3">0</span><span class="s1">] * v2[</span><span class="s3">0</span><span class="s1">] + v1[</span><span class="s3">1</span><span class="s1">] * v2[</span><span class="s3">1</span><span class="s1">] + v1[</span><span class="s3">2</span><span class="s1">] * v2[</span><span class="s3">2</span><span class="s1">]</span>

<span class="s2">def </span><span class="s1">cosine_similarity(v1</span><span class="s2">, </span><span class="s1">v2):</span>
    <span class="s0">&quot;&quot;&quot;Returns the cos similarity of two vectors that are modeled as dicts&quot;&quot;&quot;</span>
    <span class="s1">n1 = color_norm(v1)</span>
    <span class="s1">n2 = color_norm(v2)</span>
    <span class="s2">if </span><span class="s1">n1 &gt; </span><span class="s3">0. </span><span class="s2">and </span><span class="s1">n2 &gt; </span><span class="s3">0.</span><span class="s1">:</span>
        <span class="s1">product = dot_product(v1</span><span class="s2">, </span><span class="s1">v2)</span>
        <span class="s1">normalization = n1 * n2</span>
        <span class="s2">return </span><span class="s1">product / normalization</span>
    <span class="s2">else</span><span class="s1">:</span>
<span class="s5">##        return float(n1 == n2)</span>
        <span class="s2">return </span><span class="s3">0.</span>

<span class="s2">def </span><span class="s1">different_color(c):</span>
    <span class="s2">return </span><span class="s1">(c[</span><span class="s3">0</span><span class="s1">] + </span><span class="s3">10</span><span class="s2">, </span><span class="s1">c[</span><span class="s3">1</span><span class="s1">] + </span><span class="s3">10</span><span class="s2">, </span><span class="s1">c[</span><span class="s3">2</span><span class="s1">] + </span><span class="s3">10</span><span class="s1">)</span>

<span class="s2">def </span><span class="s1">negative_color(c):</span>
    <span class="s1">r = (c[</span><span class="s3">0</span><span class="s1">] + </span><span class="s3">127</span><span class="s1">) % </span><span class="s3">256</span>
    <span class="s1">g = (c[</span><span class="s3">1</span><span class="s1">] + </span><span class="s3">127</span><span class="s1">) % </span><span class="s3">256</span>
    <span class="s1">b = (c[</span><span class="s3">2</span><span class="s1">] + </span><span class="s3">127</span><span class="s1">) % </span><span class="s3">256</span>
    <span class="s2">return </span><span class="s1">(r</span><span class="s2">, </span><span class="s1">g</span><span class="s2">, </span><span class="s1">b)</span>

<span class="s2">def </span><span class="s1">is_gray(c):</span>
    <span class="s2">return </span><span class="s1">(c[</span><span class="s3">0</span><span class="s1">] == c[</span><span class="s3">1</span><span class="s1">] == c[</span><span class="s3">2</span><span class="s1">])</span>

<span class="s2">def </span><span class="s1">mid_color(c1</span><span class="s2">, </span><span class="s1">c2):</span>
    <span class="s0">&quot;&quot;&quot;Returns medium color between c1 and c2&quot;&quot;&quot;</span>
    <span class="s1">r = int(</span><span class="s3">0.5 </span><span class="s1">* (c1[</span><span class="s3">0</span><span class="s1">] + c2[</span><span class="s3">0</span><span class="s1">]))</span>
    <span class="s1">g = int(</span><span class="s3">0.5 </span><span class="s1">* (c1[</span><span class="s3">1</span><span class="s1">] + c2[</span><span class="s3">1</span><span class="s1">]))</span>
    <span class="s1">b = int(</span><span class="s3">0.5 </span><span class="s1">* (c1[</span><span class="s3">2</span><span class="s1">] + c2[</span><span class="s3">2</span><span class="s1">]))</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">a = int(</span><span class="s3">0.5 </span><span class="s1">* (c1[</span><span class="s3">3</span><span class="s1">] + c2[</span><span class="s3">3</span><span class="s1">]))</span>
        <span class="s2">return </span><span class="s1">(r</span><span class="s2">, </span><span class="s1">g</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">a)</span>
    <span class="s2">except </span><span class="s1">IndexError:</span>
        <span class="s2">return </span><span class="s1">(r</span><span class="s2">, </span><span class="s1">g</span><span class="s2">, </span><span class="s1">b)</span>

<span class="s2">def </span><span class="s1">linear_combination(c1</span><span class="s2">, </span><span class="s1">c2</span><span class="s2">, </span><span class="s1">k1):</span>
    <span class="s0">&quot;&quot;&quot;Returns medium color between c1 and c2&quot;&quot;&quot;</span>
    <span class="s1">k2 = </span><span class="s3">1. </span><span class="s1">- k1</span>
    <span class="s1">r = int(k1*c1[</span><span class="s3">0</span><span class="s1">] + k2*c2[</span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">g = int(k1*c1[</span><span class="s3">1</span><span class="s1">] + k2*c2[</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">b = int(k1*c1[</span><span class="s3">2</span><span class="s1">] + k2*c2[</span><span class="s3">2</span><span class="s1">])</span>
    <span class="s2">return </span><span class="s1">(r</span><span class="s2">,</span><span class="s1">g</span><span class="s2">,</span><span class="s1">b)</span>

<span class="s2">def </span><span class="s1">linear_combination_rgba(c1</span><span class="s2">, </span><span class="s1">c2</span><span class="s2">, </span><span class="s1">k1):</span>
    <span class="s0">&quot;&quot;&quot;Returns medium color between c1 and c2&quot;&quot;&quot;</span>
    <span class="s1">k2 = </span><span class="s3">1. </span><span class="s1">- k1</span>
    <span class="s1">r = int(k1*c1[</span><span class="s3">0</span><span class="s1">] + k2*c2[</span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">g = int(k1*c1[</span><span class="s3">1</span><span class="s1">] + k2*c2[</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">b = int(k1*c1[</span><span class="s3">2</span><span class="s1">] + k2*c2[</span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">a = int(k1*c1[</span><span class="s3">3</span><span class="s1">] + k2*c2[</span><span class="s3">3</span><span class="s1">])</span>
    <span class="s2">return </span><span class="s1">(r</span><span class="s2">,</span><span class="s1">g</span><span class="s2">,</span><span class="s1">b)</span>

<span class="s2">def </span><span class="s1">difference(c1</span><span class="s2">, </span><span class="s1">c2):</span>
    <span class="s2">return </span><span class="s1">(c1[</span><span class="s3">0</span><span class="s1">] - c2[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">c1[</span><span class="s3">1</span><span class="s1">] - c2[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">c1[</span><span class="s3">2</span><span class="s1">] - c2[</span><span class="s3">2</span><span class="s1">])</span>

<span class="s2">def </span><span class="s1">grow_color(factor</span><span class="s2">, </span><span class="s1">color):</span>
    <span class="s0">&quot;&quot;&quot;grow a color&quot;&quot;&quot;</span>
    <span class="s1">red = factor * color[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">green = factor * color[</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">blue = factor * color[</span><span class="s3">2</span><span class="s1">]</span>
    <span class="s2">return </span><span class="s1">(red</span><span class="s2">, </span><span class="s1">green</span><span class="s2">, </span><span class="s1">blue)</span>

<span class="s1">scale_color = grow_color</span>

<span class="s2">def </span><span class="s1">multiply_colors(c1</span><span class="s2">, </span><span class="s1">c2):</span>
    <span class="s2">return </span><span class="s1">(c1[</span><span class="s3">0</span><span class="s1">] * c2[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">c1[</span><span class="s3">1</span><span class="s1">] * c2[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">c1[</span><span class="s3">2</span><span class="s1">] * c2[</span><span class="s3">2</span><span class="s1">])</span>


<span class="s2">class </span><span class="s1">LinearInterpolation:</span>
    <span class="s0">&quot;&quot;&quot;Liner interpolation&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">, </span><span class="s1">vals):</span>
        <span class="s1">self.parts = len(vals) - </span><span class="s3">1</span>
        <span class="s1">self.vals = vals</span>
        <span class="s1">self.build_functions()</span>
        <span class="s1">self.last_val = self.get_last_val()</span>
        <span class="s1">self.first_val = self.get_first_val()</span>

    <span class="s2">def </span><span class="s1">build_function(self</span><span class="s2">, </span><span class="s1">couple1</span><span class="s2">, </span><span class="s1">couple2):</span>
        <span class="s1">gradient = (couple2[</span><span class="s3">1</span><span class="s1">] - couple1[</span><span class="s3">1</span><span class="s1">]) / (couple2[</span><span class="s3">0</span><span class="s1">] - couple1[</span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">y_intercept = couple1[</span><span class="s3">1</span><span class="s1">] - gradient * couple1[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s2">return </span><span class="s1">(gradient</span><span class="s2">, </span><span class="s1">y_intercept)</span>

    <span class="s2">def </span><span class="s1">build_functions(self):</span>
        <span class="s1">self.funcs = list()</span>
        <span class="s1">length = len(self.vals)</span>
        <span class="s2">if </span><span class="s1">length == </span><span class="s3">1</span><span class="s1">: </span><span class="s5">#funcs is a single constant function</span>
            <span class="s1">self.funcs.append((</span><span class="s3">0</span><span class="s2">, </span><span class="s1">self.vals[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(length-</span><span class="s3">1</span><span class="s1">):</span>
                <span class="s1">func = self.build_function(self.vals[i]</span><span class="s2">, </span><span class="s1">self.vals[i+</span><span class="s3">1</span><span class="s1">])</span>
                <span class="s1">self.funcs.append(func)</span>

<span class="s5">##    def which_i(self, x_value):</span>
<span class="s5">##        i = 0</span>
<span class="s5">##        for couple in self.vals:</span>
<span class="s5">##            if couple &lt; x_value:</span>
<span class="s5">##                return i - 1</span>
<span class="s5">##            else:</span>
<span class="s5">##                i += 1</span>
<span class="s5">##        return -1</span>

    <span class="s2">def </span><span class="s1">which_i(self</span><span class="s2">, </span><span class="s1">x_value):</span>
        <span class="s2">if </span><span class="s1">self.vals[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">0</span><span class="s1">] &gt;= x_value:</span>
            <span class="s2">return </span><span class="s1">-</span><span class="s3">1</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(len(self.vals)):</span>
                <span class="s2">if </span><span class="s1">x_value &lt; self.vals[i][</span><span class="s3">0</span><span class="s1">]:</span>
                    <span class="s2">return </span><span class="s1">i - </span><span class="s3">1</span>
            <span class="s2">return </span><span class="s1">-</span><span class="s3">2</span>


<span class="s5">##    def which_i(self, x_value):</span>
<span class="s5">##        i = 0</span>
<span class="s5">##        while(x_value &gt; self.vals[i][0]):</span>
<span class="s5">##            if i+2 &gt;= len(self.vals):</span>
<span class="s5">##                i = -1</span>
<span class="s5">##                break</span>
<span class="s5">##            i += 1</span>
<span class="s5">##        return i</span>

    <span class="s2">def </span><span class="s1">get_last_val(self):</span>
        <span class="s2">return </span><span class="s1">self.vals[len(self.vals)-</span><span class="s3">1</span><span class="s1">][</span><span class="s3">1</span><span class="s1">]</span>

    <span class="s2">def </span><span class="s1">get_first_val(self):</span>
        <span class="s2">return </span><span class="s1">self.vals[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">]</span>

    <span class="s2">def </span><span class="s1">evaluate(self</span><span class="s2">, </span><span class="s1">x_value):</span>
        <span class="s1">i = self.which_i(x_value)</span>
        <span class="s2">if </span><span class="s1">i == -</span><span class="s3">1</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s1">self.first_val</span>
        <span class="s2">elif </span><span class="s1">i == -</span><span class="s3">2</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s1">self.last_val</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s1">self.funcs[i][</span><span class="s3">0</span><span class="s1">] * x_value + self.funcs[i][</span><span class="s3">1</span><span class="s1">]</span>



<span class="s2">class </span><span class="s1">LinearColorRule:</span>
    <span class="s0">&quot;&quot;&quot;Perform transformation from number to color&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">, </span><span class="s1">interpols=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s2">if not </span><span class="s1">interpols:</span>
            <span class="s1">r = LinearInterpolation([(</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1.</span><span class="s2">, </span><span class="s3">255</span><span class="s1">)])</span>
            <span class="s1">g = LinearInterpolation([(</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">255</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)])</span>
            <span class="s1">b = LinearInterpolation([(</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">255</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)])</span>
            <span class="s1">self.interpols = (r</span><span class="s2">, </span><span class="s1">g</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">self.interpols = interpols</span>

    <span class="s2">def </span><span class="s1">get_color(self</span><span class="s2">, </span><span class="s1">value):</span>
        <span class="s1">r = self.interpols[</span><span class="s3">0</span><span class="s1">].evaluate(value)</span>
        <span class="s1">g = self.interpols[</span><span class="s3">1</span><span class="s1">].evaluate(value)</span>
        <span class="s1">b = self.interpols[</span><span class="s3">2</span><span class="s1">].evaluate(value)</span>
        <span class="s2">return </span><span class="s1">(r</span><span class="s2">, </span><span class="s1">g</span><span class="s2">, </span><span class="s1">b)</span></pre>
</body>
</html>