<html>
<head>
<title>ui_tool_tip.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ui_tool_tip.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Union</span><span class="s0">, </span><span class="s1">Tuple</span><span class="s0">, </span><span class="s1">Dict</span><span class="s0">, </span><span class="s1">Optional</span>

<span class="s0">import </span><span class="s1">pygame</span>

<span class="s0">from </span><span class="s1">pygame_gui.core </span><span class="s0">import </span><span class="s1">ObjectID</span>
<span class="s0">from </span><span class="s1">pygame_gui.core.interfaces </span><span class="s0">import </span><span class="s1">IUIManagerInterface</span><span class="s0">, </span><span class="s1">IUITooltipInterface</span>
<span class="s0">from </span><span class="s1">pygame_gui.core.ui_element </span><span class="s0">import </span><span class="s1">UIElement</span>

<span class="s0">from </span><span class="s1">pygame_gui.elements.ui_text_box </span><span class="s0">import </span><span class="s1">UITextBox</span>


<span class="s0">class </span><span class="s1">UITooltip(UIElement</span><span class="s0">, </span><span class="s1">IUITooltipInterface):</span>
    <span class="s2">&quot;&quot;&quot; 
    A tool tip is a floating block of text that gives additional information after a user hovers 
    over an interactive part of a GUI for a short time. In Pygame GUI the tooltip's text is 
    style-able with HTML. 
 
    At the moment the tooltips are only available as an option on UIButton elements. 
 
    Tooltips also don't allow a container as they are designed to overlap normal UI boundaries and 
    be contained only within the 'root' window/container, which is synonymous with the pygame 
    display surface. 
 
    :param html_text: Text styled with HTML, to be displayed on the tooltip. 
    :param hover_distance: Distance in pixels between the tooltip and the thing being hovered. 
    :param manager: The UIManager that manages this element. 
    :param parent_element: The element this element 'belongs to' in the theming hierarchy. 
    :param object_id: A custom defined ID for fine tuning of theming. 
    :param anchors: A dictionary describing what this element's relative_rect is relative to. 
 
    &quot;&quot;&quot;</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">,</span>
                 <span class="s1">html_text: str</span><span class="s0">,</span>
                 <span class="s1">hover_distance: Tuple[int</span><span class="s0">, </span><span class="s1">int]</span><span class="s0">,</span>
                 <span class="s1">manager: IUIManagerInterface</span><span class="s0">,</span>
                 <span class="s1">parent_element: UIElement = </span><span class="s0">None,</span>
                 <span class="s1">object_id: Union[ObjectID</span><span class="s0">, </span><span class="s1">str</span><span class="s0">, None</span><span class="s1">] = </span><span class="s0">None,</span>
                 <span class="s1">anchors: Dict[str</span><span class="s0">, </span><span class="s1">str] = </span><span class="s0">None</span><span class="s1">):</span>

        <span class="s1">super().__init__(relative_rect=pygame.Rect((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">))</span><span class="s0">,</span>
                         <span class="s1">manager=manager</span><span class="s0">,</span>
                         <span class="s1">container=</span><span class="s0">None,</span>
                         <span class="s1">starting_height=manager.get_sprite_group().get_top_layer()+</span><span class="s3">1</span><span class="s0">,</span>
                         <span class="s1">layer_thickness=</span><span class="s3">1</span><span class="s0">,</span>
                         <span class="s1">anchors=anchors)</span>

        <span class="s1">self._create_valid_ids(container=</span><span class="s0">None,</span>
                               <span class="s1">parent_element=parent_element</span><span class="s0">,</span>
                               <span class="s1">object_id=object_id</span><span class="s0">,</span>
                               <span class="s1">element_id=</span><span class="s4">'tool_tip'</span><span class="s1">)</span>

        <span class="s1">self.text_block = </span><span class="s0">None</span>
        <span class="s1">self.rect_width = </span><span class="s0">None  </span><span class="s5"># type: Optional[int]</span>
        <span class="s1">self.hover_distance_from_target = hover_distance</span>

        <span class="s1">self.rebuild_from_changed_theme_data()</span>

        <span class="s1">self.text_block = UITextBox(html_text</span><span class="s0">,</span>
                                    <span class="s1">pygame.Rect(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">self.rect_width</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                                    <span class="s1">manager=self.ui_manager</span><span class="s0">,</span>
                                    <span class="s1">layer_starting_height=self._layer</span><span class="s0">,</span>
                                    <span class="s1">parent_element=self)</span>

        <span class="s1">self.rect_width = self.text_block.rect.size[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">super().set_dimensions(self.text_block.rect.size)</span>

        <span class="s1">self.set_image(self.ui_manager.get_universal_empty_surface())</span>

    <span class="s0">def </span><span class="s1">rebuild(self):</span>
        <span class="s2">&quot;&quot;&quot; 
        Rebuild anything that might need rebuilding. 
 
        &quot;&quot;&quot;</span>
        <span class="s1">self.set_image(self.ui_manager.get_universal_empty_surface())</span>

        <span class="s0">if </span><span class="s1">self.text_block </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">self.text_block.set_dimensions((self.rect_width</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">))</span>

            <span class="s1">self.relative_rect.height = self.text_block.rect.height</span>
            <span class="s1">self.relative_rect.width = self.text_block.rect.width</span>
            <span class="s1">self.rect.width = self.text_block.rect.width</span>
            <span class="s1">self.rect.height = self.text_block.rect.height</span>

    <span class="s0">def </span><span class="s1">kill(self):</span>
        <span class="s2">&quot;&quot;&quot; 
        Overrides the UIElement's default kill method to also kill the text block element that 
        helps make up the complete tool tip. 
        &quot;&quot;&quot;</span>
        <span class="s1">self.text_block.kill()</span>
        <span class="s1">super().kill()</span>

    <span class="s0">def </span><span class="s1">find_valid_position(self</span><span class="s0">, </span><span class="s1">position: pygame.math.Vector2) -&gt; bool:</span>
        <span class="s2">&quot;&quot;&quot; 
        Finds a valid position for the tool tip inside the root container of the UI. 
 
        The algorithm starts from the position of the target we are providing a tool tip for then it 
        tries to fit the rectangle for the tool tip onto the screen by moving it above, below, to 
        the left and to the right, until we find a position that fits the whole tooltip rectangle 
        on the screen at once. 
 
        If we fail to manage this then the method will return False. Otherwise it returns True and 
        set the position of the tool tip to our valid position. 
 
        :param position: A 2D vector representing the position of the target this tool tip is for. 
 
        :return: returns True if we find a valid (visible) position and False if we do not. 
 
        &quot;&quot;&quot;</span>

        <span class="s1">window_rect = self.ui_manager.get_root_container().rect</span>

        <span class="s0">if </span><span class="s1">window_rect.contains(pygame.Rect(int(position[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">, </span><span class="s1">int(position[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)):</span>
            <span class="s1">self.rect.left = int(position.x)</span>
            <span class="s1">self.rect.top = int(position.y + self.hover_distance_from_target[</span><span class="s3">1</span><span class="s1">])</span>

            <span class="s0">if </span><span class="s1">window_rect.contains(self.rect):</span>
                <span class="s1">self.relative_rect = self.rect.copy()</span>
                <span class="s1">self.text_block.set_position(self.rect.topleft)</span>
                <span class="s0">return True</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s0">if </span><span class="s1">self.rect.bottom &gt; window_rect.bottom:</span>
                    <span class="s1">self.rect.bottom = int(position.y - self.hover_distance_from_target[</span><span class="s3">1</span><span class="s1">])</span>
                <span class="s0">if </span><span class="s1">self.rect.right &gt; window_rect.right:</span>
                    <span class="s1">self.rect.right = window_rect.right - self.hover_distance_from_target[</span><span class="s3">0</span><span class="s1">]</span>
                <span class="s0">if </span><span class="s1">self.rect.left &lt; window_rect.left:</span>
                    <span class="s1">self.rect.left = window_rect.left + self.hover_distance_from_target[</span><span class="s3">0</span><span class="s1">]</span>

            <span class="s0">if </span><span class="s1">window_rect.contains(self.rect):</span>
                <span class="s1">self.relative_rect = self.rect.copy()</span>
                <span class="s1">self.text_block.set_position(self.rect.topleft)</span>
                <span class="s0">return True</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">self.relative_rect = self.rect.copy()</span>
                <span class="s1">warnings.warn(</span><span class="s4">&quot;Unable to fit tool tip on screen&quot;</span><span class="s1">)</span>
                <span class="s0">return False</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self.relative_rect = self.rect.copy()</span>
            <span class="s1">warnings.warn(</span><span class="s4">&quot;initial position for tool tip is off screen,&quot;</span>
                          <span class="s4">&quot; unable to find valid position&quot;</span><span class="s1">)</span>
            <span class="s0">return False</span>

    <span class="s0">def </span><span class="s1">rebuild_from_changed_theme_data(self):</span>
        <span class="s2">&quot;&quot;&quot; 
        Called by the UIManager to check the theming data and rebuild whatever needs rebuilding for 
        this element when the theme data has changed. 
        &quot;&quot;&quot;</span>
        <span class="s1">super().rebuild_from_changed_theme_data()</span>
        <span class="s1">has_any_changed = </span><span class="s0">False</span>

        <span class="s0">if </span><span class="s1">self._check_misc_theme_data_changed(attribute_name=</span><span class="s4">'rect_width'</span><span class="s0">,</span>
                                               <span class="s1">default_value=</span><span class="s3">170</span><span class="s0">,</span>
                                               <span class="s1">casting_func=int):</span>
            <span class="s1">has_any_changed = </span><span class="s0">True</span>

        <span class="s0">if </span><span class="s1">has_any_changed:</span>
            <span class="s1">self.rebuild()</span>

    <span class="s0">def </span><span class="s1">set_position(self</span><span class="s0">, </span><span class="s1">position: Union[pygame.math.Vector2</span><span class="s0">,</span>
                                           <span class="s1">Tuple[int</span><span class="s0">, </span><span class="s1">int]</span><span class="s0">,</span>
                                           <span class="s1">Tuple[float</span><span class="s0">, </span><span class="s1">float]]):</span>
        <span class="s2">&quot;&quot;&quot; 
        Sets the absolute screen position of this tool tip, updating it's subordinate text box at 
        the same time. 
 
        :param position: The absolute screen position to set. 
 
        &quot;&quot;&quot;</span>
        <span class="s1">super().set_position(position)</span>
        <span class="s1">self.text_block.set_position(position)</span>

    <span class="s0">def </span><span class="s1">set_relative_position(self</span><span class="s0">, </span><span class="s1">position: Union[pygame.math.Vector2</span><span class="s0">,</span>
                                                    <span class="s1">Tuple[int</span><span class="s0">, </span><span class="s1">int]</span><span class="s0">,</span>
                                                    <span class="s1">Tuple[float</span><span class="s0">, </span><span class="s1">float]]):</span>
        <span class="s2">&quot;&quot;&quot; 
        Sets the relative screen position of this tool tip, updating it's subordinate text box at 
        the same time. 
 
        :param position: The relative screen position to set. 
 
        &quot;&quot;&quot;</span>
        <span class="s1">super().set_relative_position(position)</span>
        <span class="s1">self.text_block.set_relative_position(position)</span>

    <span class="s0">def </span><span class="s1">set_dimensions(self</span><span class="s0">, </span><span class="s1">dimensions: Union[pygame.math.Vector2</span><span class="s0">,</span>
                                               <span class="s1">Tuple[int</span><span class="s0">, </span><span class="s1">int]</span><span class="s0">,</span>
                                               <span class="s1">Tuple[float</span><span class="s0">, </span><span class="s1">float]]):</span>
        <span class="s2">&quot;&quot;&quot; 
        Directly sets the dimensions of this tool tip. This will overwrite the normal theming. 
 
        :param dimensions: The new dimensions to set 
 
        &quot;&quot;&quot;</span>
        <span class="s1">self.rect_width = dimensions[</span><span class="s3">0</span><span class="s1">]</span>

        <span class="s1">super().set_dimensions(dimensions)</span>
        <span class="s1">self.text_block.set_dimensions(dimensions)</span>

    <span class="s0">def </span><span class="s1">show(self):</span>
        <span class="s2">&quot;&quot;&quot; 
        This is a base method show() of a UIElement, but since it's not intended to be used on a 
        UIToolTip - display a warning. 
        &quot;&quot;&quot;</span>
        <span class="s1">super().show()</span>

        <span class="s1">warnings.warn(</span><span class="s4">&quot;Use of show() and hide() methods of UIToolTip objects is not supported.&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">hide(self):</span>
        <span class="s2">&quot;&quot;&quot; 
        This is a base method hide() of a UIElement, but since it's not intended to be used 
        on a UIToolTip - display a warning. 
        &quot;&quot;&quot;</span>
        <span class="s1">super().hide()</span>

        <span class="s1">warnings.warn(</span><span class="s4">&quot;Use of show() and hide() methods of UIToolTip objects is not supported.&quot;</span><span class="s1">)</span>
</pre>
</body>
</html>