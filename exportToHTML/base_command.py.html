<html>
<head>
<title>base_command.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
base_command.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Base Command class, and related routines&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">__future__ </span><span class="s2">import </span><span class="s1">absolute_import</span><span class="s2">, </span><span class="s1">print_function</span>

<span class="s2">import </span><span class="s1">logging</span>
<span class="s2">import </span><span class="s1">logging.config</span>
<span class="s2">import </span><span class="s1">optparse</span>
<span class="s2">import </span><span class="s1">os</span>
<span class="s2">import </span><span class="s1">platform</span>
<span class="s2">import </span><span class="s1">sys</span>
<span class="s2">import </span><span class="s1">traceback</span>

<span class="s2">from </span><span class="s1">pip._internal.cli </span><span class="s2">import </span><span class="s1">cmdoptions</span>
<span class="s2">from </span><span class="s1">pip._internal.cli.parser </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">ConfigOptionParser</span><span class="s2">, </span><span class="s1">UpdatingDefaultsHelpFormatter</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">pip._internal.cli.status_codes </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">ERROR</span><span class="s2">, </span><span class="s1">PREVIOUS_BUILD_DIR_ERROR</span><span class="s2">, </span><span class="s1">SUCCESS</span><span class="s2">, </span><span class="s1">UNKNOWN_ERROR</span><span class="s2">,</span>
    <span class="s1">VIRTUALENV_NOT_FOUND</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">pip._internal.download </span><span class="s2">import </span><span class="s1">PipSession</span>
<span class="s2">from </span><span class="s1">pip._internal.exceptions </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">BadCommand</span><span class="s2">, </span><span class="s1">CommandError</span><span class="s2">, </span><span class="s1">InstallationError</span><span class="s2">, </span><span class="s1">PreviousBuildDirError</span><span class="s2">,</span>
    <span class="s1">UninstallationError</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">pip._internal.index </span><span class="s2">import </span><span class="s1">PackageFinder</span>
<span class="s2">from </span><span class="s1">pip._internal.locations </span><span class="s2">import </span><span class="s1">running_under_virtualenv</span>
<span class="s2">from </span><span class="s1">pip._internal.req.constructors </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">install_req_from_editable</span><span class="s2">, </span><span class="s1">install_req_from_line</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">pip._internal.req.req_file </span><span class="s2">import </span><span class="s1">parse_requirements</span>
<span class="s2">from </span><span class="s1">pip._internal.utils.deprecation </span><span class="s2">import </span><span class="s1">deprecated</span>
<span class="s2">from </span><span class="s1">pip._internal.utils.logging </span><span class="s2">import </span><span class="s1">BrokenStdoutLoggingError</span><span class="s2">, </span><span class="s1">setup_logging</span>
<span class="s2">from </span><span class="s1">pip._internal.utils.misc </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">get_prog</span><span class="s2">, </span><span class="s1">normalize_path</span><span class="s2">, </span><span class="s1">redact_password_from_url</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">pip._internal.utils.outdated </span><span class="s2">import </span><span class="s1">pip_version_check</span>
<span class="s2">from </span><span class="s1">pip._internal.utils.typing </span><span class="s2">import </span><span class="s1">MYPY_CHECK_RUNNING</span>

<span class="s2">if </span><span class="s1">MYPY_CHECK_RUNNING:</span>
    <span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">Optional</span><span class="s2">, </span><span class="s1">List</span><span class="s2">, </span><span class="s1">Tuple</span><span class="s2">, </span><span class="s1">Any  </span><span class="s3"># noqa: F401</span>
    <span class="s2">from </span><span class="s1">optparse </span><span class="s2">import </span><span class="s1">Values  </span><span class="s3"># noqa: F401</span>
    <span class="s2">from </span><span class="s1">pip._internal.cache </span><span class="s2">import </span><span class="s1">WheelCache  </span><span class="s3"># noqa: F401</span>
    <span class="s2">from </span><span class="s1">pip._internal.req.req_set </span><span class="s2">import </span><span class="s1">RequirementSet  </span><span class="s3"># noqa: F401</span>

<span class="s1">__all__ = [</span><span class="s4">'Command'</span><span class="s1">]</span>

<span class="s1">logger = logging.getLogger(__name__)</span>


<span class="s2">class </span><span class="s1">Command(object):</span>
    <span class="s1">name = </span><span class="s2">None  </span><span class="s3"># type: Optional[str]</span>
    <span class="s1">usage = </span><span class="s2">None  </span><span class="s3"># type: Optional[str]</span>
    <span class="s1">hidden = </span><span class="s2">False  </span><span class="s3"># type: bool</span>
    <span class="s1">ignore_require_venv = </span><span class="s2">False  </span><span class="s3"># type: bool</span>

    <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">, </span><span class="s1">isolated=</span><span class="s2">False</span><span class="s1">):</span>
        <span class="s3"># type: (bool) -&gt; None</span>
        <span class="s1">parser_kw = {</span>
            <span class="s4">'usage'</span><span class="s1">: self.usage</span><span class="s2">,</span>
            <span class="s4">'prog'</span><span class="s1">: </span><span class="s4">'%s %s' </span><span class="s1">% (get_prog()</span><span class="s2">, </span><span class="s1">self.name)</span><span class="s2">,</span>
            <span class="s4">'formatter'</span><span class="s1">: UpdatingDefaultsHelpFormatter()</span><span class="s2">,</span>
            <span class="s4">'add_help_option'</span><span class="s1">: </span><span class="s2">False,</span>
            <span class="s4">'name'</span><span class="s1">: self.name</span><span class="s2">,</span>
            <span class="s4">'description'</span><span class="s1">: self.__doc__</span><span class="s2">,</span>
            <span class="s4">'isolated'</span><span class="s1">: isolated</span><span class="s2">,</span>
        <span class="s1">}</span>

        <span class="s1">self.parser = ConfigOptionParser(**parser_kw)</span>

        <span class="s3"># Commands should add options to this option group</span>
        <span class="s1">optgroup_name = </span><span class="s4">'%s Options' </span><span class="s1">% self.name.capitalize()</span>
        <span class="s1">self.cmd_opts = optparse.OptionGroup(self.parser</span><span class="s2">, </span><span class="s1">optgroup_name)</span>

        <span class="s3"># Add the general options</span>
        <span class="s1">gen_opts = cmdoptions.make_option_group(</span>
            <span class="s1">cmdoptions.general_group</span><span class="s2">,</span>
            <span class="s1">self.parser</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">self.parser.add_option_group(gen_opts)</span>

    <span class="s2">def </span><span class="s1">run(self</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">args):</span>
        <span class="s3"># type: (Values, List[Any]) -&gt; Any</span>
        <span class="s2">raise </span><span class="s1">NotImplementedError</span>

    <span class="s2">def </span><span class="s1">_build_session(self</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">retries=</span><span class="s2">None, </span><span class="s1">timeout=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s3"># type: (Values, Optional[int], Optional[int]) -&gt; PipSession</span>
        <span class="s1">session = PipSession(</span>
            <span class="s1">cache=(</span>
                <span class="s1">normalize_path(os.path.join(options.cache_dir</span><span class="s2">, </span><span class="s4">&quot;http&quot;</span><span class="s1">))</span>
                <span class="s2">if </span><span class="s1">options.cache_dir </span><span class="s2">else None</span>
            <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">retries=retries </span><span class="s2">if </span><span class="s1">retries </span><span class="s2">is not None else </span><span class="s1">options.retries</span><span class="s2">,</span>
            <span class="s1">insecure_hosts=options.trusted_hosts</span><span class="s2">,</span>
        <span class="s1">)</span>

        <span class="s3"># Handle custom ca-bundles from the user</span>
        <span class="s2">if </span><span class="s1">options.cert:</span>
            <span class="s1">session.verify = options.cert</span>

        <span class="s3"># Handle SSL client certificate</span>
        <span class="s2">if </span><span class="s1">options.client_cert:</span>
            <span class="s1">session.cert = options.client_cert</span>

        <span class="s3"># Handle timeouts</span>
        <span class="s2">if </span><span class="s1">options.timeout </span><span class="s2">or </span><span class="s1">timeout:</span>
            <span class="s1">session.timeout = (</span>
                <span class="s1">timeout </span><span class="s2">if </span><span class="s1">timeout </span><span class="s2">is not None else </span><span class="s1">options.timeout</span>
            <span class="s1">)</span>

        <span class="s3"># Handle configured proxies</span>
        <span class="s2">if </span><span class="s1">options.proxy:</span>
            <span class="s1">session.proxies = {</span>
                <span class="s4">&quot;http&quot;</span><span class="s1">: options.proxy</span><span class="s2">,</span>
                <span class="s4">&quot;https&quot;</span><span class="s1">: options.proxy</span><span class="s2">,</span>
            <span class="s1">}</span>

        <span class="s3"># Determine if we can prompt the user for authentication or not</span>
        <span class="s1">session.auth.prompting = </span><span class="s2">not </span><span class="s1">options.no_input</span>

        <span class="s2">return </span><span class="s1">session</span>

    <span class="s2">def </span><span class="s1">parse_args(self</span><span class="s2">, </span><span class="s1">args):</span>
        <span class="s3"># type: (List[str]) -&gt; Tuple</span>
        <span class="s3"># factored out for testability</span>
        <span class="s2">return </span><span class="s1">self.parser.parse_args(args)</span>

    <span class="s2">def </span><span class="s1">main(self</span><span class="s2">, </span><span class="s1">args):</span>
        <span class="s3"># type: (List[str]) -&gt; int</span>
        <span class="s1">options</span><span class="s2">, </span><span class="s1">args = self.parse_args(args)</span>

        <span class="s3"># Set verbosity so that it can be used elsewhere.</span>
        <span class="s1">self.verbosity = options.verbose - options.quiet</span>

        <span class="s1">level_number = setup_logging(</span>
            <span class="s1">verbosity=self.verbosity</span><span class="s2">,</span>
            <span class="s1">no_color=options.no_color</span><span class="s2">,</span>
            <span class="s1">user_log_file=options.log</span><span class="s2">,</span>
        <span class="s1">)</span>

        <span class="s2">if </span><span class="s1">sys.version_info[:</span><span class="s5">2</span><span class="s1">] == (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s1">):</span>
            <span class="s1">deprecated(</span>
                <span class="s4">&quot;Python 3.4 support has been deprecated. pip 19.1 will be the &quot;</span>
                <span class="s4">&quot;last one supporting it. Please upgrade your Python as Python &quot;</span>
                <span class="s4">&quot;3.4 won't be maintained after March 2019 (cf PEP 429).&quot;</span><span class="s2">,</span>
                <span class="s1">replacement=</span><span class="s2">None,</span>
                <span class="s1">gone_in=</span><span class="s4">'19.2'</span><span class="s2">,</span>
            <span class="s1">)</span>
        <span class="s2">elif </span><span class="s1">sys.version_info[:</span><span class="s5">2</span><span class="s1">] == (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">7</span><span class="s1">):</span>
            <span class="s1">message = (</span>
                <span class="s4">&quot;A future version of pip will drop support for Python 2.7.&quot;</span>
            <span class="s1">)</span>
            <span class="s2">if </span><span class="s1">platform.python_implementation() == </span><span class="s4">&quot;CPython&quot;</span><span class="s1">:</span>
                <span class="s1">message = (</span>
                    <span class="s4">&quot;Python 2.7 will reach the end of its life on January &quot;</span>
                    <span class="s4">&quot;1st, 2020. Please upgrade your Python as Python 2.7 &quot;</span>
                    <span class="s4">&quot;won't be maintained after that date. &quot;</span>
                <span class="s1">) + message</span>
            <span class="s1">deprecated(message</span><span class="s2">, </span><span class="s1">replacement=</span><span class="s2">None, </span><span class="s1">gone_in=</span><span class="s2">None</span><span class="s1">)</span>

        <span class="s3"># TODO: Try to get these passing down from the command?</span>
        <span class="s3">#       without resorting to os.environ to hold these.</span>
        <span class="s3">#       This also affects isolated builds and it should.</span>

        <span class="s2">if </span><span class="s1">options.no_input:</span>
            <span class="s1">os.environ[</span><span class="s4">'PIP_NO_INPUT'</span><span class="s1">] = </span><span class="s4">'1'</span>

        <span class="s2">if </span><span class="s1">options.exists_action:</span>
            <span class="s1">os.environ[</span><span class="s4">'PIP_EXISTS_ACTION'</span><span class="s1">] = </span><span class="s4">' '</span><span class="s1">.join(options.exists_action)</span>

        <span class="s2">if </span><span class="s1">options.require_venv </span><span class="s2">and not </span><span class="s1">self.ignore_require_venv:</span>
            <span class="s3"># If a venv is required check if it can really be found</span>
            <span class="s2">if not </span><span class="s1">running_under_virtualenv():</span>
                <span class="s1">logger.critical(</span>
                    <span class="s4">'Could not find an activated virtualenv (required).'</span>
                <span class="s1">)</span>
                <span class="s1">sys.exit(VIRTUALENV_NOT_FOUND)</span>

        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">status = self.run(options</span><span class="s2">, </span><span class="s1">args)</span>
            <span class="s3"># FIXME: all commands should return an exit status</span>
            <span class="s3"># and when it is done, isinstance is not needed anymore</span>
            <span class="s2">if </span><span class="s1">isinstance(status</span><span class="s2">, </span><span class="s1">int):</span>
                <span class="s2">return </span><span class="s1">status</span>
        <span class="s2">except </span><span class="s1">PreviousBuildDirError </span><span class="s2">as </span><span class="s1">exc:</span>
            <span class="s1">logger.critical(str(exc))</span>
            <span class="s1">logger.debug(</span><span class="s4">'Exception information:'</span><span class="s2">, </span><span class="s1">exc_info=</span><span class="s2">True</span><span class="s1">)</span>

            <span class="s2">return </span><span class="s1">PREVIOUS_BUILD_DIR_ERROR</span>
        <span class="s2">except </span><span class="s1">(InstallationError</span><span class="s2">, </span><span class="s1">UninstallationError</span><span class="s2">, </span><span class="s1">BadCommand) </span><span class="s2">as </span><span class="s1">exc:</span>
            <span class="s1">logger.critical(str(exc))</span>
            <span class="s1">logger.debug(</span><span class="s4">'Exception information:'</span><span class="s2">, </span><span class="s1">exc_info=</span><span class="s2">True</span><span class="s1">)</span>

            <span class="s2">return </span><span class="s1">ERROR</span>
        <span class="s2">except </span><span class="s1">CommandError </span><span class="s2">as </span><span class="s1">exc:</span>
            <span class="s1">logger.critical(</span><span class="s4">'ERROR: %s'</span><span class="s2">, </span><span class="s1">exc)</span>
            <span class="s1">logger.debug(</span><span class="s4">'Exception information:'</span><span class="s2">, </span><span class="s1">exc_info=</span><span class="s2">True</span><span class="s1">)</span>

            <span class="s2">return </span><span class="s1">ERROR</span>
        <span class="s2">except </span><span class="s1">BrokenStdoutLoggingError:</span>
            <span class="s3"># Bypass our logger and write any remaining messages to stderr</span>
            <span class="s3"># because stdout no longer works.</span>
            <span class="s1">print(</span><span class="s4">'ERROR: Pipe to stdout was broken'</span><span class="s2">, </span><span class="s1">file=sys.stderr)</span>
            <span class="s2">if </span><span class="s1">level_number &lt;= logging.DEBUG:</span>
                <span class="s1">traceback.print_exc(file=sys.stderr)</span>

            <span class="s2">return </span><span class="s1">ERROR</span>
        <span class="s2">except </span><span class="s1">KeyboardInterrupt:</span>
            <span class="s1">logger.critical(</span><span class="s4">'Operation cancelled by user'</span><span class="s1">)</span>
            <span class="s1">logger.debug(</span><span class="s4">'Exception information:'</span><span class="s2">, </span><span class="s1">exc_info=</span><span class="s2">True</span><span class="s1">)</span>

            <span class="s2">return </span><span class="s1">ERROR</span>
        <span class="s2">except </span><span class="s1">BaseException:</span>
            <span class="s1">logger.critical(</span><span class="s4">'Exception:'</span><span class="s2">, </span><span class="s1">exc_info=</span><span class="s2">True</span><span class="s1">)</span>

            <span class="s2">return </span><span class="s1">UNKNOWN_ERROR</span>
        <span class="s2">finally</span><span class="s1">:</span>
            <span class="s1">allow_version_check = (</span>
                <span class="s3"># Does this command have the index_group options?</span>
                <span class="s1">hasattr(options</span><span class="s2">, </span><span class="s4">&quot;no_index&quot;</span><span class="s1">) </span><span class="s2">and</span>
                <span class="s3"># Is this command allowed to perform this check?</span>
                <span class="s2">not </span><span class="s1">(options.disable_pip_version_check </span><span class="s2">or </span><span class="s1">options.no_index)</span>
            <span class="s1">)</span>
            <span class="s3"># Check if we're using the latest version of pip available</span>
            <span class="s2">if </span><span class="s1">allow_version_check:</span>
                <span class="s1">session = self._build_session(</span>
                    <span class="s1">options</span><span class="s2">,</span>
                    <span class="s1">retries=</span><span class="s5">0</span><span class="s2">,</span>
                    <span class="s1">timeout=min(</span><span class="s5">5</span><span class="s2">, </span><span class="s1">options.timeout)</span>
                <span class="s1">)</span>
                <span class="s2">with </span><span class="s1">session:</span>
                    <span class="s1">pip_version_check(session</span><span class="s2">, </span><span class="s1">options)</span>

            <span class="s3"># Shutdown the logging module</span>
            <span class="s1">logging.shutdown()</span>

        <span class="s2">return </span><span class="s1">SUCCESS</span>


<span class="s2">class </span><span class="s1">RequirementCommand(Command):</span>

    <span class="s1">@staticmethod</span>
    <span class="s2">def </span><span class="s1">populate_requirement_set(requirement_set</span><span class="s2">,  </span><span class="s3"># type: RequirementSet</span>
                                 <span class="s1">args</span><span class="s2">,             </span><span class="s3"># type: List[str]</span>
                                 <span class="s1">options</span><span class="s2">,          </span><span class="s3"># type: Values</span>
                                 <span class="s1">finder</span><span class="s2">,           </span><span class="s3"># type: PackageFinder</span>
                                 <span class="s1">session</span><span class="s2">,          </span><span class="s3"># type: PipSession</span>
                                 <span class="s1">name</span><span class="s2">,             </span><span class="s3"># type: str</span>
                                 <span class="s1">wheel_cache       </span><span class="s3"># type: Optional[WheelCache]</span>
                                 <span class="s1">):</span>
        <span class="s3"># type: (...) -&gt; None</span>
        <span class="s0">&quot;&quot;&quot; 
        Marshal cmd line args into a requirement set. 
        &quot;&quot;&quot;</span>
        <span class="s3"># NOTE: As a side-effect, options.require_hashes and</span>
        <span class="s3">#       requirement_set.require_hashes may be updated</span>

        <span class="s2">for </span><span class="s1">filename </span><span class="s2">in </span><span class="s1">options.constraints:</span>
            <span class="s2">for </span><span class="s1">req_to_add </span><span class="s2">in </span><span class="s1">parse_requirements(</span>
                    <span class="s1">filename</span><span class="s2">,</span>
                    <span class="s1">constraint=</span><span class="s2">True, </span><span class="s1">finder=finder</span><span class="s2">, </span><span class="s1">options=options</span><span class="s2">,</span>
                    <span class="s1">session=session</span><span class="s2">, </span><span class="s1">wheel_cache=wheel_cache):</span>
                <span class="s1">req_to_add.is_direct = </span><span class="s2">True</span>
                <span class="s1">requirement_set.add_requirement(req_to_add)</span>

        <span class="s2">for </span><span class="s1">req </span><span class="s2">in </span><span class="s1">args:</span>
            <span class="s1">req_to_add = install_req_from_line(</span>
                <span class="s1">req</span><span class="s2">, None, </span><span class="s1">isolated=options.isolated_mode</span><span class="s2">,</span>
                <span class="s1">use_pep517=options.use_pep517</span><span class="s2">,</span>
                <span class="s1">wheel_cache=wheel_cache</span>
            <span class="s1">)</span>
            <span class="s1">req_to_add.is_direct = </span><span class="s2">True</span>
            <span class="s1">requirement_set.add_requirement(req_to_add)</span>

        <span class="s2">for </span><span class="s1">req </span><span class="s2">in </span><span class="s1">options.editables:</span>
            <span class="s1">req_to_add = install_req_from_editable(</span>
                <span class="s1">req</span><span class="s2">,</span>
                <span class="s1">isolated=options.isolated_mode</span><span class="s2">,</span>
                <span class="s1">use_pep517=options.use_pep517</span><span class="s2">,</span>
                <span class="s1">wheel_cache=wheel_cache</span>
            <span class="s1">)</span>
            <span class="s1">req_to_add.is_direct = </span><span class="s2">True</span>
            <span class="s1">requirement_set.add_requirement(req_to_add)</span>

        <span class="s2">for </span><span class="s1">filename </span><span class="s2">in </span><span class="s1">options.requirements:</span>
            <span class="s2">for </span><span class="s1">req_to_add </span><span class="s2">in </span><span class="s1">parse_requirements(</span>
                    <span class="s1">filename</span><span class="s2">,</span>
                    <span class="s1">finder=finder</span><span class="s2">, </span><span class="s1">options=options</span><span class="s2">, </span><span class="s1">session=session</span><span class="s2">,</span>
                    <span class="s1">wheel_cache=wheel_cache</span><span class="s2">,</span>
                    <span class="s1">use_pep517=options.use_pep517):</span>
                <span class="s1">req_to_add.is_direct = </span><span class="s2">True</span>
                <span class="s1">requirement_set.add_requirement(req_to_add)</span>
        <span class="s3"># If --require-hashes was a line in a requirements file, tell</span>
        <span class="s3"># RequirementSet about it:</span>
        <span class="s1">requirement_set.require_hashes = options.require_hashes</span>

        <span class="s2">if not </span><span class="s1">(args </span><span class="s2">or </span><span class="s1">options.editables </span><span class="s2">or </span><span class="s1">options.requirements):</span>
            <span class="s1">opts = {</span><span class="s4">'name'</span><span class="s1">: name}</span>
            <span class="s2">if </span><span class="s1">options.find_links:</span>
                <span class="s2">raise </span><span class="s1">CommandError(</span>
                    <span class="s4">'You must give at least one requirement to %(name)s '</span>
                    <span class="s4">'(maybe you meant &quot;pip %(name)s %(links)s&quot;?)' </span><span class="s1">%</span>
                    <span class="s1">dict(opts</span><span class="s2">, </span><span class="s1">links=</span><span class="s4">' '</span><span class="s1">.join(options.find_links)))</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s2">raise </span><span class="s1">CommandError(</span>
                    <span class="s4">'You must give at least one requirement to %(name)s '</span>
                    <span class="s4">'(see &quot;pip help %(name)s&quot;)' </span><span class="s1">% opts)</span>

    <span class="s2">def </span><span class="s1">_build_package_finder(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">options</span><span class="s2">,               </span><span class="s3"># type: Values</span>
        <span class="s1">session</span><span class="s2">,               </span><span class="s3"># type: PipSession</span>
        <span class="s1">platform=</span><span class="s2">None,         </span><span class="s3"># type: Optional[str]</span>
        <span class="s1">python_versions=</span><span class="s2">None,  </span><span class="s3"># type: Optional[List[str]]</span>
        <span class="s1">abi=</span><span class="s2">None,              </span><span class="s3"># type: Optional[str]</span>
        <span class="s1">implementation=</span><span class="s2">None    </span><span class="s3"># type: Optional[str]</span>
    <span class="s1">):</span>
        <span class="s3"># type: (...) -&gt; PackageFinder</span>
        <span class="s0">&quot;&quot;&quot; 
        Create a package finder appropriate to this requirement command. 
        &quot;&quot;&quot;</span>
        <span class="s1">index_urls = [options.index_url] + options.extra_index_urls</span>
        <span class="s2">if </span><span class="s1">options.no_index:</span>
            <span class="s1">logger.debug(</span>
                <span class="s4">'Ignoring indexes: %s'</span><span class="s2">,</span>
                <span class="s4">','</span><span class="s1">.join(redact_password_from_url(url) </span><span class="s2">for </span><span class="s1">url </span><span class="s2">in </span><span class="s1">index_urls)</span><span class="s2">,</span>
            <span class="s1">)</span>
            <span class="s1">index_urls = []</span>

        <span class="s2">return </span><span class="s1">PackageFinder(</span>
            <span class="s1">find_links=options.find_links</span><span class="s2">,</span>
            <span class="s1">format_control=options.format_control</span><span class="s2">,</span>
            <span class="s1">index_urls=index_urls</span><span class="s2">,</span>
            <span class="s1">trusted_hosts=options.trusted_hosts</span><span class="s2">,</span>
            <span class="s1">allow_all_prereleases=options.pre</span><span class="s2">,</span>
            <span class="s1">session=session</span><span class="s2">,</span>
            <span class="s1">platform=platform</span><span class="s2">,</span>
            <span class="s1">versions=python_versions</span><span class="s2">,</span>
            <span class="s1">abi=abi</span><span class="s2">,</span>
            <span class="s1">implementation=implementation</span><span class="s2">,</span>
            <span class="s1">prefer_binary=options.prefer_binary</span><span class="s2">,</span>
        <span class="s1">)</span>
</pre>
</body>
</html>