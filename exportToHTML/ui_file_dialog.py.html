<html>
<head>
<title>ui_file_dialog.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ui_file_dialog.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Union</span><span class="s0">, </span><span class="s1">List</span>
<span class="s0">from </span><span class="s1">pathlib </span><span class="s0">import </span><span class="s1">Path</span>

<span class="s0">import </span><span class="s1">pygame</span>

<span class="s0">from </span><span class="s1">pygame_gui.core </span><span class="s0">import </span><span class="s1">ObjectID</span>
<span class="s0">from </span><span class="s1">pygame_gui._constants </span><span class="s0">import </span><span class="s1">UI_BUTTON_PRESSED</span><span class="s0">, </span><span class="s1">UI_SELECTION_LIST_DOUBLE_CLICKED_SELECTION</span>
<span class="s0">from </span><span class="s1">pygame_gui._constants </span><span class="s0">import </span><span class="s1">UI_SELECTION_LIST_NEW_SELECTION</span>
<span class="s0">from </span><span class="s1">pygame_gui._constants </span><span class="s0">import </span><span class="s1">UI_TEXT_ENTRY_FINISHED</span><span class="s0">, </span><span class="s1">UI_TEXT_ENTRY_CHANGED</span>
<span class="s0">from </span><span class="s1">pygame_gui._constants </span><span class="s0">import </span><span class="s1">UI_CONFIRMATION_DIALOG_CONFIRMED</span><span class="s0">, </span><span class="s1">UI_FILE_DIALOG_PATH_PICKED</span>

<span class="s0">from </span><span class="s1">pygame_gui.core.interfaces </span><span class="s0">import </span><span class="s1">IUIManagerInterface</span>
<span class="s0">from </span><span class="s1">pygame_gui.elements </span><span class="s0">import </span><span class="s1">UIWindow</span><span class="s0">, </span><span class="s1">UIButton</span><span class="s0">, </span><span class="s1">UITextEntryLine</span><span class="s0">, </span><span class="s1">UISelectionList</span>
<span class="s0">from </span><span class="s1">pygame_gui.windows.ui_confirmation_dialog </span><span class="s0">import </span><span class="s1">UIConfirmationDialog</span>


<span class="s0">class </span><span class="s1">UIFileDialog(UIWindow):</span>
    <span class="s2">&quot;&quot;&quot; 
    A dialog window for handling file selection operations. The dialog will let you pick a file 
    from a file system but won't do anything with it once you have, the path will just be returned 
    leaving it up to the rest of the application to decide what to do with it. 
 
    :param rect: The size and position of the file dialog window. Includes the size of shadow, 
                 border and title bar. 
    :param manager: The manager for the whole of the UI. 
    :param window_title: The title for the window, defaults to 'File Dialog' 
    :param initial_file_path: The initial path to open the file dialog at. 
    :param object_id: The object ID for the window, used for theming - defaults to '#file_dialog' 
    :param visible: Whether the element is visible by default. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">,</span>
                 <span class="s1">rect: pygame.Rect</span><span class="s0">,</span>
                 <span class="s1">manager: IUIManagerInterface</span><span class="s0">,</span>
                 <span class="s1">window_title: str = </span><span class="s3">'File Dialog'</span><span class="s0">,</span>
                 <span class="s1">initial_file_path: Union[str</span><span class="s0">, None</span><span class="s1">] = </span><span class="s0">None,</span>
                 <span class="s1">object_id: Union[ObjectID</span><span class="s0">, </span><span class="s1">str] = ObjectID(</span><span class="s3">'#file_dialog'</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
                 <span class="s1">allow_existing_files_only: bool = </span><span class="s0">False,</span>
                 <span class="s1">allow_picking_directories: bool = </span><span class="s0">False,</span>
                 <span class="s1">visible: int = </span><span class="s4">1</span>
                 <span class="s1">):</span>

        <span class="s1">super().__init__(rect</span><span class="s0">, </span><span class="s1">manager</span><span class="s0">,</span>
                         <span class="s1">window_display_title=window_title</span><span class="s0">,</span>
                         <span class="s1">object_id=object_id</span><span class="s0">,</span>
                         <span class="s1">resizable=</span><span class="s0">True,</span>
                         <span class="s1">visible=visible)</span>

        <span class="s1">minimum_dimensions = (</span><span class="s4">260</span><span class="s0">, </span><span class="s4">300</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">rect.width &lt; minimum_dimensions[</span><span class="s4">0</span><span class="s1">] </span><span class="s0">or </span><span class="s1">rect.height &lt; minimum_dimensions[</span><span class="s4">1</span><span class="s1">]:</span>
            <span class="s1">warn_string = (</span><span class="s3">&quot;Initial size: &quot; </span><span class="s1">+ str(rect.size) +</span>
                           <span class="s3">&quot; is less than minimum dimensions: &quot; </span><span class="s1">+ str(minimum_dimensions))</span>
            <span class="s1">warnings.warn(warn_string</span><span class="s0">, </span><span class="s1">UserWarning)</span>
        <span class="s1">self.set_minimum_dimensions(minimum_dimensions)</span>

        <span class="s1">self.allow_existing_files_only = allow_existing_files_only</span>
        <span class="s1">self.allow_picking_directories = allow_picking_directories</span>

        <span class="s1">self.delete_confirmation_dialog = </span><span class="s0">None  </span><span class="s5"># type: Union[UIConfirmationDialog, None]</span>
        <span class="s1">self.current_file_path = </span><span class="s0">None  </span><span class="s5"># type: Union[Path, None]</span>

        <span class="s0">if </span><span class="s1">initial_file_path </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">pathed_initial_file_path = Path(initial_file_path)</span>
            <span class="s0">if </span><span class="s1">pathed_initial_file_path.exists() </span><span class="s0">and not </span><span class="s1">pathed_initial_file_path.is_file():</span>
                <span class="s1">self.current_directory_path = str(pathed_initial_file_path.resolve())</span>
                <span class="s0">if </span><span class="s1">self.allow_picking_directories:</span>
                    <span class="s1">self.current_file_path = self.current_directory_path</span>
            <span class="s0">elif </span><span class="s1">pathed_initial_file_path.exists() </span><span class="s0">and </span><span class="s1">pathed_initial_file_path.is_file():</span>
                <span class="s1">self.current_file_path = pathed_initial_file_path.resolve()</span>
                <span class="s1">self.current_directory_path = str(pathed_initial_file_path.parent.resolve())</span>
            <span class="s0">elif </span><span class="s1">pathed_initial_file_path.parent.exists():</span>
                <span class="s1">self.current_directory_path = str(pathed_initial_file_path.parent.resolve())</span>
                <span class="s1">self.current_file_path = (Path(initial_file_path).parent.resolve() /</span>
                                          <span class="s1">Path(initial_file_path).name)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self.current_directory_path = str(Path(</span><span class="s3">'.'</span><span class="s1">).resolve())</span>

        <span class="s1">self.last_valid_directory_path = self.current_directory_path</span>

        <span class="s1">self.current_file_list = </span><span class="s0">None  </span><span class="s5"># type: Union[List[str], None]</span>
        <span class="s1">self.update_current_file_list()</span>

        <span class="s1">self.ok_button = UIButton(relative_rect=pygame.Rect(-</span><span class="s4">220</span><span class="s0">, </span><span class="s1">-</span><span class="s4">40</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">30</span><span class="s1">)</span><span class="s0">,</span>
                                  <span class="s1">text=</span><span class="s3">'OK'</span><span class="s0">,</span>
                                  <span class="s1">manager=self.ui_manager</span><span class="s0">,</span>
                                  <span class="s1">container=self</span><span class="s0">,</span>
                                  <span class="s1">object_id=</span><span class="s3">'#ok_button'</span><span class="s0">,</span>
                                  <span class="s1">anchors={</span><span class="s3">'left'</span><span class="s1">: </span><span class="s3">'right'</span><span class="s0">,</span>
                                           <span class="s3">'right'</span><span class="s1">: </span><span class="s3">'right'</span><span class="s0">,</span>
                                           <span class="s3">'top'</span><span class="s1">: </span><span class="s3">'bottom'</span><span class="s0">,</span>
                                           <span class="s3">'bottom'</span><span class="s1">: </span><span class="s3">'bottom'</span><span class="s1">})</span>
        <span class="s0">if not </span><span class="s1">self._validate_file_path(self.current_file_path):</span>
            <span class="s1">self.ok_button.disable()</span>

        <span class="s1">self.cancel_button = UIButton(relative_rect=pygame.Rect(-</span><span class="s4">110</span><span class="s0">, </span><span class="s1">-</span><span class="s4">40</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">30</span><span class="s1">)</span><span class="s0">,</span>
                                      <span class="s1">text=</span><span class="s3">'Cancel'</span><span class="s0">,</span>
                                      <span class="s1">manager=self.ui_manager</span><span class="s0">,</span>
                                      <span class="s1">container=self</span><span class="s0">,</span>
                                      <span class="s1">object_id=</span><span class="s3">'#cancel_button'</span><span class="s0">,</span>
                                      <span class="s1">anchors={</span><span class="s3">'left'</span><span class="s1">: </span><span class="s3">'right'</span><span class="s0">,</span>
                                               <span class="s3">'right'</span><span class="s1">: </span><span class="s3">'right'</span><span class="s0">,</span>
                                               <span class="s3">'top'</span><span class="s1">: </span><span class="s3">'bottom'</span><span class="s0">,</span>
                                               <span class="s3">'bottom'</span><span class="s1">: </span><span class="s3">'bottom'</span><span class="s1">})</span>

        <span class="s1">self.home_button = UIButton(relative_rect=pygame.Rect(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span><span class="s0">,</span>
                                    <span class="s1">text=</span><span class="s3">'⌂'</span><span class="s0">,</span>
                                    <span class="s1">tool_tip_text=</span><span class="s3">'Home Directory'</span><span class="s0">,</span>
                                    <span class="s1">manager=self.ui_manager</span><span class="s0">,</span>
                                    <span class="s1">container=self</span><span class="s0">,</span>
                                    <span class="s1">object_id=</span><span class="s3">'#home_icon_button'</span><span class="s0">,</span>
                                    <span class="s1">anchors={</span><span class="s3">'left'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
                                             <span class="s3">'right'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
                                             <span class="s3">'top'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s0">,</span>
                                             <span class="s3">'bottom'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s1">})</span>

        <span class="s1">self.delete_button = UIButton(relative_rect=pygame.Rect(</span><span class="s4">32</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span><span class="s0">,</span>
                                      <span class="s1">text=</span><span class="s3">'⌧'</span><span class="s0">,</span>
                                      <span class="s1">tool_tip_text=</span><span class="s3">'Delete'</span><span class="s0">,</span>
                                      <span class="s1">manager=self.ui_manager</span><span class="s0">,</span>
                                      <span class="s1">container=self</span><span class="s0">,</span>
                                      <span class="s1">object_id=</span><span class="s3">'#delete_icon_button'</span><span class="s0">,</span>
                                      <span class="s1">anchors={</span><span class="s3">'left'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
                                               <span class="s3">'right'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
                                               <span class="s3">'top'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s0">,</span>
                                               <span class="s3">'bottom'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s1">})</span>
        <span class="s0">if not </span><span class="s1">self._validate_path_exists_and_of_allowed_type(self.current_file_path</span><span class="s0">,</span>
                                                              <span class="s1">allow_directories=</span><span class="s0">False</span><span class="s1">):</span>
            <span class="s1">self.delete_button.disable()</span>

        <span class="s1">self.parent_directory_button = UIButton(relative_rect=pygame.Rect(</span><span class="s4">54</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span><span class="s0">,</span>
                                                <span class="s1">text=</span><span class="s3">'↑'</span><span class="s0">,</span>
                                                <span class="s1">tool_tip_text=</span><span class="s3">'Parent Directory'</span><span class="s0">,</span>
                                                <span class="s1">manager=self.ui_manager</span><span class="s0">,</span>
                                                <span class="s1">container=self</span><span class="s0">,</span>
                                                <span class="s1">object_id=</span><span class="s3">'#parent_icon_button'</span><span class="s0">,</span>
                                                <span class="s1">anchors={</span><span class="s3">'left'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
                                                         <span class="s3">'right'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
                                                         <span class="s3">'top'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s0">,</span>
                                                         <span class="s3">'bottom'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s1">})</span>

        <span class="s1">self.refresh_button = UIButton(relative_rect=pygame.Rect(</span><span class="s4">76</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span><span class="s0">,</span>
                                       <span class="s1">text=</span><span class="s3">'⇪'</span><span class="s0">,</span>
                                       <span class="s1">tool_tip_text=</span><span class="s3">'Refresh Directory'</span><span class="s0">,</span>
                                       <span class="s1">manager=self.ui_manager</span><span class="s0">,</span>
                                       <span class="s1">container=self</span><span class="s0">,</span>
                                       <span class="s1">object_id=</span><span class="s3">'#refresh_icon_button'</span><span class="s0">,</span>
                                       <span class="s1">anchors={</span><span class="s3">'left'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
                                                <span class="s3">'right'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
                                                <span class="s3">'top'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s0">,</span>
                                                <span class="s3">'bottom'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s1">})</span>

        <span class="s1">text_line_rect = pygame.Rect(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">40</span><span class="s0">, </span><span class="s1">self.get_container().get_size()[</span><span class="s4">0</span><span class="s1">] - </span><span class="s4">20</span><span class="s0">, </span><span class="s4">25</span><span class="s1">)</span>
        <span class="s1">self.file_path_text_line = UITextEntryLine(relative_rect=text_line_rect</span><span class="s0">,</span>
                                                   <span class="s1">manager=self.ui_manager</span><span class="s0">,</span>
                                                   <span class="s1">container=self</span><span class="s0">,</span>
                                                   <span class="s1">object_id=</span><span class="s3">'#file_path_text_line'</span><span class="s0">,</span>
                                                   <span class="s1">anchors={</span><span class="s3">'left'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
                                                            <span class="s3">'right'</span><span class="s1">: </span><span class="s3">'right'</span><span class="s0">,</span>
                                                            <span class="s3">'top'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s0">,</span>
                                                            <span class="s3">'bottom'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s1">}</span>
                                                   <span class="s1">)</span>
        <span class="s0">if </span><span class="s1">self.current_file_path </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">self.file_path_text_line.set_text(str(self.current_file_path))</span>
            <span class="s1">self._highlight_file_name_for_editing()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self.file_path_text_line.set_text(str(self.current_directory_path))</span>

        <span class="s1">file_selection_rect = pygame.Rect(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">80</span><span class="s0">, </span><span class="s1">self.get_container().get_size()[</span><span class="s4">0</span><span class="s1">] - </span><span class="s4">20</span><span class="s0">,</span>
                                          <span class="s1">self.get_container().get_size()[</span><span class="s4">1</span><span class="s1">] - </span><span class="s4">130</span><span class="s1">)</span>
        <span class="s1">self.file_selection_list = UISelectionList(relative_rect=file_selection_rect</span><span class="s0">,</span>
                                                   <span class="s1">item_list=self.current_file_list</span><span class="s0">,</span>
                                                   <span class="s1">manager=self.ui_manager</span><span class="s0">,</span>
                                                   <span class="s1">container=self</span><span class="s0">,</span>
                                                   <span class="s1">object_id=</span><span class="s3">'#file_display_list'</span><span class="s0">,</span>
                                                   <span class="s1">anchors={</span><span class="s3">'left'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
                                                            <span class="s3">'right'</span><span class="s1">: </span><span class="s3">'right'</span><span class="s0">,</span>
                                                            <span class="s3">'top'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s0">,</span>
                                                            <span class="s3">'bottom'</span><span class="s1">: </span><span class="s3">'bottom'</span><span class="s1">})</span>

    <span class="s0">def </span><span class="s1">_highlight_file_name_for_editing(self):</span>
        <span class="s5"># try highlighting the file name</span>
        <span class="s0">if </span><span class="s1">self.current_file_path </span><span class="s0">is None or </span><span class="s1">self.allow_existing_files_only:</span>
            <span class="s0">return</span>
        <span class="s1">highlight_start = self.file_path_text_line.get_text().find(self.current_file_path.stem)</span>
        <span class="s1">highlight_end = highlight_start + len(self.current_file_path.stem)</span>
        <span class="s1">self.file_path_text_line.select_range[</span><span class="s4">0</span><span class="s1">] = highlight_start</span>
        <span class="s1">self.file_path_text_line.select_range[</span><span class="s4">1</span><span class="s1">] = highlight_end</span>
        <span class="s1">self.file_path_text_line.cursor_has_moved_recently = </span><span class="s0">True</span>
        <span class="s1">self.file_path_text_line.edit_position = highlight_end</span>

        <span class="s1">text_clip_width = (self.file_path_text_line.rect.width -</span>
                           <span class="s1">(self.file_path_text_line.padding[</span><span class="s4">0</span><span class="s1">] * </span><span class="s4">2</span><span class="s1">) -</span>
                           <span class="s1">(self.file_path_text_line.shape_corner_radius * </span><span class="s4">2</span><span class="s1">) -</span>
                           <span class="s1">(self.file_path_text_line.border_width * </span><span class="s4">2</span><span class="s1">) -</span>
                           <span class="s1">(self.file_path_text_line.shadow_width * </span><span class="s4">2</span><span class="s1">))</span>

        <span class="s1">text_width = self.file_path_text_line.font.size(self.file_path_text_line.get_text())[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">self.file_path_text_line.start_text_offset = max(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">text_width - text_clip_width)</span>
        <span class="s0">if not </span><span class="s1">self.file_path_text_line.is_focused:</span>
            <span class="s1">self.file_path_text_line.focus()</span>

    <span class="s0">def </span><span class="s1">update_current_file_list(self):</span>
        <span class="s2">&quot;&quot;&quot; 
        Updates the currently displayed list of files and directories. Usually called when the 
        directory path has changed. 
        &quot;&quot;&quot;</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s1">directories_on_path = [f.name </span><span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">Path(self.current_directory_path).iterdir()</span>
                                   <span class="s0">if not </span><span class="s1">f.is_file()]</span>
            <span class="s1">directories_on_path = sorted(directories_on_path</span><span class="s0">, </span><span class="s1">key=str.casefold)</span>
            <span class="s1">directories_on_path_tuples = [(f</span><span class="s0">, </span><span class="s3">'#directory_list_item'</span><span class="s1">) </span><span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">directories_on_path]</span>

            <span class="s1">files_on_path = [f.name </span><span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">Path(self.current_directory_path).iterdir()</span>
                             <span class="s0">if </span><span class="s1">f.is_file()]</span>
            <span class="s1">files_on_path = sorted(files_on_path</span><span class="s0">, </span><span class="s1">key=str.casefold)</span>
            <span class="s1">files_on_path_tuples = [(f</span><span class="s0">, </span><span class="s3">'#file_list_item'</span><span class="s1">) </span><span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">files_on_path]</span>

            <span class="s1">self.current_file_list = directories_on_path_tuples + files_on_path_tuples</span>
        <span class="s0">except </span><span class="s1">(PermissionError</span><span class="s0">, </span><span class="s1">FileNotFoundError):</span>
            <span class="s1">self.current_directory_path = self.last_valid_directory_path</span>
            <span class="s1">self.update_current_file_list()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self.last_valid_directory_path = self.current_directory_path</span>

    <span class="s0">def </span><span class="s1">_validate_file_path(self</span><span class="s0">, </span><span class="s1">path_to_validate: Path) -&gt; bool:</span>
        <span class="s0">if </span><span class="s1">self.allow_existing_files_only:</span>
            <span class="s0">return </span><span class="s1">self._validate_path_exists_and_of_allowed_type(path_to_validate</span><span class="s0">,</span>
                                                                  <span class="s1">self.allow_picking_directories)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">self._validate_path_in_existing_directory(path_to_validate)</span>

    <span class="s1">@staticmethod</span>
    <span class="s0">def </span><span class="s1">_validate_path_in_existing_directory(path_to_validate: Path) -&gt; bool:</span>
        <span class="s2">&quot;&quot;&quot; 
        Checks the selected path is valid. 
 
        :return: True if valid. 
 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">path_to_validate </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s0">return False</span>
        <span class="s0">return </span><span class="s1">len(path_to_validate.name) &gt; </span><span class="s4">0 </span><span class="s0">and </span><span class="s1">path_to_validate.parent.exists()</span>

    <span class="s1">@staticmethod</span>
    <span class="s0">def </span><span class="s1">_validate_path_exists_and_of_allowed_type(path_to_validate: Path</span><span class="s0">,</span>
                                                  <span class="s1">allow_directories: bool) -&gt; bool:</span>
        <span class="s2">&quot;&quot;&quot; 
        Checks the selected path is valid. 
 
        :return: True if valid. 
 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">path_to_validate </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s0">return False</span>
        <span class="s0">if </span><span class="s1">allow_directories:</span>
            <span class="s1">valid_type = (path_to_validate.is_file() </span><span class="s0">or </span><span class="s1">path_to_validate.is_dir())</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">valid_type = path_to_validate.is_file()</span>
        <span class="s0">return </span><span class="s1">path_to_validate.exists() </span><span class="s0">and </span><span class="s1">valid_type</span>

    <span class="s0">def </span><span class="s1">process_event(self</span><span class="s0">, </span><span class="s1">event: pygame.event.Event) -&gt; bool:</span>
        <span class="s2">&quot;&quot;&quot; 
        Handles events that this UI element is interested in. There are a lot of buttons in the 
        file dialog. 
 
        :param event: The pygame Event to process. 
 
        :return: True if event is consumed by this element and should not be passed on to other 
                 elements. 
 
        &quot;&quot;&quot;</span>
        <span class="s1">handled = super().process_event(event)</span>

        <span class="s1">self._process_ok_cancel_events(event)</span>
        <span class="s1">self._process_confirmation_dialog_events(event)</span>
        <span class="s1">self._process_mini_file_operation_button_events(event)</span>
        <span class="s1">self._process_file_path_entry_events(event)</span>
        <span class="s1">self._process_file_list_events(event)</span>

        <span class="s0">return </span><span class="s1">handled</span>

    <span class="s0">def </span><span class="s1">_process_file_path_entry_events(self</span><span class="s0">, </span><span class="s1">event):</span>
        <span class="s2">&quot;&quot;&quot; 
        Handle events coming from text entry element which displays the current file path. 
 
        :param event: event to check. 
 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">(event.type != pygame.USEREVENT</span>
                <span class="s0">or </span><span class="s1">event.user_type </span><span class="s0">not in </span><span class="s1">[UI_TEXT_ENTRY_FINISHED</span><span class="s0">, </span><span class="s1">UI_TEXT_ENTRY_CHANGED]</span>
                <span class="s0">or </span><span class="s1">event.ui_element != self.file_path_text_line):</span>
            <span class="s0">return</span>
        <span class="s1">entered_file_path = Path(self.file_path_text_line.get_text()).absolute()</span>
        <span class="s0">if </span><span class="s1">self._validate_file_path(entered_file_path):</span>
            <span class="s0">if </span><span class="s1">len(entered_file_path.name) &gt; </span><span class="s4">0 </span><span class="s0">and </span><span class="s1">(entered_file_path.is_file() </span><span class="s0">or</span>
                                                    <span class="s0">not </span><span class="s1">entered_file_path.exists()):</span>
                <span class="s1">self.current_file_path = entered_file_path</span>

                <span class="s0">if </span><span class="s1">self._validate_path_exists_and_of_allowed_type(self.current_file_path</span><span class="s0">,</span>
                                                                  <span class="s1">allow_directories=</span><span class="s0">False</span><span class="s1">):</span>
                    <span class="s1">self.delete_button.enable()</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">self.delete_button.disable()</span>
                <span class="s1">self.ok_button.enable()</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">self.current_directory_path = str(entered_file_path)</span>
                <span class="s1">self.current_file_path = </span><span class="s0">None</span>
                <span class="s1">self.delete_button.disable()</span>
                <span class="s1">self.ok_button.disable()</span>

            <span class="s0">if </span><span class="s1">event.user_type == UI_TEXT_ENTRY_FINISHED:</span>
                <span class="s0">if </span><span class="s1">len(entered_file_path.name) &gt; </span><span class="s4">0 </span><span class="s0">and </span><span class="s1">entered_file_path.is_dir():</span>
                    <span class="s1">self.current_directory_path = str(entered_file_path)</span>
                <span class="s0">elif </span><span class="s1">len(entered_file_path.name) &gt; </span><span class="s4">0 </span><span class="s0">and </span><span class="s1">(entered_file_path.is_file() </span><span class="s0">or</span>
                                                          <span class="s0">not </span><span class="s1">entered_file_path.exists()):</span>
                    <span class="s1">self.current_directory_path = str(entered_file_path.parent.absolute())</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">self.current_directory_path = str(entered_file_path)</span>

                <span class="s1">self.update_current_file_list()</span>
                <span class="s1">self.file_selection_list.set_item_list(self.current_file_list)</span>

                <span class="s0">if </span><span class="s1">self.current_file_path </span><span class="s0">is not None</span><span class="s1">:</span>
                    <span class="s1">self.file_path_text_line.set_text(str(self.current_file_path))</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">self.file_path_text_line.set_text(self.current_directory_path)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self.current_directory_path = self.last_valid_directory_path</span>
            <span class="s1">self.current_file_path = </span><span class="s0">None</span>
            <span class="s1">self.delete_button.disable()</span>
            <span class="s1">self.ok_button.disable()</span>

    <span class="s0">def </span><span class="s1">_process_file_list_events(self</span><span class="s0">, </span><span class="s1">event):</span>
        <span class="s2">&quot;&quot;&quot; 
        Handle events coming from the file/folder list. 
 
        :param event: event to check. 
 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">(event.type == pygame.USEREVENT </span><span class="s0">and</span>
                <span class="s1">event.user_type == UI_SELECTION_LIST_NEW_SELECTION </span><span class="s0">and</span>
                <span class="s1">event.ui_element == self.file_selection_list):</span>
            <span class="s1">new_selection_file_path = Path(self.current_directory_path) / event.text</span>
            <span class="s0">if </span><span class="s1">self._validate_path_exists_and_of_allowed_type(new_selection_file_path</span><span class="s0">,</span>
                                                              <span class="s1">self.allow_picking_directories):</span>
                <span class="s1">self.current_file_path = new_selection_file_path</span>
                <span class="s1">self.file_path_text_line.set_text(str(self.current_file_path))</span>
                <span class="s1">self._highlight_file_name_for_editing()</span>
                <span class="s1">self.ok_button.enable()</span>
                <span class="s0">if </span><span class="s1">self._validate_path_exists_and_of_allowed_type(self.current_file_path</span><span class="s0">,</span>
                                                                  <span class="s1">allow_directories=</span><span class="s0">False</span><span class="s1">):</span>
                    <span class="s1">self.delete_button.enable()</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">self.delete_button.disable()</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">self.ok_button.disable()</span>
                <span class="s1">self.delete_button.disable()</span>
        <span class="s0">if </span><span class="s1">(event.type == pygame.USEREVENT </span><span class="s0">and</span>
                <span class="s1">event.user_type == UI_SELECTION_LIST_DOUBLE_CLICKED_SELECTION</span>
                <span class="s0">and </span><span class="s1">event.ui_element == self.file_selection_list):</span>
            <span class="s1">new_directory_file_path = Path(self.current_directory_path) / event.text</span>
            <span class="s1">self._change_directory_path(new_directory_file_path)</span>

    <span class="s0">def </span><span class="s1">_change_directory_path(self</span><span class="s0">, </span><span class="s1">new_directory_path: Path):</span>
        <span class="s2">&quot;&quot;&quot; 
        Change the current directory path and update everything that needs to update when that 
        happens. 
 
        :param new_directory_path: The new path to change to. 
        &quot;&quot;&quot;</span>
        <span class="s0">if not </span><span class="s1">new_directory_path.exists() </span><span class="s0">or </span><span class="s1">new_directory_path.is_file():</span>
            <span class="s0">return</span>
        <span class="s1">self.current_directory_path = str(new_directory_path.resolve())</span>
        <span class="s1">self.update_current_file_list()</span>
        <span class="s1">self.file_selection_list.set_item_list(self.current_file_list)</span>

        <span class="s0">if </span><span class="s1">self.current_file_path </span><span class="s0">is not None and not </span><span class="s1">self.allow_existing_files_only:</span>
            <span class="s1">self.current_file_path = (new_directory_path / self.current_file_path.name).resolve()</span>
            <span class="s1">self.file_path_text_line.set_text(str(self.current_file_path))</span>
            <span class="s1">self._highlight_file_name_for_editing()</span>
            <span class="s1">self.ok_button.enable()</span>
            <span class="s0">if </span><span class="s1">self._validate_path_exists_and_of_allowed_type(self.current_file_path</span><span class="s0">,</span>
                                                              <span class="s1">allow_directories=</span><span class="s0">False</span><span class="s1">):</span>
                <span class="s1">self.delete_button.enable()</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">self.delete_button.disable()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self.current_file_path = </span><span class="s0">None</span>
            <span class="s1">self.file_path_text_line.set_text(self.current_directory_path)</span>
            <span class="s1">self.delete_button.disable()</span>
            <span class="s1">self.ok_button.disable()</span>

    <span class="s0">def </span><span class="s1">_process_confirmation_dialog_events(self</span><span class="s0">, </span><span class="s1">event):</span>
        <span class="s2">&quot;&quot;&quot; 
        Handle any events coming from the confirmation dialog if that's up. 
 
        :param event: event to check. 
 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">(event.type != pygame.USEREVENT</span>
                <span class="s0">or </span><span class="s1">event.user_type != UI_CONFIRMATION_DIALOG_CONFIRMED</span>
                <span class="s0">or </span><span class="s1">event.ui_element != self.delete_confirmation_dialog):</span>
            <span class="s0">return</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s1">self.current_file_path.unlink()</span>
        <span class="s0">except </span><span class="s1">(PermissionError</span><span class="s0">, </span><span class="s1">FileNotFoundError):</span>
            <span class="s0">pass</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self.current_file_path = </span><span class="s0">None</span>
            <span class="s1">self.delete_button.disable()</span>
            <span class="s1">self.ok_button.disable()</span>

            <span class="s1">self.update_current_file_list()</span>
            <span class="s1">self.file_path_text_line.set_text(self.current_directory_path)</span>
            <span class="s1">self.file_selection_list.set_item_list(self.current_file_list)</span>

    <span class="s0">def </span><span class="s1">_process_mini_file_operation_button_events(self</span><span class="s0">, </span><span class="s1">event):</span>
        <span class="s2">&quot;&quot;&quot; 
        Handle what happens when you press one of the tiny file/folder operation buttons. 
 
        :param event: event to check. 
 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">(event.type == pygame.USEREVENT </span><span class="s0">and </span><span class="s1">event.user_type == UI_BUTTON_PRESSED</span>
                <span class="s0">and </span><span class="s1">event.ui_element == self.delete_button):</span>
            <span class="s1">confirmation_rect = pygame.Rect(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">300</span><span class="s0">, </span><span class="s4">200</span><span class="s1">)</span>
            <span class="s1">confirmation_rect.center = self.rect.center</span>

            <span class="s1">selected_file_name = self.current_file_path.name</span>
            <span class="s1">long_desc = </span><span class="s3">&quot;Delete &quot; </span><span class="s1">+ str(selected_file_name) + </span><span class="s3">&quot;?&quot;</span>
            <span class="s1">self.delete_confirmation_dialog = UIConfirmationDialog(rect=confirmation_rect</span><span class="s0">,</span>
                                                                   <span class="s1">manager=self.ui_manager</span><span class="s0">,</span>
                                                                   <span class="s1">action_long_desc=long_desc</span><span class="s0">,</span>
                                                                   <span class="s1">action_short_name=</span><span class="s3">'Delete'</span><span class="s0">,</span>
                                                                   <span class="s1">window_title=</span><span class="s3">'Delete'</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">(event.type == pygame.USEREVENT </span><span class="s0">and </span><span class="s1">event.user_type == UI_BUTTON_PRESSED</span>
                <span class="s0">and </span><span class="s1">event.ui_element == self.parent_directory_button):</span>
            <span class="s1">self._change_directory_path(Path(self.current_directory_path).parent)</span>
        <span class="s0">if </span><span class="s1">(event.type == pygame.USEREVENT </span><span class="s0">and </span><span class="s1">event.user_type == UI_BUTTON_PRESSED</span>
                <span class="s0">and </span><span class="s1">event.ui_element == self.refresh_button):</span>
            <span class="s1">self._change_directory_path(Path(self.current_directory_path))</span>
        <span class="s0">if </span><span class="s1">(event.type == pygame.USEREVENT </span><span class="s0">and </span><span class="s1">event.user_type == UI_BUTTON_PRESSED</span>
                <span class="s0">and </span><span class="s1">event.ui_element == self.home_button):</span>
            <span class="s1">self._change_directory_path(Path.home())</span>

    <span class="s0">def </span><span class="s1">_process_ok_cancel_events(self</span><span class="s0">, </span><span class="s1">event):</span>
        <span class="s2">&quot;&quot;&quot; 
        Handle what happens when you press OK and Cancel. 
 
        :param event: event to check. 
 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">(event.type == pygame.USEREVENT </span><span class="s0">and </span><span class="s1">event.user_type == UI_BUTTON_PRESSED</span>
                <span class="s0">and </span><span class="s1">event.ui_element == self.cancel_button):</span>
            <span class="s1">self.kill()</span>
        <span class="s0">if </span><span class="s1">(event.type == pygame.USEREVENT </span><span class="s0">and </span><span class="s1">event.user_type == UI_BUTTON_PRESSED</span>
                <span class="s0">and </span><span class="s1">event.ui_element == self.ok_button</span>
                <span class="s0">and </span><span class="s1">self._validate_file_path(self.current_file_path)):</span>
            <span class="s1">event_data = {</span><span class="s3">'user_type'</span><span class="s1">: UI_FILE_DIALOG_PATH_PICKED</span><span class="s0">,</span>
                          <span class="s3">'text'</span><span class="s1">: str(self.current_file_path)</span><span class="s0">,</span>
                          <span class="s3">'ui_element'</span><span class="s1">: self</span><span class="s0">,</span>
                          <span class="s3">'ui_object_id'</span><span class="s1">: self.most_specific_combined_id}</span>
            <span class="s1">new_file_chosen_event = pygame.event.Event(pygame.USEREVENT</span><span class="s0">, </span><span class="s1">event_data)</span>
            <span class="s1">pygame.event.post(new_file_chosen_event)</span>
            <span class="s1">self.kill()</span>
</pre>
</body>
</html>