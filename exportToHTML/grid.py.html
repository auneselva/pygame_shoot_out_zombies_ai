<html>
<head>
<title>grid.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
grid.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">pygame</span>

<span class="s0">from </span><span class="s1">thorpy.gamestools.basegrid </span><span class="s0">import </span><span class="s1">BaseGrid</span>

<span class="s1">NA = [(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)]</span>
<span class="s1">NB = [(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)] + NA</span>


<span class="s0">class </span><span class="s1">Grid(BaseGrid):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">nx</span><span class="s0">, </span><span class="s1">ny</span><span class="s0">, </span><span class="s1">cell_size</span><span class="s0">, </span><span class="s1">topleft=(</span><span class="s2">0</span><span class="s0">,</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">value=</span><span class="s0">None,</span>
                 <span class="s1">periodicity=(</span><span class="s0">False, False</span><span class="s1">)):</span>
        <span class="s1">BaseGrid.__init__(self</span><span class="s0">, </span><span class="s1">nx</span><span class="s0">, </span><span class="s1">ny</span><span class="s0">, </span><span class="s1">value</span><span class="s0">, </span><span class="s1">periodicity)</span>
        <span class="s1">self.cell_w = cell_size[</span><span class="s2">0</span><span class="s1">]</span>
        <span class="s1">self.cell_h = cell_size[</span><span class="s2">1</span><span class="s1">]</span>
        <span class="s1">self.frame = pygame.Rect(topleft</span><span class="s0">,</span>
                                 <span class="s1">(self.nx*self.cell_w</span><span class="s0">, </span><span class="s1">self.ny*self.cell_h))</span>
        <span class="s1">self.cell_rect = self.build_cell_rect()</span>

    <span class="s0">def </span><span class="s1">__len__(self):</span>
        <span class="s0">return </span><span class="s1">self.nx*self.ny</span>

    <span class="s0">def </span><span class="s1">copy(self):</span>
        <span class="s1">copied = BaseGrid.copy(self)</span>
        <span class="s1">copied.cell_w = self.cell_w</span>
        <span class="s1">copied.cell_h = self.cell_h</span>
        <span class="s1">copied.frame = self.frame.copy()</span>
        <span class="s1">copied.cell_rect = self.cell_rect.copy()</span>
        <span class="s0">return </span><span class="s1">copied</span>

    <span class="s0">def </span><span class="s1">build_cell_rect(self):</span>
        <span class="s1">topleft = (self.frame.left</span><span class="s0">, </span><span class="s1">self.frame.bottom - self.cell_h)</span>
        <span class="s0">return </span><span class="s1">pygame.Rect(topleft</span><span class="s0">, </span><span class="s1">(self.cell_w</span><span class="s0">, </span><span class="s1">self.cell_h))</span>

    <span class="s0">def </span><span class="s1">move(self</span><span class="s0">, </span><span class="s1">shift):</span>
        <span class="s1">self.frame.move_ip(shift)</span>
        <span class="s1">self.cell_rect = self.build_cell_rect()</span>

    <span class="s0">def </span><span class="s1">set_topleft(self</span><span class="s0">, </span><span class="s1">pos):</span>
        <span class="s1">self.frame.topleft = pos</span>
        <span class="s1">self.cell_rect = self.build_cell_rect()</span>

    <span class="s0">def </span><span class="s1">set_bottomleft(self</span><span class="s0">, </span><span class="s1">pos):</span>
        <span class="s1">self.frame.bottomleft = pos</span>
        <span class="s1">self.cell_rect = self.build_cell_rect()</span>

    <span class="s0">def </span><span class="s1">set_center(self</span><span class="s0">, </span><span class="s1">pos):</span>
        <span class="s1">self.frame.center = pos</span>
        <span class="s1">self.cell_rect = self.build_cell_rect()</span>

    <span class="s0">def </span><span class="s1">center_on(self</span><span class="s0">, </span><span class="s1">pos):</span>
        <span class="s0">if </span><span class="s1">isinstance(pos</span><span class="s0">, </span><span class="s1">pygame.Rect):</span>
            <span class="s1">pos = pos.center</span>
        <span class="s1">self.set_center(pos)</span>

    <span class="s0">def </span><span class="s1">iterrects(self):</span>
        <span class="s0">for </span><span class="s1">coord </span><span class="s0">in </span><span class="s1">self:</span>
            <span class="s0">yield </span><span class="s1">self.get_rect_at_coord(coord)</span>

    <span class="s0">def </span><span class="s1">get_rect_at_coord(self</span><span class="s0">, </span><span class="s1">coord):</span>
        <span class="s1">shift_x = coord[</span><span class="s2">0</span><span class="s1">] * self.cell_w</span>
        <span class="s1">shift_y = coord[</span><span class="s2">1</span><span class="s1">] * self.cell_h</span>
        <span class="s0">return </span><span class="s1">self.cell_rect.move((shift_x</span><span class="s0">, </span><span class="s1">-shift_y))</span>

    <span class="s0">def </span><span class="s1">get_coord_at_pix(self</span><span class="s0">, </span><span class="s1">pix):</span>
        <span class="s1">x = pix[</span><span class="s2">0</span><span class="s1">] - self.frame.left</span>
        <span class="s1">y = self.frame.bottom - pix[</span><span class="s2">1</span><span class="s1">]</span>
        <span class="s1">cx = int(x * self.nx / self.frame.width)</span>
        <span class="s1">cy = int(y * self.ny / self.frame.height)</span>
        <span class="s0">return </span><span class="s1">(cx</span><span class="s0">, </span><span class="s1">cy)</span>

    <span class="s0">def </span><span class="s1">get_rect_at_pix(self</span><span class="s0">, </span><span class="s1">pix):</span>
        <span class="s0">return </span><span class="s1">self.get_rect_at_coord(self.get_coord_at_pix(pix))</span>

<span class="s3">##    def blit_cell_on(self, surface, color, coord, thick=1):</span>
<span class="s3">##        r = self.get_rect_at_coord(coord)</span>
<span class="s3">##        pygame.draw.rect(surface, color, r, thick)</span>
<span class="s3">##</span>
<span class="s3">##    def blit_on(self, surface, cell_color=(0, 0, 0), frame_color=(0,0,0)):</span>
<span class="s3">##        for coord in self:</span>
<span class="s3">##            self.blit_cell_on(surface, color, coord)</span>
<span class="s3">##        pygame.draw.rect(surface, frame_color, self.frame, 1)</span>

<span class="s0">class </span><span class="s1">PygameGrid(Grid):</span>

    <span class="s0">def </span><span class="s1">build_cell_rect(self):</span>
        <span class="s0">return </span><span class="s1">pygame.Rect(self.frame.topleft</span><span class="s0">, </span><span class="s1">(self.cell_w</span><span class="s0">, </span><span class="s1">self.cell_h))</span>

    <span class="s0">def </span><span class="s1">get_rect_at_coord(self</span><span class="s0">, </span><span class="s1">coord):</span>
        <span class="s1">shift_x = coord[</span><span class="s2">0</span><span class="s1">] * self.cell_w</span>
        <span class="s1">shift_y = coord[</span><span class="s2">1</span><span class="s1">] * self.cell_h</span>
        <span class="s0">return </span><span class="s1">self.cell_rect.move((shift_x</span><span class="s0">, </span><span class="s1">shift_y))</span>

    <span class="s0">def </span><span class="s1">get_coord_at_pix(self</span><span class="s0">, </span><span class="s1">pix):</span>
        <span class="s1">x = pix[</span><span class="s2">0</span><span class="s1">] - self.frame.left</span>
        <span class="s1">y = pix[</span><span class="s2">1</span><span class="s1">] - self.frame.bottom</span>
        <span class="s1">cx = int(x * self.nx / self.frame.width)</span>
        <span class="s1">cy = int(y * self.ny / self.frame.height)</span>
        <span class="s0">return </span><span class="s1">(cx</span><span class="s0">, </span><span class="s1">cy)</span>

    <span class="s0">def </span><span class="s1">get_rect_at_pix(self</span><span class="s0">, </span><span class="s1">pix):</span>
        <span class="s0">return </span><span class="s1">self.get_rect_at_coord(self.get_coord_at_pix(pix))</span></pre>
</body>
</html>