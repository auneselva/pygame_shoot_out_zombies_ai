<html>
<head>
<title>_cursor.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_cursor.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">thorpy.elements.element </span><span class="s0">import </span><span class="s1">Element</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui.reaction </span><span class="s0">import </span><span class="s1">Reaction</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui.initializer </span><span class="s0">import </span><span class="s1">Initializer</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui.state </span><span class="s0">import </span><span class="s1">State</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui </span><span class="s0">import </span><span class="s1">constants</span><span class="s0">, </span><span class="s1">parameters</span><span class="s0">, </span><span class="s1">style</span><span class="s0">, </span><span class="s1">painterstyle</span>

<span class="s0">class </span><span class="s1">_Cursor(Element):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">,</span>
                 <span class="s1">father</span><span class="s0">,</span>
                 <span class="s1">fact=</span><span class="s0">None,</span>
                 <span class="s1">thickness=</span><span class="s0">None,</span>
                 <span class="s1">color=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">fact = style.CURS_FACT </span><span class="s0">if </span><span class="s1">fact </span><span class="s0">is None else </span><span class="s1">fact</span>
        <span class="s1">thickness = style.CURS_THICK </span><span class="s0">if </span><span class="s1">thickness </span><span class="s0">is None else </span><span class="s1">thickness</span>
        <span class="s1">color = style.CURS_COLOR </span><span class="s0">if </span><span class="s1">color </span><span class="s0">is None else </span><span class="s1">color</span>
        <span class="s1">self.father = father</span>
        <span class="s1">self._fact = fact  </span><span class="s2"># should be 0 if img is used</span>
        <span class="s1">cursor_size = (thickness</span><span class="s0">, </span><span class="s1">self._fact*self.father._iwriter.get_zone().h)</span>
        <span class="s1">normal_painter = painterstyle.CURSOR_PAINTER(size=cursor_size</span><span class="s0">,</span>
                                                     <span class="s1">color=color)</span>
        <span class="s1">timed_painter = painterstyle.CURSOR_PAINTER(</span>
            <span class="s1">size=cursor_size</span><span class="s0">,</span>
            <span class="s1">color=constants.TRANSPARENT)</span>
        <span class="s1">super(_Cursor</span><span class="s0">, </span><span class="s1">self).__init__(finish=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">self.normal_params.params[</span><span class="s3">&quot;painter&quot;</span><span class="s1">] = normal_painter</span>
        <span class="s1">self.time_params = Initializer()</span>
        <span class="s1">self.time_params.params[</span><span class="s3">&quot;painter&quot;</span><span class="s1">] = timed_painter</span>
        <span class="s1">reac_time = Reaction(constants.THORPY_EVENT</span><span class="s0">,</span>
                             <span class="s1">self._reaction_time</span><span class="s0">,</span>
                             <span class="s1">{</span><span class="s3">&quot;id&quot;</span><span class="s1">:constants.EVENT_TIME}</span><span class="s0">,</span>
                             <span class="s1">reac_name=constants.REAC_TIME)</span>
        <span class="s1">self.add_reaction(reac_time)</span>
        <span class="s1">self.switch_time = parameters.CURSOR_INTERVAL  </span><span class="s2"># switch time in ms</span>
        <span class="s1">self._switch = </span><span class="s4">0  </span><span class="s2"># time [ms] from last state switch</span>
        <span class="s1">self._activated = </span><span class="s0">False</span>
        <span class="s1">self._original_blit = self.blit</span>
        <span class="s1">self.init_space = </span><span class="s4">0</span>

    <span class="s0">def </span><span class="s1">finish(self):</span>
        <span class="s1">Element.finish(self)</span>
        <span class="s1">time_state = State(self.time_params.get_fusionner())</span>
        <span class="s1">self.add_state(constants.REAC_TIME</span><span class="s0">, </span><span class="s1">time_state)</span>
        <span class="s1">self.set_init_pos()</span>
        <span class="s1">self.change_state(constants.REAC_TIME)</span>

    <span class="s0">def </span><span class="s1">exit(self):</span>
        <span class="s1">self._activated = </span><span class="s0">False</span>
        <span class="s1">self.change_state(constants.REAC_TIME)</span>
        <span class="s1">self.unblit()</span>
        <span class="s1">self.update()</span>

    <span class="s0">def </span><span class="s1">set_topleft(self</span><span class="s0">, </span><span class="s1">pos</span><span class="s0">, </span><span class="s1">state=constants.STATE_NORMAL):</span>
        <span class="s1">left</span><span class="s0">, </span><span class="s1">top = pos</span>
        <span class="s1">w = self._states[state].fusionner.rect.width</span>
        <span class="s1">zone = self.father._iwriter.get_zone()</span>
        <span class="s0">if </span><span class="s1">left + w &gt; zone.right:</span>
            <span class="s1">left = zone.right - w</span>
        <span class="s1">Element.set_topleft(self</span><span class="s0">, </span><span class="s1">(left</span><span class="s0">, </span><span class="s1">top)</span><span class="s0">, </span><span class="s1">state)</span>

    <span class="s0">def </span><span class="s1">set_init_pos(self):</span>
        <span class="s5">&quot;&quot;&quot;Set cursor to initial position&quot;&quot;&quot;</span>
        <span class="s1">pos = self.father._iwriter._get_cursor_pos()</span>
        <span class="s1">zone = self.father._iwriter.get_zone()</span>
        <span class="s1">x = pos[</span><span class="s4">0</span><span class="s1">] + self.init_space</span>
        <span class="s1">y = zone.y + (</span><span class="s4">1. </span><span class="s1">- self._fact) / </span><span class="s4">2 </span><span class="s1">* zone.h</span>
        <span class="s1">self.set_topleft((x</span><span class="s0">, </span><span class="s1">y))</span>

<span class="s2">##    def switch_state(self):</span>
<span class="s2">##        &quot;&quot;&quot;Switch REAC_TIME and STATE_NORMAL states&quot;&quot;&quot;</span>
<span class="s2">##        if self.current_state_key == constants.REAC_TIME:</span>
<span class="s2">##            self.change_state(constants.STATE_NORMAL)</span>
<span class="s2">##            self.solo_blit()</span>
<span class="s2">##        else:</span>
<span class="s2">##            self.change_state(constants.REAC_TIME)</span>
<span class="s2">##            r = self.get_fus_rect()</span>
<span class="s2">##            self.father.unblit(r)</span>
<span class="s2">##            self.father.partial_blit(self, r)</span>
<span class="s2">##        self.solo_update()</span>

    <span class="s0">def </span><span class="s1">switch_state(self):</span>
        <span class="s5">&quot;&quot;&quot;Switch REAC_TIME and STATE_NORMAL states&quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self.current_state_key == constants.REAC_TIME:</span>
            <span class="s1">self.change_state(constants.STATE_NORMAL)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self.change_state(constants.REAC_TIME)</span>
        <span class="s1">self.father.unblit()</span>
        <span class="s1">self.father.blit()</span>
        <span class="s1">self.father.update()</span>

    <span class="s0">def </span><span class="s1">_reaction_time(self</span><span class="s0">, </span><span class="s1">event):</span>
        <span class="s5">&quot;&quot;&quot;Reaction to EVENT_TIME event&quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self._activated:</span>
            <span class="s1">self._switch += event.tick</span>
            <span class="s0">if </span><span class="s1">self._switch &gt; self.switch_time:  </span><span class="s2"># then must switch</span>
                <span class="s1">self._switch = </span><span class="s4">0</span>
                <span class="s1">self.switch_state()</span>
</pre>
</body>
</html>