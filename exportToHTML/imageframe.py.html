<html>
<head>
<title>imageframe.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
imageframe.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">pygame </span><span class="s0">import </span><span class="s1">RLEACCEL</span><span class="s0">, </span><span class="s1">Surface</span>
<span class="s0">from </span><span class="s1">pygame.transform </span><span class="s0">import </span><span class="s1">scale</span>

<span class="s0">from </span><span class="s1">thorpy._utils.images </span><span class="s0">import </span><span class="s1">load_image</span>
<span class="s0">from </span><span class="s1">thorpy.painting.painters.painter </span><span class="s0">import </span><span class="s1">Painter</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui </span><span class="s0">import </span><span class="s1">functions</span>


<span class="s0">class </span><span class="s1">ImageFrame(Painter):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">img_path</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s2">255</span><span class="s0">, </span><span class="s1">colorkey=</span><span class="s0">None, </span><span class="s1">clip=</span><span class="s0">None,</span>
                 <span class="s1">pressed=</span><span class="s0">False, </span><span class="s1">mode=</span><span class="s0">None, </span><span class="s1">hovered=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s1">self.alpha = alpha</span>
        <span class="s1">self.img_path = img_path</span>
        <span class="s1">self.colorkey = colorkey</span>
        <span class="s1">self.mode = mode</span>
<span class="s3">##        print(&quot;type3&quot;,img_path)</span>
        <span class="s1">size = list(self.init_get_img().get_size())</span>
        <span class="s1">W</span><span class="s0">, </span><span class="s1">H = functions.get_screen_size()</span>
        <span class="s0">if </span><span class="s1">self.mode == </span><span class="s4">&quot;cut&quot;</span><span class="s1">:</span>
            <span class="s0">if </span><span class="s1">W &lt; size[</span><span class="s2">0</span><span class="s1">]:</span>
                <span class="s1">size[</span><span class="s2">0</span><span class="s1">] = W</span>
            <span class="s0">if </span><span class="s1">H &lt; size[</span><span class="s2">1</span><span class="s1">]:</span>
                <span class="s1">size[</span><span class="s2">1</span><span class="s1">] = H</span>
        <span class="s1">Painter.__init__(self</span><span class="s0">, </span><span class="s1">size=size</span><span class="s0">, </span><span class="s1">clip=clip</span><span class="s0">, </span><span class="s1">pressed=pressed</span><span class="s0">,</span>
                         <span class="s1">hovered=hovered)</span>
        <span class="s1">self._resized = </span><span class="s0">False</span>

    <span class="s0">def </span><span class="s1">set_size(self</span><span class="s0">, </span><span class="s1">size):</span>
        <span class="s3"># define a way to resize (deform or cut)</span>
        <span class="s3"># refresh self.size</span>
        <span class="s1">W</span><span class="s0">, </span><span class="s1">H = functions.get_screen_size()</span>
        <span class="s0">if </span><span class="s1">self.mode == </span><span class="s4">&quot;cut&quot;</span><span class="s1">:</span>
            <span class="s0">if </span><span class="s1">W &lt; size[</span><span class="s2">0</span><span class="s1">]:</span>
                <span class="s1">size[</span><span class="s2">0</span><span class="s1">] = W</span>
            <span class="s0">if </span><span class="s1">H &lt; size[</span><span class="s2">1</span><span class="s1">]:</span>
                <span class="s1">size[</span><span class="s2">1</span><span class="s1">] = H</span>
        <span class="s1">Painter.set_size(self</span><span class="s0">, </span><span class="s1">size)</span>
        <span class="s1">self._resized = size</span>


    <span class="s0">def </span><span class="s1">init_get_img(self):</span>
        <span class="s5">&quot;&quot;&quot;Only to find size of image during initialization.&quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">isinstance(self.img_path</span><span class="s0">, </span><span class="s1">str):</span>
            <span class="s0">return </span><span class="s1">load_image(self.img_path</span><span class="s0">, </span><span class="s1">colorkey=self.colorkey</span><span class="s0">,</span>
                                <span class="s1">use_img_dict=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">isinstance(self.img_path</span><span class="s0">, </span><span class="s1">Surface):</span>
            <span class="s0">return </span><span class="s1">self.img_path</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">raise </span><span class="s1">Exception(type(self.img_path)</span><span class="s0">, </span><span class="s1">self.img_path)</span>

    <span class="s0">def </span><span class="s1">get_image(self):</span>
        <span class="s0">if </span><span class="s1">isinstance(self.img_path</span><span class="s0">, </span><span class="s1">str):  </span><span class="s3"># load image</span>
            <span class="s1">surface = load_image(self.img_path)</span>
        <span class="s0">else</span><span class="s1">:  </span><span class="s3"># take image</span>
            <span class="s1">surface = self.img_path</span>
        <span class="s0">return </span><span class="s1">surface</span>

    <span class="s0">def </span><span class="s1">get_surface(self):</span>
        <span class="s1">W</span><span class="s0">, </span><span class="s1">H = functions.get_screen_size()</span>
        <span class="s1">surface = self.get_image()</span>
        <span class="s0">if </span><span class="s2">0 </span><span class="s1">&lt; self.alpha &lt; </span><span class="s2">255</span><span class="s1">:</span>
            <span class="s1">surface.set_alpha(self.alpha</span><span class="s0">, </span><span class="s1">RLEACCEL)</span>
        <span class="s0">if </span><span class="s1">self.mode == </span><span class="s4">&quot;scale to screen&quot;</span><span class="s1">:</span>
            <span class="s1">surface = scale(surface</span><span class="s0">, </span><span class="s1">(W</span><span class="s0">, </span><span class="s1">H))</span>
            <span class="s1">self.size = (W</span><span class="s0">, </span><span class="s1">H)</span>
        <span class="s0">elif </span><span class="s1">self.mode == </span><span class="s4">&quot;cut to screen&quot;</span><span class="s1">:</span>
            <span class="s1">new_surface = Surface((W</span><span class="s0">, </span><span class="s1">H))</span>
            <span class="s1">new_surface.blit(surface</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>
            <span class="s1">self.size = (W</span><span class="s0">, </span><span class="s1">H)</span>
        <span class="s0">elif </span><span class="s1">self._resized:</span>
            <span class="s1">surface = scale(surface</span><span class="s0">, </span><span class="s1">self._resized)</span>
        <span class="s0">elif </span><span class="s1">self.mode:</span>
            <span class="s1">functions.debug_msg(</span><span class="s4">&quot;Unrecognized mode : &quot;</span><span class="s0">, </span><span class="s1">self.mode)</span>
<span class="s3">##        elif self._resized:</span>
<span class="s3">##            surface = scale(surface, self._resized)</span>
        <span class="s0">if </span><span class="s1">self.colorkey:</span>
            <span class="s1">surface.set_colorkey(self.colorkey</span><span class="s0">, </span><span class="s1">RLEACCEL)</span>
        <span class="s1">surface.set_clip(self.clip)</span>
        <span class="s0">if </span><span class="s1">self.alpha &lt; </span><span class="s2">255</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">surface.convert_alpha()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">surface.convert()</span>


<span class="s0">class </span><span class="s1">ButtonImage(ImageFrame):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">img_normal</span><span class="s0">, </span><span class="s1">img_pressed=</span><span class="s0">None, </span><span class="s1">img_hover=</span><span class="s0">None, </span><span class="s1">alpha=</span><span class="s2">255</span><span class="s0">,</span>
                 <span class="s1">colorkey=</span><span class="s0">None, </span><span class="s1">clip=</span><span class="s0">None, </span><span class="s1">pressed=</span><span class="s0">False, </span><span class="s1">mode=</span><span class="s0">None,</span>
                 <span class="s1">hovered=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s1">ImageFrame.__init__(self</span><span class="s0">, </span><span class="s1">img_normal</span><span class="s0">, </span><span class="s1">alpha</span><span class="s0">, </span><span class="s1">colorkey</span><span class="s0">, </span><span class="s1">clip</span><span class="s0">, </span><span class="s1">pressed</span><span class="s0">,</span>
                            <span class="s1">mode</span><span class="s0">, </span><span class="s1">hovered)</span>
        <span class="s1">img_pressed = img_normal </span><span class="s0">if not </span><span class="s1">img_pressed </span><span class="s0">else </span><span class="s1">img_pressed</span>
        <span class="s1">img_hover = img_normal </span><span class="s0">if not </span><span class="s1">img_hover </span><span class="s0">else </span><span class="s1">img_hover</span>
        <span class="s1">self.img_pressed = img_pressed</span>
        <span class="s1">self.img_hover = img_hover</span>

    <span class="s0">def </span><span class="s1">get_image(self):</span>
        <span class="s0">if </span><span class="s1">self.pressed:</span>
            <span class="s0">if </span><span class="s1">isinstance(self.img_pressed</span><span class="s0">, </span><span class="s1">str):  </span><span class="s3"># load image</span>
                <span class="s1">surface = load_image(self.img_pressed)</span>
            <span class="s0">else</span><span class="s1">:  </span><span class="s3"># take image</span>
                <span class="s1">surface = self.img_pressed</span>
        <span class="s0">elif </span><span class="s1">self.hovered:</span>
            <span class="s0">if </span><span class="s1">isinstance(self.img_hover</span><span class="s0">, </span><span class="s1">str):  </span><span class="s3"># load image</span>
                <span class="s1">surface = load_image(self.img_hover)</span>
            <span class="s0">else</span><span class="s1">:  </span><span class="s3"># take image</span>
                <span class="s1">surface = self.img_hover</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">surface = ImageFrame.get_image(self)</span>
        <span class="s0">return </span><span class="s1">surface</span>

<span class="s0">class </span><span class="s1">ButtonImageFrame(ButtonImage):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">painter</span><span class="s0">, </span><span class="s1">img_normal</span><span class="s0">, </span><span class="s1">img_pressed=</span><span class="s0">None, </span><span class="s1">img_hover=</span><span class="s0">None, </span><span class="s1">alpha=</span><span class="s2">255</span><span class="s0">,</span>
                 <span class="s1">colorkey=</span><span class="s0">None, </span><span class="s1">clip=</span><span class="s0">None, </span><span class="s1">pressed=</span><span class="s0">False, </span><span class="s1">mode=</span><span class="s0">None,</span>
                 <span class="s1">hovered=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s1">ImageFrame.__init__(self</span><span class="s0">, </span><span class="s1">img_normal</span><span class="s0">, </span><span class="s1">alpha</span><span class="s0">, </span><span class="s1">colorkey</span><span class="s0">, </span><span class="s1">clip</span><span class="s0">, </span><span class="s1">pressed</span><span class="s0">,</span>
                            <span class="s1">mode</span><span class="s0">, </span><span class="s1">hovered)</span>
        <span class="s1">img_pressed = img_normal </span><span class="s0">if not </span><span class="s1">img_pressed </span><span class="s0">else </span><span class="s1">img_pressed</span>
        <span class="s1">img_hover = img_normal </span><span class="s0">if not </span><span class="s1">img_hover </span><span class="s0">else </span><span class="s1">img_hover</span>
        <span class="s1">self.img_pressed = img_pressed</span>
        <span class="s1">self.img_hover = img_hover</span>
        <span class="s1">self.painter = painter</span>

    <span class="s0">def </span><span class="s1">get_image(self):</span>
        <span class="s0">if </span><span class="s1">self.pressed:</span>
            <span class="s0">if </span><span class="s1">isinstance(self.img_pressed</span><span class="s0">, </span><span class="s1">str):  </span><span class="s3"># load image</span>
                <span class="s1">img = load_image(self.img_pressed)</span>
            <span class="s0">else</span><span class="s1">:  </span><span class="s3"># take image</span>
                <span class="s1">img = self.img_pressed</span>
        <span class="s0">elif </span><span class="s1">self.hovered:</span>
            <span class="s0">if </span><span class="s1">isinstance(self.img_hover</span><span class="s0">, </span><span class="s1">str):  </span><span class="s3"># load image</span>
                <span class="s1">img = load_image(self.img_hover)</span>
            <span class="s0">else</span><span class="s1">:  </span><span class="s3"># take image</span>
                <span class="s1">img = self.img_hover</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">img = ImageFrame.get_image(self)</span>
        <span class="s3">#</span>
        <span class="s1">self.painter.pressed = self.pressed</span>
        <span class="s1">surface = self.painter.get_image()</span>
        <span class="s1">r = img.get_rect()</span>
        <span class="s1">r.center = surface.get_rect().center</span>
        <span class="s1">surface.blit(img</span><span class="s0">, </span><span class="s1">r.topleft)</span>
        <span class="s0">return </span><span class="s1">surface</span></pre>
</body>
</html>