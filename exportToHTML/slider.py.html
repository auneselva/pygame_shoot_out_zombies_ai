<html>
<head>
<title>slider.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
slider.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">division</span>

<span class="s0">import </span><span class="s1">pygame</span>
<span class="s0">from </span><span class="s1">pygame.rect </span><span class="s0">import </span><span class="s1">Rect</span>

<span class="s0">from </span><span class="s1">thorpy.elements._sliderutils._dragger </span><span class="s0">import </span><span class="s1">DraggerX</span><span class="s0">, </span><span class="s1">DraggerY</span>
<span class="s0">from </span><span class="s1">thorpy.elements.ghost </span><span class="s0">import </span><span class="s1">Ghost</span>
<span class="s0">from </span><span class="s1">thorpy.elements.element </span><span class="s0">import </span><span class="s1">Element</span>
<span class="s0">from </span><span class="s1">thorpy.elements._sliderutils._shifters </span><span class="s0">import </span><span class="s1">Plus</span><span class="s0">, </span><span class="s1">Minus</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui.reaction </span><span class="s0">import </span><span class="s1">Reaction</span><span class="s0">, </span><span class="s1">ConstantReaction</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui </span><span class="s0">import </span><span class="s1">constants</span><span class="s0">, </span><span class="s1">functions</span><span class="s0">, </span><span class="s1">parameters</span><span class="s0">, </span><span class="s1">style</span><span class="s0">, </span><span class="s1">painterstyle</span>


<span class="s0">class </span><span class="s1">_Slider(object):</span>
    <span class="s2">&quot;&quot;&quot;Not to be instanciated, not an element.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">length</span><span class="s0">, </span><span class="s1">limvals=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">limvals = parameters.LIMVALS </span><span class="s0">if </span><span class="s1">limvals </span><span class="s0">is None else </span><span class="s1">limvals</span>
        <span class="s1">self._length = length</span>
        <span class="s1">self.limvals = limvals</span>
        <span class="s1">self._shift = self.val_to_pix(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">get_width_val(self):</span>
        <span class="s0">return </span><span class="s1">self.limvals[</span><span class="s3">1</span><span class="s1">] - self.limvals[</span><span class="s3">0</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">pix_to_val(self</span><span class="s0">, </span><span class="s1">pix</span><span class="s0">, </span><span class="s1">x0=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s0">if </span><span class="s1">x0 </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s1">x0 = self._get_slide_rect().x</span>
        <span class="s1">fraction = float((pix - x0)) / self._length</span>
        <span class="s0">return </span><span class="s1">self.limvals[</span><span class="s3">0</span><span class="s1">] + fraction * self.get_width_val()</span>

    <span class="s0">def </span><span class="s1">val_to_pix(self</span><span class="s0">, </span><span class="s1">val</span><span class="s0">, </span><span class="s1">x0=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s0">if </span><span class="s1">x0 </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s1">x0 = self._get_slide_rect().x</span>
        <span class="s1">fraction = float(val - self.limvals[</span><span class="s3">0</span><span class="s1">]) / self.get_width_val()</span>
        <span class="s0">return </span><span class="s1">int(round(fraction * self._length + x0))</span>

    <span class="s0">def </span><span class="s1">_refresh_shift(self):</span>
        <span class="s1">self._shift = self.val_to_pix(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>



<span class="s0">class </span><span class="s1">_GraphicalSlider(_Slider</span><span class="s0">, </span><span class="s1">Element):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">length</span><span class="s0">, </span><span class="s1">limvals=</span><span class="s0">None, </span><span class="s1">text=</span><span class="s4">&quot;&quot;</span><span class="s0">, </span><span class="s1">elements=</span><span class="s0">None,</span>
                 <span class="s1">normal_params=</span><span class="s0">None,</span><span class="s1">finish=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">limvals = parameters.LIMVALS </span><span class="s0">if </span><span class="s1">limvals </span><span class="s0">is None else </span><span class="s1">limvals</span>
        <span class="s1">self._plus = </span><span class="s0">None</span>
        <span class="s1">self._minus = </span><span class="s0">None</span>
        <span class="s1">Element.__init__(self</span><span class="s0">, </span><span class="s1">text</span><span class="s0">, </span><span class="s1">elements</span><span class="s0">, </span><span class="s1">normal_params</span><span class="s0">,</span><span class="s1">finish=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">_Slider.__init__(self</span><span class="s0">, </span><span class="s1">length</span><span class="s0">, </span><span class="s1">limvals)</span>
        <span class="s1">self.current_state.autoghost = </span><span class="s0">False</span>
<span class="s5">##        self._set_wheel_reaction(parameters.BUTTON_UNPRESS_EVENT,</span>
<span class="s5">##                                {&quot;button&quot;: parameters.WHEELUP_BUTTON})</span>
<span class="s5">##        self._set_unwheel_reaction(parameters.BUTTON_PRESS_EVENT,</span>
<span class="s5">##                                  {&quot;button&quot;: parameters.WHEELDOWN_BUTTON})</span>
        <span class="s1">self._setup()</span>
        <span class="s1">self.active_wheel = </span><span class="s0">False</span>
        <span class="s0">if </span><span class="s1">finish:</span>
            <span class="s1">self.finish()</span>


    <span class="s0">def </span><span class="s1">get_storer_rect(self):</span>
        <span class="s0">return </span><span class="s1">self.get_family_rect(constants.STATE_NORMAL)</span>

    <span class="s0">def </span><span class="s1">move(self</span><span class="s0">, </span><span class="s1">shift):</span>
        <span class="s1">value_before = self.get_value()</span>
        <span class="s1">Element.move(self</span><span class="s0">, </span><span class="s1">shift)</span>
        <span class="s0">if </span><span class="s1">self.get_value() != value_before:</span>
            <span class="s1">self._drag_element.place_at(value_before)</span>

<span class="s5">##    def _set_wheel_reaction(self, type_, args=None):</span>
<span class="s5">##        if not args:</span>
<span class="s5">##            args = {}</span>
<span class="s5">##        reac_wheelup = Reaction(type_, self._reaction_wheel, args,</span>
<span class="s5">##                                reac_name=constants.REAC_WHEELUP)</span>
<span class="s5">##</span>
<span class="s5">##    def _set_unwheel_reaction(self, type_, args=None):</span>
<span class="s5">##        if not args:</span>
<span class="s5">##            args = {}</span>
<span class="s5">##        reac_wheeldown = Reaction(type_, self._reaction_unwheel, args,</span>
<span class="s5">##                                  reac_name=constants.REAC_WHEELDOWN)</span>
<span class="s5">##</span>
<span class="s5">##    def _reaction_wheel(self, event):</span>
<span class="s5">##        if self.active_wheel:</span>
<span class="s5">##            if self.collide(event.pos, self.current_state_key):</span>
<span class="s5">##                self._drag_element.shift(parameters.WHEEL_SLIDER_SHIFT)</span>
<span class="s5">##</span>
<span class="s5">##    def _reaction_unwheel(self, event):</span>
<span class="s5">##        if self.active_wheel:</span>
<span class="s5">##            if self.collide(event.pos, self.current_state_key):</span>
<span class="s5">##                self._drag_element.shift(-parameters.WHEEL_SLIDER_SHIFT)</span>

    <span class="s0">def </span><span class="s1">_setup(self):</span>
        <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">_press_plus(self):</span>
        <span class="s5"># change state, blit and update</span>
        <span class="s1">functions.keypress(self._plus</span><span class="s0">, </span><span class="s1">constants.STATE_PRESSED)</span>
        <span class="s1">self._drag_element.shift()</span>

    <span class="s0">def </span><span class="s1">_press_minus(self):</span>
        <span class="s5"># change state, blit and update</span>
        <span class="s1">functions.keypress(self._minus</span><span class="s0">, </span><span class="s1">constants.STATE_PRESSED)</span>
        <span class="s1">self._drag_element.shift(-</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">_add_buttons(self</span><span class="s0">, </span><span class="s1">size=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">size = style.SMALL_SIZE </span><span class="s0">if </span><span class="s1">size </span><span class="s0">is None else </span><span class="s1">size</span>
        <span class="s5"># _plus</span>
        <span class="s1">self._plus = Plus(text=</span><span class="s4">&quot;+&quot;</span><span class="s1">)</span>
        <span class="s1">self._plus.set_painter(painterstyle.DEF_PAINTER(size=size))</span>
        <span class="s1">self._plus.finish()</span>
        <span class="s1">self._plus.drag = self._drag_element</span>
        <span class="s1">reac_plus = ConstantReaction(constants.THORPY_EVENT</span><span class="s0">,</span>
                                     <span class="s1">self._plus._reaction_time</span><span class="s0">,</span>
                                     <span class="s1">{</span><span class="s4">&quot;id&quot;</span><span class="s1">:constants.EVENT_TIME}</span><span class="s0">,</span>
                                     <span class="s1">reac_name=constants.REAC_MOUSE_REPEAT)</span>
        <span class="s1">self.add_reaction(reac_plus)</span>
        <span class="s5"># _minus</span>
        <span class="s1">self._minus = Minus(text=</span><span class="s4">&quot;-&quot;</span><span class="s1">)</span>
        <span class="s1">self._minus.set_painter(painterstyle.DEF_PAINTER(size=size))</span>
        <span class="s1">self._minus.finish()</span>
        <span class="s1">self._minus.drag = self._drag_element</span>
        <span class="s1">reac_minus = ConstantReaction(constants.THORPY_EVENT</span><span class="s0">,</span>
                                     <span class="s1">self._plus._reaction_time</span><span class="s0">,</span>
                                     <span class="s1">{</span><span class="s4">&quot;id&quot;</span><span class="s1">:constants.EVENT_TIME}</span><span class="s0">,</span>
                                     <span class="s1">reac_name=constants.REAC_MOUSE_REPEAT+</span><span class="s3">0.1</span><span class="s1">)</span>
        <span class="s1">self.add_reaction(reac_minus)</span>
        <span class="s1">self.add_elements([self._plus</span><span class="s0">, </span><span class="s1">self._minus])</span>
        <span class="s5"># reactions to mouse _press (!= reactions to key _press):</span>
        <span class="s1">self._plus.reactions[constants.REAC_PRESSED +</span><span class="s3">0.1</span><span class="s1">] = ConstantReaction(</span>
            <span class="s1">constants.THORPY_EVENT</span><span class="s0">,</span>
            <span class="s1">self._drag_element.shift</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s4">&quot;id&quot;</span><span class="s1">:constants.EVENT_PRESS</span><span class="s0">, </span><span class="s4">&quot;el&quot;</span><span class="s1">: self.plus})</span>
        <span class="s1">self._minus.reactions[constants.REAC_PRESSED +</span><span class="s3">0.1</span><span class="s1">] = ConstantReaction(</span>
            <span class="s1">constants.THORPY_EVENT</span><span class="s0">,</span>
            <span class="s1">self._drag_element.shift</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s4">&quot;id&quot;</span><span class="s1">:constants.EVENT_PRESS</span><span class="s0">, </span><span class="s4">&quot;el&quot;</span><span class="s1">: self.minus}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s4">&quot;sign&quot;</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">})</span>
        <span class="s1">self._reactions[constants.REAC_PRESSED + </span><span class="s3">0.1</span><span class="s1">] = ConstantReaction(</span>
            <span class="s1">constants.THORPY_EVENT</span><span class="s0">,</span>
            <span class="s1">self._drag_element.shift</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s4">&quot;id&quot;</span><span class="s1">:constants.EVENT_PRESS</span><span class="s0">, </span><span class="s4">&quot;el&quot;</span><span class="s1">: self.plus})</span>
        <span class="s1">self._reactions[constants.REAC_PRESSED + </span><span class="s3">0.1</span><span class="s1">] = ConstantReaction(</span>
            <span class="s1">constants.THORPY_EVENT</span><span class="s0">,</span>
            <span class="s1">self._drag_element.shift</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s4">&quot;id&quot;</span><span class="s1">:constants.EVENT_PRESS</span><span class="s0">, </span><span class="s4">&quot;el&quot;</span><span class="s1">: self.minus}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s4">&quot;sign&quot;</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">})</span>

<span class="s5">##    def _get_no_slide_rect(self):</span>
<span class="s5">##        &quot;&quot;&quot;Returns size without slide_rect&quot;&quot;&quot;</span>
<span class="s5">##        wh_slide = self._get_slide_rect().size</span>
<span class="s5">##        wh = self.get_fus_rect().size</span>
<span class="s5">##        return (wh[0] - wh_slide[0], wh[1] - wh_slide[1])</span>

    <span class="s0">def </span><span class="s1">get_dragger(self):</span>
        <span class="s0">return </span><span class="s1">self._drag_element</span>

    <span class="s0">def </span><span class="s1">set_value(self</span><span class="s0">, </span><span class="s1">value):</span>
        <span class="s1">self.get_dragger().place_at(value)</span>


<span class="s0">class </span><span class="s1">SliderX(_GraphicalSlider):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">,</span>
                 <span class="s1">length</span><span class="s0">,</span>
                 <span class="s1">limvals=</span><span class="s0">None,</span>
                 <span class="s1">text=</span><span class="s4">&quot;&quot;</span><span class="s0">,</span>
                 <span class="s1">elements=</span><span class="s0">None,</span>
                 <span class="s1">normal_params=</span><span class="s0">None,</span>
                 <span class="s1">initial_value=</span><span class="s0">None,</span>
                 <span class="s1">finish=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s0">if </span><span class="s1">initial_value </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s1">initial_value = </span><span class="s3">0</span>
        <span class="s0">if </span><span class="s1">limvals[</span><span class="s3">0</span><span class="s1">] &lt;= initial_value &lt;= limvals[</span><span class="s3">1</span><span class="s1">]: </span><span class="s5">#will be False if initial_value is None</span>
            <span class="s1">self.initial_value = initial_value</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">if </span><span class="s1">initial_value </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s1">functions.debug_msg(</span><span class="s4">&quot;Initial value for slider was not in the</span><span class="s0">\ 
                                    </span><span class="s4">limvals range. Auto set to limvals[0].&quot;</span><span class="s1">)</span>
            <span class="s1">self.initial_value = limvals[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">self._drag_element = DraggerX(self)</span>
        <span class="s1">super(SliderX</span><span class="s0">, </span><span class="s1">self).__init__(length</span><span class="s0">, </span><span class="s1">limvals</span><span class="s0">, </span><span class="s1">text</span><span class="s0">, </span><span class="s1">elements</span><span class="s0">,</span>
                                        <span class="s1">finish=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">self._drag_element.finish()</span>
        <span class="s1">self.add_elements(list([self._drag_element]))</span>
        <span class="s1">reac_click = Reaction(pygame.MOUSEBUTTONDOWN</span><span class="s0">,</span><span class="s1">self._func_reac_click)</span>
        <span class="s1">self.add_reaction(reac_click)</span>
        <span class="s0">if </span><span class="s1">finish:</span>
            <span class="s1">self.finish()</span>

    <span class="s0">def </span><span class="s1">_func_reac_click(self</span><span class="s0">, </span><span class="s1">e):</span>
        <span class="s1">rel = pygame.mouse.get_rel()</span>
<span class="s5">##        if rel[0] == 0 and rel[1] == 0:</span>
        <span class="s0">if </span><span class="s1">self.get_fus_rect().collidepoint(e.pos):</span>
            <span class="s1">self._drag_element.unblit()</span>
            <span class="s1">self._drag_element.update()</span>
            <span class="s1">value = self.pix_to_val(e.pos[</span><span class="s3">0</span><span class="s1">])</span>
            <span class="s0">if </span><span class="s1">value &lt; self.limvals[</span><span class="s3">0</span><span class="s1">]:</span>
                <span class="s1">value = self.limvals[</span><span class="s3">0</span><span class="s1">]</span>
            <span class="s0">elif </span><span class="s1">value &gt; self.limvals[</span><span class="s3">1</span><span class="s1">]:</span>
                <span class="s1">value = self.limvals[</span><span class="s3">1</span><span class="s1">]</span>
            <span class="s1">self._drag_element.place_at(value)</span>
            <span class="s1">self.father.refresh_value()</span>
            <span class="s1">self.unblit_and_reblit()</span>
            <span class="s1">drag_event = pygame.event.Event(constants.THORPY_EVENT</span><span class="s0">,</span>
                                            <span class="s1">id=constants.EVENT_SLIDE</span><span class="s0">,</span>
                                            <span class="s1">el=self.father)</span>
            <span class="s1">pygame.event.post(drag_event)</span>

    <span class="s0">def </span><span class="s1">finish(self):</span>
        <span class="s1">Element.finish(self)</span>
        <span class="s1">self._drag_element.set_center((</span><span class="s0">None, </span><span class="s1">self.get_fus_center()[</span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s0">for </span><span class="s1">state </span><span class="s0">in </span><span class="s1">self._states:</span>
            <span class="s1">self._states[state].refresh_ghost_rect()</span>
        <span class="s1">self._setup()</span>
        <span class="s1">self._drag_element.place_at(self.initial_value)</span>

    <span class="s0">def </span><span class="s1">_setup(self</span><span class="s0">, </span><span class="s1">height=</span><span class="s0">None, </span><span class="s1">dragsize=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">height = style.SLIDER_THICK </span><span class="s0">if </span><span class="s1">height </span><span class="s0">is None else </span><span class="s1">height</span>
        <span class="s1">dragsize = style.SLIDERX_DRAG_SIZE </span><span class="s0">if </span><span class="s1">dragsize </span><span class="s0">is None else </span><span class="s1">dragsize</span>
        <span class="s1">self._height = height</span>
        <span class="s1">size = (self._length + dragsize[</span><span class="s3">0</span><span class="s1">] + style.SLIDER_MARGINS[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">height)</span>
        <span class="s1">painter = functions.obtain_valid_painter(</span>
            <span class="s1">painterstyle.DEF_PAINTER</span><span class="s0">,</span>
            <span class="s1">pressed=</span><span class="s0">True,</span>
            <span class="s1">color=style.DEF_COLOR2</span><span class="s0">,</span>
            <span class="s1">size=size)</span>
        <span class="s1">self.set_painter(painter)</span>
        <span class="s1">dp = functions.obtain_valid_painter(</span>
            <span class="s1">painterstyle.DEF_PAINTER</span><span class="s0">,</span>
            <span class="s1">pressed=</span><span class="s0">False,</span>
            <span class="s1">size=dragsize)</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s1">drag_x = self.val_to_pix(self.initial_value</span><span class="s0">,</span>
                                     <span class="s1">self.get_fus_topleft()[</span><span class="s3">0</span><span class="s1">]) + </span><span class="s3">1</span>
            <span class="s1">self._drag_element.change_painter(dp</span><span class="s0">, </span><span class="s1">autopress=</span><span class="s0">False</span><span class="s1">)</span>
            <span class="s1">self._drag_element.set_center((drag_x</span><span class="s0">, </span><span class="s1">self.get_fus_center()[</span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s0">except </span><span class="s1">AttributeError:</span>
            <span class="s1">drag_x = self.val_to_pix(self.initial_value</span><span class="s0">,</span>
                                     <span class="s1">self.get_ghost_topleft()[</span><span class="s3">0</span><span class="s1">]) + </span><span class="s3">1</span>
            <span class="s1">self._drag_element.set_painter(dp</span><span class="s0">, </span><span class="s1">autopress=</span><span class="s0">False</span><span class="s1">)</span>
            <span class="s1">self._drag_element.set_center((drag_x</span><span class="s0">, </span><span class="s1">self.get_ghost_center()[</span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s1">self._drag_element.set_free(y=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">Ghost.fit_children(self)</span>

    <span class="s0">def </span><span class="s1">_get_slide_rect(self):</span>
        <span class="s1">slide_rect = Rect((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(self._length</span><span class="s0">, </span><span class="s1">self._height))</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s1">slide_rect.center = self.get_fus_center()</span>
        <span class="s0">except </span><span class="s1">AttributeError:</span>
            <span class="s1">slide_rect.center = self.get_ghost_center()</span>
        <span class="s0">return </span><span class="s1">slide_rect</span>

    <span class="s0">def </span><span class="s1">get_value(self):</span>
        <span class="s1">x0 = self._get_slide_rect().x</span>
        <span class="s1">val = self.pix_to_val(self._drag_element.get_fus_center()[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x0)</span>
        <span class="s0">if </span><span class="s1">val &lt; self.limvals[</span><span class="s3">0</span><span class="s1">]:</span>
            <span class="s0">return </span><span class="s1">self.limvals[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s0">elif </span><span class="s1">val &gt; self.limvals[</span><span class="s3">1</span><span class="s1">]:</span>
            <span class="s0">return </span><span class="s1">self.limvals[</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">val</span>

    <span class="s0">def </span><span class="s1">_add_buttons(self</span><span class="s0">, </span><span class="s1">size=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">_GraphicalSlider._add_buttons(self</span><span class="s0">, </span><span class="s1">size)</span>
        <span class="s1">rect = self.get_fus_rect()</span>
        <span class="s1">self._minus.set_center((-</span><span class="s3">2 </span><span class="s1">+ rect.left - size[</span><span class="s3">0</span><span class="s1">] // </span><span class="s3">2</span><span class="s0">, </span><span class="s1">rect.centery))</span>
        <span class="s1">self._plus.set_center((</span><span class="s3">2 </span><span class="s1">+ rect.right + size[</span><span class="s3">0</span><span class="s1">] // </span><span class="s3">2</span><span class="s0">, </span><span class="s1">rect.centery))</span>
        <span class="s1">Ghost.fit_children(self)</span>
        <span class="s1">self._add_buttons_reactions()</span>

    <span class="s0">def </span><span class="s1">_add_buttons_reactions(self):</span>
        <span class="s2">&quot;&quot;&quot;Add reactions to keyboard _press and unpress&quot;&quot;&quot;</span>
        <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">get_size(self</span><span class="s0">, </span><span class="s1">state=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s2">&quot;&quot;&quot;Special get_size method for sliders. 
        Could be named get_family_size(). 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self.get_family_rect(state).size</span>

<span class="s0">class </span><span class="s1">_SliderXSetter(SliderX): </span><span class="s5">#donner ca au father, pas sliderx</span>

    <span class="s0">def </span><span class="s1">pix_to_val(self</span><span class="s0">, </span><span class="s1">pix</span><span class="s0">, </span><span class="s1">x0=</span><span class="s0">None</span><span class="s1">): </span><span class="s5">#!!!!!</span>
        <span class="s0">if </span><span class="s1">x0 </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s1">x0 = self._get_slide_rect().x</span>
        <span class="s1">value = SliderX.pix_to_val(self</span><span class="s0">, </span><span class="s1">pix</span><span class="s0">, </span><span class="s1">x0)</span>
        <span class="s0">if </span><span class="s1">self.father._value_type </span><span class="s0">is </span><span class="s1">float:</span>
            <span class="s0">return </span><span class="s1">round(value</span><span class="s0">, </span><span class="s1">self.father._round_decimals)</span>
        <span class="s0">elif </span><span class="s1">self.father._value_type </span><span class="s0">is </span><span class="s1">int:</span>
            <span class="s0">return </span><span class="s1">int(round(value))</span>


<span class="s0">class </span><span class="s1">SliderY(_GraphicalSlider):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">,</span>
                 <span class="s1">length</span><span class="s0">,</span>
                 <span class="s1">limvals=</span><span class="s0">None,</span>
                 <span class="s1">text=</span><span class="s4">&quot;&quot;</span><span class="s0">,</span>
                 <span class="s1">elements=</span><span class="s0">None,</span>
                 <span class="s1">normal_params=</span><span class="s0">None,</span>
                 <span class="s1">finish=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">self._height = </span><span class="s0">None</span>
        <span class="s1">self._drag_element = DraggerY(self)</span>
        <span class="s1">super(SliderY</span><span class="s0">, </span><span class="s1">self).__init__(length</span><span class="s0">, </span><span class="s1">limvals</span><span class="s0">, </span><span class="s1">text</span><span class="s0">, </span><span class="s1">elements</span><span class="s0">,</span>
                                      <span class="s1">normal_params</span><span class="s0">,</span><span class="s1">finish=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">self._drag_element.finish()</span>
        <span class="s1">self.add_elements(list([self._drag_element]))</span>
        <span class="s1">Ghost.fit_children(self)</span>
        <span class="s0">if </span><span class="s1">finish:</span>
            <span class="s1">self.finish()</span>

    <span class="s0">def </span><span class="s1">finish(self):</span>
        <span class="s1">Element.finish(self)</span>
        <span class="s1">self._drag_element.set_center((self.get_fus_center()[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, None</span><span class="s1">))</span>
        <span class="s1">self.misc_refresh()</span>

    <span class="s0">def </span><span class="s1">misc_refresh(self):</span>
        <span class="s1">self._refresh_shift()</span>

    <span class="s0">def </span><span class="s1">_get_slide_rect(self):</span>
        <span class="s1">slide_rect = Rect((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(self._height</span><span class="s0">, </span><span class="s1">self._length))</span>
        <span class="s1">slide_rect.center = self.get_fus_rect().center</span>
        <span class="s0">return </span><span class="s1">slide_rect</span>

    <span class="s0">def </span><span class="s1">get_value(self):</span>
        <span class="s1">y0 = self._get_slide_rect().y</span>
        <span class="s1">val = self.pix_to_val(self._drag_element.get_fus_center()[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y0)</span>
        <span class="s0">if </span><span class="s1">val &lt; self.limvals[</span><span class="s3">0</span><span class="s1">]:</span>
            <span class="s0">return </span><span class="s1">self.limvals[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s0">elif </span><span class="s1">val &gt; self.limvals[</span><span class="s3">1</span><span class="s1">]:</span>
            <span class="s0">return </span><span class="s1">self.limvals[</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">val</span>

    <span class="s0">def </span><span class="s1">get_factor(self):</span>
        <span class="s1">value = self.get_value()</span>
        <span class="s0">return </span><span class="s3">1. </span><span class="s1">- (self.limvals[</span><span class="s3">1</span><span class="s1">] - value) / self.limvals[</span><span class="s3">1</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">_add_buttons(self</span><span class="s0">, </span><span class="s1">size=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">_GraphicalSlider._add_buttons(self</span><span class="s0">, </span><span class="s1">size)</span>
        <span class="s1">rect = self.get_fus_rect()</span>
        <span class="s1">pos = (rect.centerx</span><span class="s0">, </span><span class="s1">rect.bottom + style.SLIDER_MARGINS[</span><span class="s3">1</span><span class="s1">] + size[</span><span class="s3">1</span><span class="s1">]/</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">self._minus.set_center(pos)</span>
        <span class="s1">pos = (rect.centerx</span><span class="s0">, </span><span class="s1">rect.top - style.SLIDER_MARGINS[</span><span class="s3">1</span><span class="s1">] - size[</span><span class="s3">1</span><span class="s1">]/</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">self._plus.set_center(pos)</span>
        <span class="s1">Ghost.fit_children(self)</span>
        <span class="s1">self._add_buttons_reactions()</span>

    <span class="s0">def </span><span class="s1">_add_buttons_reactions(self):</span>
        <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">_get_theo_size(self</span><span class="s0">, </span><span class="s1">buttonsize</span><span class="s0">, </span><span class="s1">dragsize</span><span class="s0">, </span><span class="s1">length</span><span class="s0">, </span><span class="s1">margins=</span><span class="s0">None,</span>
                       <span class="s1">surplus=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s2">&quot;&quot;&quot;Returns the theoretical future total size of self. The reason for 
        this method to exist is that it provides a way to guess the size before 
        the graphical parts are created by calling self.finish(). 
        &lt;surplus&gt; : get only the size surplus due to buttons. 
        &quot;&quot;&quot;</span>
        <span class="s1">margins = style.SLIDER_MARGINS[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">if </span><span class="s1">margins </span><span class="s0">is None else </span><span class="s1">margins</span>
        <span class="s1">w = max(buttonsize[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dragsize[</span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">actual_length = length + dragsize[</span><span class="s3">1</span><span class="s1">] + </span><span class="s3">2 </span><span class="s1">* margins</span>
        <span class="s0">if </span><span class="s1">buttonsize[</span><span class="s3">0</span><span class="s1">] != </span><span class="s3">0</span><span class="s1">:  </span><span class="s5"># (0, 0) button size means no buttons</span>
            <span class="s1">buttons_growth = </span><span class="s3">2 </span><span class="s1">* buttonsize[</span><span class="s3">1</span><span class="s1">] + </span><span class="s3">2 </span><span class="s1">* margins</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">buttons_growth = </span><span class="s3">0</span>
        <span class="s1">h = actual_length + buttons_growth</span>
        <span class="s0">if </span><span class="s1">surplus:</span>
            <span class="s1">h -= length</span>
        <span class="s0">return </span><span class="s1">(w</span><span class="s0">, </span><span class="s1">h)</span>
</pre>
</body>
</html>