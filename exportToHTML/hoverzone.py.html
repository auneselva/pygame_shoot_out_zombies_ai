<html>
<head>
<title>hoverzone.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
hoverzone.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">pygame </span><span class="s0">import </span><span class="s1">MOUSEMOTION</span>
<span class="s0">from </span><span class="s1">pygame.mouse </span><span class="s0">import </span><span class="s1">get_pos </span><span class="s0">as </span><span class="s1">mouse_pos</span>

<span class="s0">from </span><span class="s1">thorpy.elements.ghost </span><span class="s0">import </span><span class="s1">Ghost</span>
<span class="s0">from </span><span class="s1">thorpy.elements.element </span><span class="s0">import </span><span class="s1">Element</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui.reaction </span><span class="s0">import </span><span class="s1">Reaction</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui </span><span class="s0">import </span><span class="s1">constants</span><span class="s0">, </span><span class="s1">functions</span><span class="s0">, </span><span class="s1">parameters</span>

<span class="s0">class </span><span class="s1">HoverZone(Ghost):</span>
    <span class="s2">&quot;&quot;&quot;Ghost element designed to react to mouse hovering - can post hover events 
    .&quot;&quot;&quot;</span>

    <span class="s1">@staticmethod</span>
    <span class="s0">def </span><span class="s1">make(zone=</span><span class="s0">None, </span><span class="s1">elements=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">hz = HoverZone(zone</span><span class="s0">, </span><span class="s1">elements)</span>
        <span class="s1">hz.finish()</span>
        <span class="s0">return </span><span class="s1">hz</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">hover_zone=</span><span class="s0">None, </span><span class="s1">elements=</span><span class="s0">None, </span><span class="s1">normal_params=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s2">&quot;&quot;&quot;Ghost element designed to react to mouse hovering - can post hover events 
        . 
        &lt;hover_zone&gt;: a pygame rect defining the hovering zone.&quot;&quot;&quot;</span>
        <span class="s1">Ghost.__init__(self</span><span class="s0">, </span><span class="s1">elements</span><span class="s0">, </span><span class="s1">normal_params)</span>
        <span class="s1">self._hovered = </span><span class="s0">False</span>
        <span class="s1">self.set_hover(MOUSEMOTION)</span>
        <span class="s1">self._help_element = </span><span class="s0">None</span>
        <span class="s1">self._waited = </span><span class="s3">0</span>
        <span class="s1">self._help_wait_time = parameters.HELP_WAIT_TIME</span>
        <span class="s1">self._help_pos = </span><span class="s0">None</span>
        <span class="s1">self._help_reaction = </span><span class="s0">None</span>
        <span class="s1">self._help_blitted = </span><span class="s0">False</span>
        <span class="s1">self.visible = </span><span class="s0">False</span>
        <span class="s0">if </span><span class="s1">hover_zone:</span>
            <span class="s1">self.set_hover_zone(hover_zone)</span>
        <span class="s1">self.surface = functions.get_screen()</span>

    <span class="s0">def </span><span class="s1">set_hover_zone(self</span><span class="s0">, </span><span class="s1">rect</span><span class="s0">, </span><span class="s1">state=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">self.set_ghost_rect(rect.topleft</span><span class="s0">, </span><span class="s1">rect.size</span><span class="s0">, </span><span class="s1">state)</span>

    <span class="s0">def </span><span class="s1">set_hover(self</span><span class="s0">, </span><span class="s1">event</span><span class="s0">, </span><span class="s1">args=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s2">&quot;&quot;&quot;Set the &lt;event&gt; which makes the element hovered if &lt;args&gt; are the 
        right ones. 
        &lt;event&gt; : a pygame event. 
        &lt;args&gt; : a dictionnary. 
        &quot;&quot;&quot;</span>
        <span class="s0">if not </span><span class="s1">args:</span>
            <span class="s1">args = {}</span>
        <span class="s1">reac_hover = Reaction(event</span><span class="s0">, </span><span class="s1">self._reaction_hover</span><span class="s0">, </span><span class="s1">args</span><span class="s0">,</span>
                              <span class="s1">reac_name=constants.REAC_HOVER)</span>
        <span class="s1">self.add_reaction(reac_hover)</span>

    <span class="s0">def </span><span class="s1">_reaction_help(self</span><span class="s0">, </span><span class="s1">event): </span><span class="s4">#set self help element visible ou pas.</span>
        <span class="s2">&quot;&quot;&quot;Reaction to EVENT_TIME event&quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self._hovered:</span>
            <span class="s1">self._waited += event.tick</span>
            <span class="s0">if </span><span class="s1">self._waited &gt; self._help_wait_time/</span><span class="s3">2.</span><span class="s1">:  </span><span class="s4"># then must switch</span>
                <span class="s1">self._waited = -float(</span><span class="s5">&quot;inf&quot;</span><span class="s1">)</span>
                <span class="s0">if not</span><span class="s1">(self._help_pos):</span>
                    <span class="s1">r = self._help_element.get_fus_rect()</span>
                    <span class="s1">jail_rect = self._help_element.get_jail_rect()</span>
                    <span class="s0">if not </span><span class="s1">jail_rect:</span>
                        <span class="s1">jail_rect = self.surface.get_rect()</span>
                    <span class="s1">mouse_topleft = mouse_pos()</span>
                    <span class="s1">r.topleft = mouse_topleft</span>
                    <span class="s0">if </span><span class="s1">jail_rect.contains(r):</span>
                        <span class="s1">self._help_element.set_topleft(mouse_pos())</span>
                    <span class="s0">else</span><span class="s1">:</span>
                        <span class="s4">#clamping</span>
                        <span class="s1">r = r.clamp(jail_rect)</span>
                        <span class="s1">self._help_element.set_topleft(r.topleft)</span>
                <span class="s1">self._help_element.set_recursive(</span><span class="s5">&quot;visible&quot;</span><span class="s0">, True</span><span class="s1">)</span>
                <span class="s1">self._help_element.blit()</span>
                <span class="s1">self._help_blitted = </span><span class="s0">True</span>
                <span class="s1">self._help_element.update()</span>
        <span class="s0">else</span><span class="s1">:</span><span class="s4"># then the helper has been blitted and must be unblitted</span>
            <span class="s0">if </span><span class="s1">self._waited &lt; </span><span class="s3">0</span><span class="s1">:</span>
                <span class="s1">self._help_element.unblit()</span>
                <span class="s1">self._help_blitted = </span><span class="s0">False</span>
                <span class="s1">self._help_element.update()</span>
                <span class="s1">self._help_element.set_recursive(</span><span class="s5">&quot;visible&quot;</span><span class="s0">, False</span><span class="s1">)</span>
                <span class="s1">self._waited = </span><span class="s3">0</span>
                <span class="s1">self.remove_reaction(self._help_reaction)</span>

    <span class="s0">def </span><span class="s1">_remove_help(self):</span>
        <span class="s0">if </span><span class="s1">self._help_element:</span>
            <span class="s1">self._help_element.unblit()</span>
            <span class="s1">self._help_blitted = </span><span class="s0">False</span>
            <span class="s1">self._help_element.update()</span>
            <span class="s1">self._help_element.set_recursive(</span><span class="s5">&quot;visible&quot;</span><span class="s0">, False</span><span class="s1">)</span>
            <span class="s1">self._waited = </span><span class="s3">0</span>
        <span class="s4">##            if self._help_reaction in self._reactions:</span>
        <span class="s4">##                self.remove_reaction(self._help_reaction)</span>

    <span class="s0">def </span><span class="s1">_reaction_hover(self</span><span class="s0">, </span><span class="s1">pygame_event):</span>
        <span class="s2">&quot;&quot;&quot;Normally, reacts to pygame.MOUSEMOTION, but can be redefined.&quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self._hovered </span><span class="s0">and not </span><span class="s1">self._help_blitted:</span>
            <span class="s1">self._waited = </span><span class="s3">0</span>
        <span class="s0">elif </span><span class="s1">self._hovered </span><span class="s0">and </span><span class="s1">self._help_blitted:</span>
            <span class="s1">self._remove_help()</span>
        <span class="s1">beeing_hovered = self.collide(pygame_event.pos</span><span class="s0">, </span><span class="s1">self.current_state_key)</span>
        <span class="s0">if not </span><span class="s1">self._hovered </span><span class="s0">and </span><span class="s1">beeing_hovered:  </span><span class="s4"># can only change to True</span>
            <span class="s1">self._hover()</span>
            <span class="s0">if </span><span class="s1">self._help_element:</span>
                <span class="s1">self.add_reaction(self._help_reaction)</span>
                <span class="s1">functions.add_element_to_current_menu(self) </span><span class="s4">#refresh reaction</span>
        <span class="s0">elif </span><span class="s1">self._hovered </span><span class="s0">and not</span><span class="s1">(beeing_hovered):  </span><span class="s4"># can only change to False</span>
            <span class="s1">self._unhover()</span>

    <span class="s0">def </span><span class="s1">_hover(self):</span>
        <span class="s1">self._hovered = </span><span class="s0">True</span>

    <span class="s0">def </span><span class="s1">_unhover(self):</span>
        <span class="s1">self._hovered = </span><span class="s0">False</span>

    <span class="s0">def </span><span class="s1">add_basic_help(self</span><span class="s0">, </span><span class="s1">text</span><span class="s0">, </span><span class="s1">wait_time=</span><span class="s0">None, </span><span class="s1">jail=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">helper = Element(text</span><span class="s0">,</span><span class="s1">finish=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">helper._is_in_family = </span><span class="s0">False</span>
        <span class="s1">helper.set_style(</span><span class="s5">&quot;help&quot;</span><span class="s1">)</span>
        <span class="s1">helper.finish()</span>
        <span class="s1">helper.scale_to_title()</span>
        <span class="s0">if </span><span class="s1">wait_time </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s1">wait_time=self._help_wait_time</span>
        <span class="s1">helper.set_help_of(self</span><span class="s0">, </span><span class="s1">self._help_wait_time)</span>
        <span class="s0">if </span><span class="s1">jail:</span>
            <span class="s1">helper.set_jailed(jail)</span>

    <span class="s0">def </span><span class="s1">remove_help(self):</span>
        <span class="s0">if </span><span class="s1">self._help_element:</span>
            <span class="s1">self.remove_elements([self._help_element])</span>
            <span class="s1">self.remove_reaction(self._help_reaction)</span>

    <span class="s0">def </span><span class="s1">get_storer_rect(self):</span>
        <span class="s0">import </span><span class="s1">pygame</span>
        <span class="s0">return </span><span class="s1">pygame.Rect(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span></pre>
</body>
</html>