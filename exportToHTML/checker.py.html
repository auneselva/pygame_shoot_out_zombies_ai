<html>
<head>
<title>checker.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #6a8759;}
.s4 { color: #808080;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
checker.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">pygame.constants </span><span class="s0">import </span><span class="s1">RLEACCEL</span>

<span class="s0">from </span><span class="s1">thorpy.elements.clickable </span><span class="s0">import </span><span class="s1">Clickable</span>
<span class="s0">from </span><span class="s1">thorpy._utils.images </span><span class="s0">import </span><span class="s1">load_image</span><span class="s0">, </span><span class="s1">change_color_on_img_ip</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui </span><span class="s0">import </span><span class="s1">constants</span><span class="s0">, </span><span class="s1">functions</span><span class="s0">, </span><span class="s1">style</span><span class="s0">, </span><span class="s1">painterstyle</span>


<span class="s0">class </span><span class="s1">Checker(Clickable):</span>
    <span class="s2">&quot;&quot;&quot;Checkable check or radio box.&quot;&quot;&quot;</span>

    <span class="s1">@staticmethod</span>
    <span class="s0">def </span><span class="s1">make(text=</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">value=</span><span class="s0">False, </span><span class="s1">type_=</span><span class="s3">&quot;checkbox&quot;</span><span class="s1">):</span>
        <span class="s1">checker = Checker(text</span><span class="s0">, </span><span class="s1">value=value</span><span class="s0">, </span><span class="s1">type_=type_</span><span class="s0">, </span><span class="s1">finish=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">checker.finish()</span>
        <span class="s0">return </span><span class="s1">checker</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">,</span>
                 <span class="s1">text=</span><span class="s3">&quot;&quot;</span><span class="s0">,</span>
                 <span class="s1">elements=</span><span class="s0">None,</span>
                 <span class="s1">normal_params=</span><span class="s0">None,</span>
                 <span class="s1">press_params=</span><span class="s0">None,</span>
                 <span class="s1">value=</span><span class="s0">False,</span>
                 <span class="s1">namestyle=</span><span class="s0">None,</span>
                 <span class="s1">type_=</span><span class="s3">&quot;checkbox&quot;</span><span class="s0">,</span>
                 <span class="s1">check_img=</span><span class="s0">None,</span>
                 <span class="s1">finish=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s2">&quot;&quot;&quot;Checkable check or radio box. 
        &lt;text&gt;: text before the box. 
        &lt;value&gt;: True for checked, False for not checked. 
        &lt;type_&gt;: can be either 'checkbox' or 'radio'. 
        &lt;check_img&gt;: if not None, define the image used for the box. 
        &quot;&quot;&quot;</span>
        <span class="s1">namestyle=style.STYLE_INSERTER_NAME </span><span class="s0">if </span><span class="s1">namestyle </span><span class="s0">is None else </span><span class="s1">namestyle</span>
        <span class="s1">super(Checker</span><span class="s0">, </span><span class="s1">self).__init__(</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">elements</span><span class="s0">, </span><span class="s1">normal_params</span><span class="s0">,</span>
                                      <span class="s1">press_params</span><span class="s0">,</span><span class="s1">finish=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">value:</span>
            <span class="s1">self._checked = value</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self._checked = </span><span class="s0">False</span>
        <span class="s1">self._name_element = self._get_name_element(text</span><span class="s0">, </span><span class="s1">namestyle)  </span><span class="s4"># herite de setter</span>
        <span class="s1">self.add_elements(list([self._name_element]))</span>
        <span class="s1">self._type = type_</span>
        <span class="s1">painter = self._gen_painter()</span>
        <span class="s1">self.set_painter(painter</span><span class="s0">, False</span><span class="s1">)</span>
        <span class="s1">self._check_img = self._get_check_img(check_img)</span>
        <span class="s1">params = {</span><span class="s3">&quot;size&quot;</span><span class="s1">: style.CHECK_SIZE</span><span class="s0">,</span>
                  <span class="s3">&quot;color&quot;</span><span class="s1">: style.COLOR_HOVER_CHECK</span><span class="s0">,</span>
                  <span class="s3">&quot;pressed&quot;</span><span class="s1">: </span><span class="s0">True</span><span class="s1">}</span>
        <span class="s0">if </span><span class="s1">self._type == </span><span class="s3">&quot;checkbox&quot;</span><span class="s1">:</span>
            <span class="s1">painter_class = painterstyle.CHECKBOX_PAINTER</span>
        <span class="s0">elif </span><span class="s1">self._type == </span><span class="s3">&quot;radio&quot;</span><span class="s1">:</span>
            <span class="s1">painter_class = painterstyle.RADIO_PAINTER</span>
        <span class="s1">self.normal_params.polite_set(</span>
            <span class="s3">&quot;params hover&quot;</span><span class="s0">, </span><span class="s1">{</span>
                <span class="s3">&quot;painter&quot;</span><span class="s1">: painter_class</span><span class="s0">, </span><span class="s3">&quot;params&quot;</span><span class="s1">: params})</span>
        <span class="s1">self.normal_params.polite_set(</span><span class="s3">&quot;typ hover&quot;</span><span class="s0">, </span><span class="s3">&quot;redraw&quot;</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">finish:</span>
            <span class="s1">self.finish()</span>

    <span class="s0">def </span><span class="s1">set_value(self</span><span class="s0">, </span><span class="s1">new_value):</span>
        <span class="s1">self._checked = new_value</span>

    <span class="s0">def </span><span class="s1">_get_check_img(self</span><span class="s0">, </span><span class="s1">check_img</span><span class="s0">, </span><span class="s1">colorkey=</span><span class="s3">&quot;default&quot;</span><span class="s1">):</span>
        <span class="s2">&quot;&quot;&quot;check_img can either be a path or a pygame Surface&quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">colorkey==</span><span class="s3">&quot;default&quot;</span><span class="s1">: colorkey = style.CHECKBOX_IMG_COLORKEY</span>
        <span class="s0">if not </span><span class="s1">check_img:</span>
            <span class="s0">if </span><span class="s1">self._type == </span><span class="s3">&quot;checkbox&quot;</span><span class="s1">:</span>
                <span class="s1">check_img = style.CHECKBOX_IMG</span>
            <span class="s0">elif </span><span class="s1">self._type == </span><span class="s3">&quot;radio&quot;</span><span class="s1">:</span>
                <span class="s1">check_img = style.RADIO_IMG</span>
            <span class="s1">check_img = load_image(check_img)</span>
            <span class="s1">check_img.set_colorkey(colorkey</span><span class="s0">, </span><span class="s1">RLEACCEL)</span>
            <span class="s0">return </span><span class="s1">check_img</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">check_img</span>

    <span class="s0">def </span><span class="s1">set_active(self</span><span class="s0">, </span><span class="s1">value):</span>
        <span class="s1">self._name_element.active = value</span>
        <span class="s1">self.active = value</span>


    <span class="s0">def </span><span class="s1">set_visible(self</span><span class="s0">, </span><span class="s1">value):</span>
        <span class="s1">self._name_element.visible = value</span>
        <span class="s1">self.visible = value</span>


    <span class="s0">def </span><span class="s1">_reaction_press(self</span><span class="s0">, </span><span class="s1">pygame_event):</span>
        <span class="s1">Clickable._reaction_press(self</span><span class="s0">, </span><span class="s1">pygame_event)</span>
        <span class="s0">if </span><span class="s1">self.current_state_key == constants.STATE_PRESSED:</span>
            <span class="s1">self.check()</span>

    <span class="s0">def </span><span class="s1">set_check_img(self</span><span class="s0">, </span><span class="s1">path</span><span class="s0">, </span><span class="s1">color=constants.BLACK</span><span class="s0">,</span>
                      <span class="s1">color_src=constants.BLACK</span><span class="s0">,</span>
                      <span class="s1">colorkey=constants.WHITE):</span>
        <span class="s1">img = self._get_check_img(path</span><span class="s0">, </span><span class="s1">colorkey=colorkey)</span>
        <span class="s0">if </span><span class="s1">color != constants.BLACK:</span>
            <span class="s1">img = change_color_on_img_ip(img</span><span class="s0">, </span><span class="s1">color_src</span><span class="s0">, </span><span class="s1">color)</span>
        <span class="s1">self._check_img = img</span>

    <span class="s0">def </span><span class="s1">_gen_painter(self):</span>
        <span class="s0">if </span><span class="s1">self._type == </span><span class="s3">&quot;checkbox&quot;</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">functions.obtain_valid_painter(</span>
                <span class="s1">painterstyle.CHECKBOX_PAINTER</span><span class="s0">,</span>
                <span class="s1">color=style.DEF_COLOR2</span><span class="s0">,</span>
                <span class="s1">size=style.CHECK_SIZE</span><span class="s0">,</span>
                <span class="s1">pressed=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">self._type == </span><span class="s3">&quot;radio&quot;</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">functions.obtain_valid_painter(</span>
                <span class="s1">painterstyle.RADIO_PAINTER</span><span class="s0">,</span>
                <span class="s1">size=style.CHECK_SIZE</span><span class="s0">, </span><span class="s1">pressed=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">finish(self):</span>
        <span class="s1">Clickable.finish(self)</span>
        <span class="s1">self._refresh_pos()</span>
        <span class="s1">self._name_element.user_func = self.check</span>

    <span class="s0">def </span><span class="s1">check(self):</span>
        <span class="s2">&quot;&quot;&quot;Check, blit and update element.&quot;&quot;&quot;</span>
        <span class="s1">self._checked = </span><span class="s0">not </span><span class="s1">self._checked</span>
        <span class="s1">self.unblit()</span>
        <span class="s1">self.blit()</span>
<span class="s4">##        self.transp_blit()</span>
        <span class="s1">self.update()</span>

    <span class="s0">def </span><span class="s1">solo_blit(self):</span>
        <span class="s1">Clickable.solo_blit(self)</span>
        <span class="s0">if </span><span class="s1">self._checked:</span>
            <span class="s1">clip = self.get_clip()</span>
            <span class="s1">r = self._check_img.get_rect()</span>
            <span class="s1">r.center = clip.center</span>
            <span class="s1">self.surface.blit(self._check_img</span><span class="s0">, </span><span class="s1">r)</span>

    <span class="s0">def </span><span class="s1">_get_name_element(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">namestyle):</span>
        <span class="s1">painter = functions.obtain_valid_painter(</span>
            <span class="s1">painterstyle.CHECKER_NAME_PAINTER</span><span class="s0">,</span>
            <span class="s1">size=style.SIZE)</span>
        <span class="s1">el = Clickable(name</span><span class="s0">,</span><span class="s1">finish=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">el.set_painter(painter)</span>
        <span class="s0">if </span><span class="s1">namestyle:</span>
            <span class="s1">el.set_style(namestyle)</span>
        <span class="s1">el.finish()</span>
        <span class="s0">return </span><span class="s1">el</span>

    <span class="s0">def </span><span class="s1">unblit(self</span><span class="s0">, </span><span class="s1">rect=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">self._name_element.unblit(rect)</span>
        <span class="s1">Clickable.unblit(self</span><span class="s0">, </span><span class="s1">rect)</span>

    <span class="s0">def </span><span class="s1">transp_blit(self):</span>
        <span class="s1">a = self.get_oldest_children_ancester()</span>
        <span class="s1">r = self.get_storer_rect()</span>
        <span class="s1">a.unblit(r)</span>
        <span class="s1">a.partial_blit(</span><span class="s0">None, </span><span class="s1">r)</span>

    <span class="s0">def </span><span class="s1">_refresh_pos(self):</span>
<span class="s4">##        l = self.get_fus_topleft()[0]</span>
<span class="s4">##        (x, y) = self.get_fus_center()</span>
<span class="s4">##        l -= self._name_element.get_fus_size()[0] + 5</span>
<span class="s4">##        self._name_element.set_center((None, y))</span>
<span class="s4">##        self._name_element.set_topleft((l, None))</span>

<span class="s4">##        self._name_element.stick_to(self, &quot;left&quot;, &quot;right&quot;)</span>
        <span class="s1">self._name_element.stick_to(self.get_fus_rect()</span><span class="s0">, </span><span class="s3">&quot;left&quot;</span><span class="s0">, </span><span class="s3">&quot;right&quot;</span><span class="s1">)</span>
        <span class="s1">self._name_element.move((-style.CHECKBOX_SPACE</span><span class="s0">,</span><span class="s5">0</span><span class="s1">))</span>
<span class="s4">##        stick(checker._name_element, checker.get_fus_rect(), &quot;left&quot;, &quot;right&quot;)</span>
<span class="s4">##            checker._name_element.move((-3,0))</span>

    <span class="s0">def </span><span class="s1">get_storer_rect(self):</span>
        <span class="s0">return </span><span class="s1">self.get_family_rect(constants.STATE_NORMAL)</span>

    <span class="s0">def </span><span class="s1">get_value(self):</span>
        <span class="s0">return </span><span class="s1">self._checked</span>

    <span class="s0">def </span><span class="s1">set_font_color(self</span><span class="s0">, </span><span class="s1">color</span><span class="s0">, </span><span class="s1">state=</span><span class="s0">None, </span><span class="s1">center_title=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s2">&quot;&quot;&quot;set font color for a given state&quot;&quot;&quot;</span>
        <span class="s1">Clickable.set_font_color(self</span><span class="s0">, </span><span class="s1">color</span><span class="s0">, </span><span class="s1">state</span><span class="s0">, </span><span class="s1">center_title)</span>
        <span class="s1">self._name_element.set_font_color(color</span><span class="s0">, </span><span class="s1">state</span><span class="s0">, </span><span class="s1">center_title)</span>

    <span class="s0">def </span><span class="s1">set_font_size(self</span><span class="s0">, </span><span class="s1">size</span><span class="s0">, </span><span class="s1">state=</span><span class="s0">None, </span><span class="s1">center_title=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s2">&quot;&quot;&quot;set font color for a given state&quot;&quot;&quot;</span>
        <span class="s1">Clickable.set_font_size(self</span><span class="s0">, </span><span class="s1">size</span><span class="s0">, </span><span class="s1">state</span><span class="s0">, </span><span class="s1">center_title)</span>
        <span class="s1">self._name_element.set_font_size(size</span><span class="s0">, </span><span class="s1">state</span><span class="s0">, </span><span class="s1">center_title)</span>
        <span class="s1">self._refresh_pos()</span>

    <span class="s0">def </span><span class="s1">set_font(self</span><span class="s0">, </span><span class="s1">fontname</span><span class="s0">, </span><span class="s1">state=</span><span class="s0">None, </span><span class="s1">center_title=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s2">&quot;&quot;&quot;set font for a given state&quot;&quot;&quot;</span>
        <span class="s1">Element.set_font(self</span><span class="s0">, </span><span class="s1">fontname</span><span class="s0">, </span><span class="s1">state</span><span class="s0">, </span><span class="s1">center_title)</span>
        <span class="s1">self.set_hovered_states(self._states_hover)</span>
        <span class="s1">self._refresh_pos()</span>

    <span class="s0">def </span><span class="s1">set_font_effects(self</span><span class="s0">, </span><span class="s1">biu</span><span class="s0">, </span><span class="s1">state=</span><span class="s0">None, </span><span class="s1">center=</span><span class="s0">True, </span><span class="s1">preserve=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s2">&quot;&quot;&quot;biu = tuple : (bold, italic, underline)&quot;&quot;&quot;</span>
        <span class="s1">CLickable.set_font_effects(self</span><span class="s0">, </span><span class="s1">bio</span><span class="s0">, </span><span class="s1">state</span><span class="s0">, </span><span class="s1">center</span><span class="s0">, </span><span class="s1">preserve)</span>
        <span class="s1">self._name_element.set_font_effects(biu</span><span class="s0">, </span><span class="s1">state</span><span class="s0">, </span><span class="s1">center</span><span class="s0">, </span><span class="s1">preserve)</span>
        <span class="s1">self._refresh_pos()</span>

    <span class="s0">def </span><span class="s1">get_help_rect(self):</span>
        <span class="s0">return </span><span class="s1">self.get_family_rect()</span>


    <span class="s0">def </span><span class="s1">get_text(self):</span>
        <span class="s0">return </span><span class="s1">self._name_element.get_text()</span></pre>
</body>
</html>