<html>
<head>
<title>pools.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
pools.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">thorpy.elements.togglable </span><span class="s0">import </span><span class="s1">Togglable</span>
<span class="s0">from </span><span class="s1">thorpy.elements.checker </span><span class="s0">import </span><span class="s1">Checker</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui.reaction </span><span class="s0">import </span><span class="s1">ConstantReaction</span>
<span class="s0">from </span><span class="s1">thorpy.miscgui </span><span class="s0">import </span><span class="s1">constants</span>

<span class="s0">def </span><span class="s1">get_dict(elements):</span>
    <span class="s1">dic = {}</span>
    <span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">elements:</span>
        <span class="s1">dic[e] = e.get_text()</span>
    <span class="s0">return </span><span class="s1">dic</span>

<span class="s0">class </span><span class="s1">RadioPool(object):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">elements</span><span class="s0">, </span><span class="s1">first_value</span><span class="s0">, </span><span class="s1">always_value=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">elements:</span>
            <span class="s0">assert </span><span class="s1">isinstance(e</span><span class="s0">, </span><span class="s1">Checker)</span>
            <span class="s1">reac = ConstantReaction(constants.THORPY_EVENT</span><span class="s0">, </span><span class="s1">self.refresh</span><span class="s0">,</span>
                        <span class="s1">event_args={</span><span class="s2">&quot;id&quot;</span><span class="s1">:constants.EVENT_PRESS</span><span class="s0">,</span>
                                    <span class="s2">&quot;el&quot;</span><span class="s1">:e}</span><span class="s0">,</span>
                        <span class="s1">params={</span><span class="s2">&quot;selected&quot;</span><span class="s1">:e})</span>
            <span class="s1">e.add_reaction(reac)</span>
            <span class="s1">reac2 = ConstantReaction(constants.THORPY_EVENT</span><span class="s0">, </span><span class="s1">self.refresh</span><span class="s0">,</span>
                        <span class="s1">event_args={</span><span class="s2">&quot;id&quot;</span><span class="s1">:constants.EVENT_PRESS</span><span class="s0">,</span>
                                    <span class="s2">&quot;el&quot;</span><span class="s1">:e._name_element}</span><span class="s0">,</span>
                        <span class="s1">params={</span><span class="s2">&quot;selected&quot;</span><span class="s1">:e})</span>
            <span class="s1">e.add_reaction(reac2)</span>
        <span class="s1">self.elements = elements</span>
        <span class="s1">self._selected = </span><span class="s0">None</span>
        <span class="s1">self.always_value = always_value</span>
        <span class="s0">if </span><span class="s1">self.always_value:</span>
            <span class="s0">if not </span><span class="s1">first_value:</span>
                <span class="s0">raise </span><span class="s1">Exception(</span><span class="s2">&quot;If always_value is true, first_value must be set&quot;</span><span class="s1">)</span>
        <span class="s1">self.function = </span><span class="s0">None</span>
        <span class="s0">if </span><span class="s1">first_value:</span>
            <span class="s1">self._selected = first_value</span>
            <span class="s1">self._selected.set_value(</span><span class="s0">True</span><span class="s1">)</span>


    <span class="s0">def </span><span class="s1">refresh(self</span><span class="s0">, </span><span class="s1">selected):</span>
        <span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">self.elements:</span>
            <span class="s0">if </span><span class="s1">(e </span><span class="s0">is not </span><span class="s1">selected) </span><span class="s0">and </span><span class="s1">(e </span><span class="s0">is not </span><span class="s1">selected._name_element):</span>
                <span class="s0">if </span><span class="s1">e.get_value() </span><span class="s0">is True</span><span class="s1">:</span>
                    <span class="s1">e.active = </span><span class="s0">True</span>
                    <span class="s1">e._name_element.active = </span><span class="s0">True</span>
                    <span class="s1">e.set_value(</span><span class="s0">False</span><span class="s1">)</span>
                    <span class="s1">e.unblit_and_reblit()</span>
        <span class="s1">self._selected = selected</span>
        <span class="s0">if </span><span class="s1">self.always_value:</span>
            <span class="s1">self._selected.set_value(</span><span class="s0">True</span><span class="s1">)</span>
            <span class="s1">self._selected.unblit_and_reblit()</span>
            <span class="s1">self._selected.active = </span><span class="s0">False</span>
            <span class="s1">self._selected._name_element.active = </span><span class="s0">False</span>
        <span class="s0">if </span><span class="s1">self.function:</span>
            <span class="s1">self.function()</span>

    <span class="s0">def </span><span class="s1">get_selected(self):</span>
        <span class="s0">if </span><span class="s1">self._selected:</span>
            <span class="s0">if </span><span class="s1">self._selected.get_value() </span><span class="s0">is True</span><span class="s1">:</span>
                <span class="s0">return </span><span class="s1">self._selected</span>

<span class="s0">class </span><span class="s1">TogglablePool(object):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">elements</span><span class="s0">, </span><span class="s1">first_value=</span><span class="s0">None, </span><span class="s1">always_value=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">elements:</span>
            <span class="s0">assert </span><span class="s1">isinstance(e</span><span class="s0">, </span><span class="s1">Togglable)</span>
            <span class="s1">reac = ConstantReaction(constants.THORPY_EVENT</span><span class="s0">, </span><span class="s1">self.refresh</span><span class="s0">,</span>
                        <span class="s1">event_args={</span><span class="s2">&quot;id&quot;</span><span class="s1">:constants.EVENT_TOGGLE</span><span class="s0">,</span>
                                    <span class="s2">&quot;el&quot;</span><span class="s1">:e}</span><span class="s0">,</span>
                        <span class="s1">params={</span><span class="s2">&quot;selected&quot;</span><span class="s1">:e})</span>
            <span class="s1">e.add_reaction(reac)</span>
        <span class="s1">self.elements = elements</span>
        <span class="s1">self._selected = </span><span class="s0">None</span>
        <span class="s1">self.always_value = always_value</span>
        <span class="s0">if </span><span class="s1">self.always_value:</span>
            <span class="s0">if not </span><span class="s1">first_value:</span>
                <span class="s0">raise </span><span class="s1">Exception(</span><span class="s2">&quot;If always_value is true, first_value must be set&quot;</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">first_value:</span>
            <span class="s1">self._selected = first_value</span>
<span class="s3">##            first_value._press()</span>
            <span class="s3">#</span>
            <span class="s1">first_value.change_state(constants.STATE_PRESSED)</span>
            <span class="s1">first_value._hovered = </span><span class="s0">True</span>
            <span class="s1">sn = first_value.current_state_key</span>
            <span class="s0">if </span><span class="s1">sn </span><span class="s0">in </span><span class="s1">first_value._states_hover:</span>
                <span class="s1">first_value.current_state.fusionner.img = first_value._hover_imgs[sn]</span>
                <span class="s1">first_value._updates[sn].center = first_value.get_fus_center(sn)</span>
            <span class="s1">first_value._count += </span><span class="s4">1</span>
            <span class="s1">first_value.toggled = </span><span class="s0">True</span>
        <span class="s1">self.function = </span><span class="s0">None</span>

    <span class="s0">def </span><span class="s1">refresh(self</span><span class="s0">, </span><span class="s1">selected):</span>
        <span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">self.elements:</span>
            <span class="s0">if </span><span class="s1">e </span><span class="s0">is not </span><span class="s1">selected:</span>
                <span class="s0">if </span><span class="s1">e.current_state_key == constants.STATE_PRESSED:</span>
                    <span class="s1">e.active = </span><span class="s0">True</span>
                    <span class="s1">e._force_unpress()</span>
                    <span class="s1">e._hovered = </span><span class="s0">False</span>
                    <span class="s1">e._unhover()</span>
        <span class="s1">self._selected = selected</span>
        <span class="s0">if </span><span class="s1">self.always_value:</span>
            <span class="s1">self._selected.active = </span><span class="s0">False</span>
        <span class="s0">if </span><span class="s1">self.function:</span>
            <span class="s1">self.function()</span>

    <span class="s0">def </span><span class="s1">get_selected(self):</span>
        <span class="s0">if </span><span class="s1">self._selected:</span>
            <span class="s0">if </span><span class="s1">self._selected.current_state_key == constants.STATE_PRESSED:</span>
                <span class="s0">return </span><span class="s1">self._selected</span></pre>
</body>
</html>