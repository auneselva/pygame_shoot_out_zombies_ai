<html>
<head>
<title>launcher.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #808080;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
launcher.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;It is elements' responsibilities to handle event in order to call launch 
and unlaunch. However a default behaviour can be set using launch().&quot;&quot;&quot;</span>
<span class="s2">import </span><span class="s1">pygame</span>
<span class="s2">from </span><span class="s1">pygame </span><span class="s2">import </span><span class="s1">event</span>

<span class="s2">from </span><span class="s1">thorpy.miscgui </span><span class="s2">import </span><span class="s1">constants</span><span class="s2">, </span><span class="s1">functions</span><span class="s2">, </span><span class="s1">parameters</span>
<span class="s2">from </span><span class="s1">thorpy.miscgui.reaction </span><span class="s2">import </span><span class="s1">Reaction</span><span class="s2">, </span><span class="s1">ConstantReaction</span>
<span class="s2">from </span><span class="s1">thorpy.elements.box </span><span class="s2">import </span><span class="s1">Box</span>
<span class="s2">from </span><span class="s1">thorpy.elements._wrappers </span><span class="s2">import </span><span class="s1">make_button</span>
<span class="s2">from </span><span class="s1">thorpy.elements.ghost </span><span class="s2">import </span><span class="s1">Ghost</span>
<span class="s2">from </span><span class="s1">thorpy.elements.line </span><span class="s2">import </span><span class="s1">Line</span>
<span class="s2">from </span><span class="s1">thorpy.elements._wrappers </span><span class="s2">import </span><span class="s1">make_stored_ghost</span>
<span class="s2">from </span><span class="s1">thorpy.menus.tickedmenu </span><span class="s2">import </span><span class="s1">TickedMenu</span>

<span class="s1">DONE</span><span class="s2">, </span><span class="s1">CANCEL</span><span class="s2">, </span><span class="s1">CLICK_QUIT = constants.LAUNCH_DONE</span><span class="s2">, </span><span class="s1">constants.LAUNCH_CANCEL</span><span class="s2">, </span><span class="s1">constants.LAUNCH_CLICK_QUIT</span>

<span class="s2">def </span><span class="s1">func_click_quit(event</span><span class="s2">, </span><span class="s1">launcher</span><span class="s2">, </span><span class="s1">what):</span>
    <span class="s2">if not </span><span class="s1">launcher.launched.collide(event.pos):</span>
        <span class="s1">launcher.unlaunch(what)</span>

<span class="s2">def </span><span class="s1">get_launcher(launched</span><span class="s2">, </span><span class="s1">click_quit=</span><span class="s2">False, </span><span class="s1">launching=</span><span class="s2">None, </span><span class="s1">autocenter=</span><span class="s2">True</span><span class="s1">):</span>
    <span class="s0">&quot;&quot;&quot;Prepare and return a launcher object for launching &lt;launched&gt;.&quot;&quot;&quot;</span>
    <span class="s1">launcher = Launcher(launched</span><span class="s2">, </span><span class="s1">launching=launching)</span>
    <span class="s1">launcher.autocenter = autocenter</span>
    <span class="s1">reac_done = ConstantReaction(constants.THORPY_EVENT</span><span class="s2">,</span>
                         <span class="s1">launcher.unlaunch</span><span class="s2">,</span>
                         <span class="s1">{</span><span class="s3">&quot;id&quot;</span><span class="s1">: constants.EVENT_DONE</span><span class="s2">, </span><span class="s3">&quot;el&quot;</span><span class="s1">:launched}</span><span class="s2">,</span>
                         <span class="s1">{</span><span class="s3">&quot;what&quot;</span><span class="s1">: DONE}</span><span class="s2">,</span>
                         <span class="s1">reac_name=</span><span class="s3">&quot;reac_done&quot;</span><span class="s1">)</span>
    <span class="s1">reac_cancel = ConstantReaction(constants.THORPY_EVENT</span><span class="s2">,</span>
                         <span class="s1">launcher.unlaunch</span><span class="s2">,</span>
                         <span class="s1">{</span><span class="s3">&quot;id&quot;</span><span class="s1">: constants.EVENT_CANCEL</span><span class="s2">, </span><span class="s3">&quot;el&quot;</span><span class="s1">:launched}</span><span class="s2">,</span>
                         <span class="s1">{</span><span class="s3">&quot;what&quot;</span><span class="s1">: CANCEL}</span><span class="s2">,</span>
                         <span class="s1">reac_name=</span><span class="s3">&quot;reac_cancel&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">click_quit:</span>
        <span class="s1">reac_clickquit = Reaction(parameters.MOUSEBUTTONUP</span><span class="s2">,</span>
                                <span class="s1">func_click_quit</span><span class="s2">,</span>
                                <span class="s1">{</span><span class="s3">&quot;button&quot;</span><span class="s1">:parameters.LEFT_CLICK_BUTTON}</span><span class="s2">,</span>
                                <span class="s1">{</span><span class="s3">&quot;launcher&quot;</span><span class="s1">:launcher</span><span class="s2">, </span><span class="s3">&quot;what&quot;</span><span class="s1">:CLICK_QUIT}</span><span class="s2">,</span>
                                <span class="s1">reac_name=</span><span class="s3">&quot;reac_clickquit&quot;</span><span class="s1">)</span>
        <span class="s1">launched.add_reaction(reac_clickquit)</span>
    <span class="s1">launched.add_reaction(reac_done)</span>
    <span class="s1">launched.add_reaction(reac_cancel)</span>
    <span class="s2">return </span><span class="s1">launcher</span>

<span class="s2">def </span><span class="s1">launch(launched</span><span class="s2">, </span><span class="s1">click_quit=</span><span class="s2">False, </span><span class="s1">launching=</span><span class="s2">None, </span><span class="s1">autocenter=</span><span class="s2">True</span><span class="s1">):</span>
    <span class="s0">&quot;&quot;&quot;Launch &lt;launched&gt; on the current menu.&quot;&quot;&quot;</span>
    <span class="s1">launcher = get_launcher(launched</span><span class="s2">, </span><span class="s1">click_quit</span><span class="s2">, </span><span class="s1">launching</span><span class="s2">, </span><span class="s1">autocenter)</span>
    <span class="s1">launcher.launch()</span>
    <span class="s2">return </span><span class="s1">launcher</span>


<span class="s2">def </span><span class="s1">set_launcher(launching</span><span class="s2">, </span><span class="s1">launched</span><span class="s2">, </span><span class="s1">click_quit=</span><span class="s2">False</span><span class="s1">):</span>
    <span class="s0">&quot;&quot;&quot;Set &lt;launching&gt; as a launcher (on click) for element &lt;launched&gt;. 
    Return launcher object.&quot;&quot;&quot;</span>
    <span class="s1">launcher = Launcher(launched</span><span class="s2">, </span><span class="s1">launching=launching)</span>
    <span class="s1">reac_enter = ConstantReaction(constants.THORPY_EVENT</span><span class="s2">,</span>
                         <span class="s1">launcher.launch</span><span class="s2">,</span>
                         <span class="s1">{</span><span class="s3">&quot;id&quot;</span><span class="s1">: constants.EVENT_UNPRESS</span><span class="s2">, </span><span class="s3">&quot;el&quot;</span><span class="s1">:launching})</span>
    <span class="s1">reac_done = ConstantReaction(constants.THORPY_EVENT</span><span class="s2">,</span>
                         <span class="s1">launcher.unlaunch</span><span class="s2">,</span>
                         <span class="s1">{</span><span class="s3">&quot;id&quot;</span><span class="s1">: constants.EVENT_DONE</span><span class="s2">, </span><span class="s3">&quot;el&quot;</span><span class="s1">:launched}</span><span class="s2">,</span>
                         <span class="s1">{</span><span class="s3">&quot;what&quot;</span><span class="s1">: DONE})</span>
    <span class="s1">reac_cancel = ConstantReaction(constants.THORPY_EVENT</span><span class="s2">,</span>
                         <span class="s1">launcher.unlaunch</span><span class="s2">,</span>
                         <span class="s1">{</span><span class="s3">&quot;id&quot;</span><span class="s1">: constants.EVENT_CANCEL</span><span class="s2">, </span><span class="s3">&quot;el&quot;</span><span class="s1">:launched}</span><span class="s2">,</span>
                         <span class="s1">{</span><span class="s3">&quot;what&quot;</span><span class="s1">: CANCEL})</span>
    <span class="s2">if </span><span class="s1">click_quit:</span>
        <span class="s1">reac_clickquit = Reaction(parameters.MOUSEBUTTONUP</span><span class="s2">,</span>
                                <span class="s1">func_click_quit</span><span class="s2">,</span>
                                <span class="s1">params={</span><span class="s3">&quot;launcher&quot;</span><span class="s1">:launcher</span><span class="s2">, </span><span class="s3">&quot;what&quot;</span><span class="s1">:CLICK_QUIT})</span>
        <span class="s1">launched.add_reaction(reac_clickquit)</span>
<span class="s4">##    launcher.launching = launching</span>
    <span class="s1">launching.add_reaction(reac_enter)</span>
    <span class="s1">launched.add_reaction(reac_done)</span>
    <span class="s1">launched.add_reaction(reac_cancel)</span>
    <span class="s2">return </span><span class="s1">launcher</span>

<span class="s2">def </span><span class="s1">make_launcher(launched</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">click_quit=</span><span class="s2">False</span><span class="s1">):</span>
    <span class="s2">from </span><span class="s1">thorpy.elements._wrappers </span><span class="s2">import </span><span class="s1">make_button</span>
    <span class="s1">button = make_button(text)</span>
    <span class="s1">set_launcher(button</span><span class="s2">, </span><span class="s1">launched</span><span class="s2">, </span><span class="s1">click_quit)</span>
    <span class="s2">return </span><span class="s1">button</span>

<span class="s2">def </span><span class="s1">post_done(el):</span>
    <span class="s1">e = event.Event(constants.THORPY_EVENT</span><span class="s2">, </span><span class="s1">id=constants.EVENT_DONE</span><span class="s2">, </span><span class="s1">el=el)</span>
    <span class="s1">event.post(e)</span>

<span class="s2">def </span><span class="s1">post_cancel(el):</span>
    <span class="s1">e = event.Event(constants.THORPY_EVENT</span><span class="s2">, </span><span class="s1">id=constants.EVENT_CANCEL</span><span class="s2">, </span><span class="s1">el=el)</span>
    <span class="s1">event.post(e)</span>

<span class="s2">def </span><span class="s1">make_ok_box(elements</span><span class="s2">,</span><span class="s1">ok_text=</span><span class="s3">&quot;Ok&quot;</span><span class="s1">):</span>
    <span class="s1">ok = make_button(ok_text)</span>
    <span class="s1">ok.user_func = post_done</span>
    <span class="s1">linesize = max(e.get_fus_rect().w </span><span class="s2">for </span><span class="s1">e </span><span class="s2">in </span><span class="s1">elements+[ok])</span>
    <span class="s1">line = Line.make(linesize</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s1">)</span>
    <span class="s1">box = Box(elements=elements+[line</span><span class="s2">,</span><span class="s1">ok])</span>
    <span class="s1">box.finish()</span>
    <span class="s1">ok.user_params = {</span><span class="s3">&quot;el&quot;</span><span class="s1">:box}</span>
    <span class="s1">box.e_ok = ok</span>
    <span class="s1">print(box)</span>
    <span class="s2">return </span><span class="s1">box</span>

<span class="s2">def </span><span class="s1">set_as_done_button(button</span><span class="s2">, </span><span class="s1">element_to_unlaunch):</span>
    <span class="s1">button.user_func = post_done</span>
    <span class="s1">button.user_params = {</span><span class="s3">&quot;el&quot;</span><span class="s1">:element_to_unlaunch}</span>

<span class="s2">def </span><span class="s1">set_as_cancel_button(button</span><span class="s2">, </span><span class="s1">element_to_unlaunch):</span>
    <span class="s1">button.user_func = post_cancel</span>
    <span class="s1">button.user_params = {</span><span class="s3">&quot;el&quot;</span><span class="s1">:element_to_unlaunch}</span>

<span class="s2">def </span><span class="s1">make_ok_cancel_box(elements</span><span class="s2">, </span><span class="s1">ok_text=</span><span class="s3">&quot;Ok&quot;</span><span class="s2">, </span><span class="s1">cancel_text=</span><span class="s3">&quot;Cancel&quot;</span><span class="s1">):</span>
    <span class="s1">ok = make_button(ok_text)</span>
    <span class="s1">ok.user_func = post_done</span>
    <span class="s4">#</span>
    <span class="s1">cancel = make_button(cancel_text)</span>
    <span class="s1">cancel.user_func = post_cancel</span>
    <span class="s4">#</span>
<span class="s4">##    ghost = Ghost(elements=[ok, cancel])</span>
<span class="s4">##    ghost.finish()</span>
<span class="s4">##    thorpy.store(ghost, mode=&quot;h&quot;)</span>
<span class="s4">##    ghost.fit_children()</span>
    <span class="s1">ok_cancel = make_stored_ghost([ok</span><span class="s2">,</span><span class="s1">cancel])</span>
    <span class="s4">#</span>
    <span class="s1">linesize = max(e.get_family_rect().w </span><span class="s2">for </span><span class="s1">e </span><span class="s2">in </span><span class="s1">elements+[ok_cancel])</span>
    <span class="s1">line = Line.make(linesize</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s1">)</span>
    <span class="s4">#</span>
    <span class="s1">box = Box(elements=elements+[line</span><span class="s2">,</span><span class="s1">ok_cancel])</span>
    <span class="s1">ok.user_params = {</span><span class="s3">&quot;el&quot;</span><span class="s1">:box}</span>
    <span class="s1">cancel.user_params = {</span><span class="s3">&quot;el&quot;</span><span class="s1">:box}</span>
    <span class="s1">box.e_ok = ok</span>
    <span class="s1">box.e_cancel = cancel</span>
    <span class="s2">return </span><span class="s1">box</span>

<span class="s2">class </span><span class="s1">Launcher(object):</span>

    <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">, </span><span class="s1">launched</span><span class="s2">, </span><span class="s1">focus=</span><span class="s2">True, </span><span class="s1">exceptions=</span><span class="s2">None, </span><span class="s1">launching=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s1">self.launched = launched</span>
        <span class="s1">self.focus</span><span class="s2">, </span><span class="s1">self.exceptions = </span><span class="s2">None, None</span>
        <span class="s1">self.set_focus(focus</span><span class="s2">, </span><span class="s1">exceptions)</span>
        <span class="s1">self.func_before = </span><span class="s2">None</span>
        <span class="s1">self.func_after = </span><span class="s2">None</span>
        <span class="s1">self.active_record = {}</span>
        <span class="s1">self.launching = launching</span>
        <span class="s1">self.autocenter = </span><span class="s2">True</span>

    <span class="s2">def </span><span class="s1">set_focus(self</span><span class="s2">,</span><span class="s1">value</span><span class="s2">, </span><span class="s1">exceptions=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s1">self.focus = value</span>
        <span class="s1">self.exceptions=[] </span><span class="s2">if not </span><span class="s1">exceptions </span><span class="s2">else </span><span class="s1">exceptions</span>

    <span class="s2">def </span><span class="s1">add_to_current_menu(self):</span>
        <span class="s1">menu = functions.get_current_menu()</span>
        <span class="s1">menu.add_to_population(self.launched)</span>

    <span class="s2">def </span><span class="s1">remove_from_current_menu(self):</span>
        <span class="s1">menu = functions.get_current_menu()</span>
        <span class="s2">if </span><span class="s1">self.launched </span><span class="s2">in </span><span class="s1">menu.get_population():</span>
            <span class="s1">menu.remove_from_population(self.launched)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">functions.debug_msg(</span><span class="s3">&quot;The launched element of the launcher has been</span><span class="s2">\ 
            </span><span class="s3">removed from the current menu by another element!&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">save_active_records(self):</span>
        <span class="s1">self.active_record = {}</span>
        <span class="s1">menu = functions.get_current_menu()</span>
        <span class="s2">for </span><span class="s1">e </span><span class="s2">in </span><span class="s1">menu.get_population():</span>
            <span class="s1">self.active_record[e] = e.active</span>

    <span class="s2">def </span><span class="s1">restore_actives(self):</span>
        <span class="s2">for </span><span class="s1">e </span><span class="s2">in </span><span class="s1">self.active_record:</span>
            <span class="s1">e.active = self.active_record[e]</span>

    <span class="s2">def </span><span class="s1">activate_focus(self):</span>
        <span class="s1">self.save_active_records()</span>
        <span class="s2">if </span><span class="s1">self.focus:</span>
            <span class="s1">menu = functions.get_current_menu()</span>
            <span class="s2">for </span><span class="s1">e </span><span class="s2">in </span><span class="s1">menu.get_population():</span>
                <span class="s1">e.active = </span><span class="s2">False</span>
            <span class="s2">for </span><span class="s1">e </span><span class="s2">in </span><span class="s1">self.exceptions:</span>
                <span class="s1">e.active = </span><span class="s2">True</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">for </span><span class="s1">e </span><span class="s2">in </span><span class="s1">self.exceptions:</span>
                <span class="s1">e.active = </span><span class="s2">False</span>

    <span class="s2">def </span><span class="s1">unfocus(self):</span>
        <span class="s1">self.restore_actives()</span>
<span class="s4">##        if self.focus:</span>
<span class="s4">##            menu = functions.get_current_menu()</span>
<span class="s4">##            #! could activate elements that were not active before launcher.. this will occur when</span>
<span class="s4">##            # launchers are imbricated !!!!! must be changed</span>
<span class="s4">##            for e in menu.get_population():</span>
<span class="s4">##                e.active = True</span>
<span class="s4">##        else:</span>
<span class="s4">##            for e in self.exceptions:</span>
<span class="s4">##                e.active = True</span>

    <span class="s2">def </span><span class="s1">default_func_before(self):</span>
        <span class="s2">if </span><span class="s1">self.autocenter:</span>
            <span class="s1">self.launched.center()</span>
        <span class="s1">self.launched.blit()</span>
        <span class="s1">self.launched.update()</span>

    <span class="s2">def </span><span class="s1">prelaunch(self): </span><span class="s4">#handles func_before (unblittings, blittings, reactions deactivations)</span>
        <span class="s2">if </span><span class="s1">parameters.FILL_SCREEN_AT_SUBMENUS:</span>
            <span class="s1">functions.get_screen().fill(parameters.SCREEN_FILL)</span>
            <span class="s1">pygame.display.flip()</span>
        <span class="s2">if </span><span class="s1">self.func_before </span><span class="s2">is None</span><span class="s1">:</span>
            <span class="s1">self.default_func_before()</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">self.func_before()</span>
        <span class="s1">self.activate_focus()</span>

<span class="s4">##    def default_func_after(self):</span>
<span class="s4">##        self.launched.unblit()</span>
<span class="s4">##        a = functions.get_current_menu()._elements[0].get_oldest_ancester()</span>
<span class="s4">##        a.partial_blit(exception=None, rect=self.launched.get_fus_rect())</span>
<span class="s4">##        self.launched.update()</span>
<span class="s4">##        if self.launching:</span>
<span class="s4">##            aa = self.launching.get_oldest_ancester()</span>
<span class="s4">##            if aa:</span>
<span class="s4">##                aa.blit()</span>
<span class="s4">##                aa.update()</span>

    <span class="s2">def </span><span class="s1">default_func_after(self):</span>
        <span class="s1">r = self.launched.get_family_rect()</span>
<span class="s4">##        self.launched.unblit()</span>
        <span class="s1">a = functions.get_current_menu()._elements[</span><span class="s5">0</span><span class="s1">].get_oldest_ancester()</span>
        <span class="s1">a.partial_blit(exception=</span><span class="s2">None, </span><span class="s1">rect=r)</span>
<span class="s4">##        self.launched.update()</span>
        <span class="s2">import </span><span class="s1">pygame</span>
        <span class="s1">pygame.display.update(r)</span>
        <span class="s2">if </span><span class="s1">self.launching:</span>
            <span class="s1">aa = self.launching.get_oldest_ancester()</span>
            <span class="s2">if </span><span class="s1">aa:</span>
                <span class="s1">aa.blit()</span>
                <span class="s1">aa.update()</span>

    <span class="s2">def </span><span class="s1">postlaunch(self):</span>
        <span class="s1">self.unfocus()</span>
        <span class="s2">if </span><span class="s1">self.func_after </span><span class="s2">is None</span><span class="s1">:</span>
            <span class="s1">self.default_func_after()</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">self.func_after()</span>

    <span class="s2">def </span><span class="s1">launch(self):</span>
        <span class="s1">ev = event.Event(constants.THORPY_EVENT</span><span class="s2">, </span><span class="s1">id=constants.EVENT_LAUNCH</span><span class="s2">,</span>
                        <span class="s1">launcher=self)</span>
        <span class="s1">event.post(ev)</span>
        <span class="s1">self.prelaunch()</span>
        <span class="s1">self.add_to_current_menu()</span>

    <span class="s2">def </span><span class="s1">unlaunch(self</span><span class="s2">, </span><span class="s1">what=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s2">if </span><span class="s1">what </span><span class="s2">is None</span><span class="s1">:</span>
            <span class="s1">what = self.launched</span>
        <span class="s1">ev = event.Event(constants.THORPY_EVENT</span><span class="s2">, </span><span class="s1">id=constants.EVENT_UNLAUNCH</span><span class="s2">,</span>
                        <span class="s1">launcher=self</span><span class="s2">, </span><span class="s1">what=what)</span>
        <span class="s1">event.post(ev)</span>
<span class="s4">##        print(ev, &quot;posted&quot;)</span>
        <span class="s1">self.remove_from_current_menu()</span>
        <span class="s1">self.postlaunch()</span>


<span class="s2">def </span><span class="s1">launch_blocking(element</span><span class="s2">, </span><span class="s1">after=</span><span class="s2">None, </span><span class="s1">func=</span><span class="s2">None, </span><span class="s1">set_auto_ok=</span><span class="s2">True,</span>
                    <span class="s1">add_ok_enter=</span><span class="s2">None</span><span class="s1">):</span>
    <span class="s2">if </span><span class="s1">set_auto_ok:</span>
        <span class="s1">auto_ok(element)</span>
    <span class="s2">from </span><span class="s1">thorpy.elements.inserter </span><span class="s2">import </span><span class="s1">Inserter</span>
    <span class="s1">inserters = []</span>
    <span class="s2">if </span><span class="s1">add_ok_enter </span><span class="s2">is None</span><span class="s1">: </span><span class="s4">#auto detect</span>
        <span class="s1">add_ok_enter = </span><span class="s2">True</span>
        <span class="s2">for </span><span class="s1">e </span><span class="s2">in </span><span class="s1">[element]+list(element.get_descendants()):</span>
            <span class="s2">if </span><span class="s1">isinstance(e</span><span class="s2">, </span><span class="s1">Inserter):</span>
                <span class="s1">inserters.append(e)</span>
    <span class="s2">if </span><span class="s1">add_ok_enter:</span>
        <span class="s1">reac = ConstantReaction(pygame.KEYDOWN</span><span class="s2">, </span><span class="s1">emulate_ok_press</span><span class="s2">,</span>
                        <span class="s1">{</span><span class="s3">&quot;key&quot;</span><span class="s1">:pygame.K_RETURN}</span><span class="s2">, </span><span class="s1">{</span><span class="s3">&quot;element&quot;</span><span class="s1">:element</span><span class="s2">,</span>
                                                    <span class="s3">&quot;inserters&quot;</span><span class="s1">:inserters})</span>
        <span class="s1">element.add_reaction(reac)</span>
    <span class="s1">m = TickedMenu(element)</span>
    <span class="s1">m.play()</span>
    <span class="s2">if </span><span class="s1">add_ok_enter:</span>
        <span class="s1">element.remove_reaction(reac)</span>
    <span class="s2">if </span><span class="s1">after:</span>
        <span class="s1">after.unblit_and_reblit()</span>
    <span class="s2">if </span><span class="s1">func:</span>
        <span class="s1">func()</span>

<span class="s2">def </span><span class="s1">emulate_ok_press(element=</span><span class="s2">None, </span><span class="s1">inserters=</span><span class="s2">None</span><span class="s1">):</span>
    <span class="s2">if </span><span class="s1">inserters:</span>
        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">inserters:</span>
            <span class="s1">i.K_RETURN_pressed()</span>
    <span class="s1">e = event.Event(constants.THORPY_EVENT</span><span class="s2">, </span><span class="s1">id=constants.EVENT_DONE</span><span class="s2">, </span><span class="s1">el=element)</span>
    <span class="s1">event.post(e)</span>
    <span class="s1">functions.quit_menu_func()</span>

<span class="s2">def </span><span class="s1">auto_ok(element):</span>
    <span class="s2">if </span><span class="s1">hasattr(element</span><span class="s2">,</span><span class="s3">&quot;e_ok&quot;</span><span class="s1">):</span>
        <span class="s1">element.e_ok.user_func = emulate_ok_press</span>
        <span class="s1">element.e_ok.user_params = {</span><span class="s3">&quot;element&quot;</span><span class="s1">:element.e_ok}</span>

</pre>
</body>
</html>