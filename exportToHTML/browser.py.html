<html>
<head>
<title>browser.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
browser.py</font>
</center></td></tr></table>
<pre><span class="s0"># -*- coding: utf-8 -*-</span>
<span class="s2">import </span><span class="s1">os</span>

<span class="s2">import </span><span class="s1">pygame</span>

<span class="s2">from </span><span class="s1">thorpy.elements.browserlight </span><span class="s2">import </span><span class="s1">BrowserLight</span>
<span class="s2">from </span><span class="s1">thorpy.elements._explorerutils._pathelement </span><span class="s2">import </span><span class="s1">PathElement</span>
<span class="s2">from </span><span class="s1">thorpy.elements.element </span><span class="s2">import </span><span class="s1">Element</span>
<span class="s2">from </span><span class="s1">thorpy.elements.inserter </span><span class="s2">import </span><span class="s1">Inserter</span>
<span class="s2">from </span><span class="s1">thorpy.elements.ddlf </span><span class="s2">import </span><span class="s1">DropDownListFast</span>
<span class="s2">from </span><span class="s1">thorpy.elements.text </span><span class="s2">import </span><span class="s1">OneLineText</span>
<span class="s2">from </span><span class="s1">thorpy.miscgui.storage </span><span class="s2">import </span><span class="s1">Storer</span>
<span class="s2">from </span><span class="s1">thorpy.miscgui.reaction </span><span class="s2">import </span><span class="s1">Reaction</span>
<span class="s2">from </span><span class="s1">thorpy.miscgui </span><span class="s2">import </span><span class="s1">constants</span><span class="s2">, </span><span class="s1">functions</span><span class="s2">, </span><span class="s1">parameters</span><span class="s2">, </span><span class="s1">style</span><span class="s2">, </span><span class="s1">painterstyle</span>

<span class="s2">class </span><span class="s1">Browser(BrowserLight):</span>
    <span class="s3">&quot;&quot;&quot;File and folder browser.&quot;&quot;&quot;</span>

    <span class="s1">@staticmethod</span>
    <span class="s2">def </span><span class="s1">make(path=</span><span class="s4">&quot;./&quot;</span><span class="s2">, </span><span class="s1">ddl_size=</span><span class="s2">None, </span><span class="s1">folders=</span><span class="s2">True, </span><span class="s1">files=</span><span class="s2">True, </span><span class="s1">file_types=</span><span class="s2">None, </span><span class="s1">text=</span><span class="s4">&quot;&quot;</span><span class="s1">):</span>
        <span class="s1">browser = Browser(path</span><span class="s2">, </span><span class="s1">ddl_size</span><span class="s2">, </span><span class="s1">folders=folders</span><span class="s2">, </span><span class="s1">files=files</span><span class="s2">,</span>
                            <span class="s1">file_types=file_types</span><span class="s2">, </span><span class="s1">text=text</span><span class="s2">, </span><span class="s1">finish=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">browser.finish()</span>
        <span class="s2">return </span><span class="s1">browser</span>

    <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">,</span>
                 <span class="s1">path=</span><span class="s4">&quot;./&quot;</span><span class="s2">,</span>
                 <span class="s1">ddl_size=</span><span class="s2">None,</span>
                 <span class="s1">normal_params=</span><span class="s2">None,</span>
                 <span class="s1">folders=</span><span class="s2">True,</span>
                 <span class="s1">files=</span><span class="s2">True,</span>
                 <span class="s1">file_types=</span><span class="s2">None,</span>
                 <span class="s1">text=</span><span class="s4">&quot;&quot;</span><span class="s2">,</span>
                 <span class="s1">finish=</span><span class="s2">True</span><span class="s1">):</span>
        <span class="s3">&quot;&quot;&quot;File and folder browser for a. 
        &lt;path&gt;: the path of the folder in which browser browse files. 
        &lt;ddl_size&gt;: if not None, force the size of the dropdown list of files. 
        &lt;folders&gt;: if True, displays folders to user. 
        &lt;files&gt;: if True, displays file to user. 
        &lt;file_types&gt;: if not None, pass a list of files formats that you wand to 
            be valid for user choice. 
        &lt;text&gt;: title text of the browser. 
        &quot;&quot;&quot;</span>
        <span class="s1">ddl_size = style.BROWSERLIGHT_DDL_SIZE </span><span class="s2">if </span><span class="s1">ddl_size </span><span class="s2">is None else </span><span class="s1">ddl_size</span>
        <span class="s1">super(BrowserLight</span><span class="s2">, </span><span class="s1">self).__init__(normal_params=normal_params</span><span class="s2">,</span><span class="s1">finish=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">self.path = self.set_path(path)</span>
        <span class="s1">self.last_done_path = str(self.path)</span>
        <span class="s1">self._ddl_size = ddl_size</span>
        <span class="s1">self.file_types = file_types</span>
        <span class="s1">self.folders = folders</span>
        <span class="s1">self.files = files</span>
        <span class="s0"># DropDownListFast</span>
        <span class="s1">actual_folders</span><span class="s2">, </span><span class="s1">actual_files = self._get_folders_and_files()</span>
        <span class="s1">actual_files = self._filter_files(actual_files)</span>
        <span class="s2">if not </span><span class="s1">folders:</span>
            <span class="s1">actual_folders = </span><span class="s2">None</span>
        <span class="s2">if not </span><span class="s1">files:</span>
            <span class="s1">actual_files = []</span>
        <span class="s1">self._ddlf = DropDownListFast(size=self._ddl_size</span><span class="s2">, </span><span class="s1">titles=actual_files</span><span class="s2">,</span>
                                      <span class="s1">folders=actual_folders</span><span class="s2">, </span><span class="s1">has_lift=</span><span class="s2">True,</span>
                                      <span class="s1">finish=</span><span class="s2">False</span><span class="s1">)</span>
<span class="s0">##        self._ddlf.finish()</span>
        <span class="s0"># selection button</span>
        <span class="s1">inserter_width = </span><span class="s5">3</span><span class="s1">*ddl_size[</span><span class="s5">0</span><span class="s1">]//</span><span class="s5">4</span>
<span class="s0">##        if inserter_width &gt; style.MAX_INSERTER_WIDTH:</span>
<span class="s0">##            inserter_width = style.MAX_INSERTER_WIDTH</span>
        <span class="s1">self._selected = Inserter(</span><span class="s4">&quot;Selected : &quot;</span><span class="s2">, </span><span class="s1">size=(inserter_width</span><span class="s2">, None</span><span class="s1">))</span>
        <span class="s2">if </span><span class="s1">isinstance(text</span><span class="s2">, </span><span class="s1">str):</span>
            <span class="s1">self.text_element = OneLineText(text)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">self.text_element = text</span>
        <span class="s1">self._path_element = PathElement(father=self</span><span class="s2">, </span><span class="s1">abspath=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">self.add_elements([self.text_element</span><span class="s2">, </span><span class="s1">self._path_element</span><span class="s2">, </span><span class="s1">self._ddlf</span><span class="s2">,</span>
                           <span class="s1">self._selected])</span>
        <span class="s1">reac_pressed = Reaction(parameters.BUTTON_UNPRESS_EVENT</span><span class="s2">,</span>
                                <span class="s1">self._reaction_press</span><span class="s2">,</span>
                                <span class="s1">{</span><span class="s4">&quot;button&quot;</span><span class="s1">:</span><span class="s5">1</span><span class="s1">}</span><span class="s2">,</span>
                                <span class="s1">reac_name=constants.REAC_PRESSED)</span>
<span class="s0">##        self._ddlf._force_lift = True</span>
        <span class="s1">self._ddlf.finish()</span>
        <span class="s1">self.add_reaction(reac_pressed)</span>
        <span class="s1">self._clicked = </span><span class="s2">None</span>
        <span class="s1">self._something_selected = </span><span class="s2">False</span>
        <span class="s1">painter = functions.obtain_valid_painter(painterstyle.BOX_PAINTER</span><span class="s2">,</span>
                                                 <span class="s1">pressed=</span><span class="s2">True,</span>
                                                 <span class="s1">radius=style.BOX_RADIUS)</span>
        <span class="s1">self.set_painter(painter)</span>
        <span class="s1">self._last_click = -</span><span class="s5">2 </span><span class="s1">* parameters.DOUBLE_CLICK_DELAY</span>
        <span class="s2">if </span><span class="s1">finish:</span>
            <span class="s1">self.finish()</span>

    <span class="s2">def </span><span class="s1">finish(self):</span>
        <span class="s1">self._path_element._set_path_elements()</span>
        <span class="s1">Element.finish(self)</span>
        <span class="s1">self.store()</span>
        <span class="s1">centerx = self.get_fus_rect().centerx</span>
        <span class="s1">self.text_element.set_center((centerx</span><span class="s2">, None</span><span class="s1">))</span>
        <span class="s1">ycoord = self._path_element._elements[</span><span class="s5">0</span><span class="s1">].get_storer_rect().centery</span>
        <span class="s1">self._path_element._set_path_elements(ycoord)</span>
        <span class="s1">self.set_prison()</span>

    <span class="s2">def </span><span class="s1">set_path(self</span><span class="s2">, </span><span class="s1">path):</span>
        <span class="s1">path = os.path.normpath(path)</span>
        <span class="s2">if </span><span class="s1">path[-</span><span class="s5">1</span><span class="s1">] == os.path.sep:</span>
            <span class="s2">return </span><span class="s1">path</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s1">path + os.path.sep</span>

<span class="s0">##    def store(self):</span>
<span class="s0">####        r = self.get_family_rect()</span>
<span class="s0">####        self.set_size((r.width, r.height))</span>
<span class="s0">##        storer = Storer(self, margins=style.BROWSERLIGHT_STORE_MARGINS,</span>
<span class="s0">##                        gaps=style.BROWSERLIGHT_STORE_GAPS)</span>
<span class="s0">##        storer.autoset_framesize()</span>

<span class="s0">##    def _refresh_ddlf_lift(self):</span>
<span class="s0">##        if self._ddlf._lift:</span>
<span class="s0">##            functions.remove_element(self._ddlf._lift)</span>
<span class="s0">##        if self._ddlf.get_family_rect().height &gt; self._ddlf.get_fus_rect().height:</span>
<span class="s0">##            self._ddlf.add_lift()</span>
<span class="s0">##        functions.refresh_current_menu()</span>

    <span class="s2">def </span><span class="s1">_refresh_ddlf(self):</span>
        <span class="s1">self.path = self._path_element._path</span>
        <span class="s1">actual_folders</span><span class="s2">, </span><span class="s1">actual_files = self._get_folders_and_files()</span>
        <span class="s1">actual_files = self._filter_files(actual_files)</span>
        <span class="s2">if not </span><span class="s1">self.folders:</span>
            <span class="s1">actual_folders = </span><span class="s2">None</span>
        <span class="s2">if not </span><span class="s1">self.files:</span>
            <span class="s1">actual_files = []</span>
        <span class="s1">self._ddlf._dv = self._ddlf._get_dirviewer(titles=actual_files</span><span class="s2">,</span>
                                                   <span class="s1">size=self._ddl_size</span><span class="s2">,</span>
                                                   <span class="s1">folders=actual_folders)</span>
        <span class="s1">self._refresh_ddlf_lift()</span>

    <span class="s2">def </span><span class="s1">_go_to_dir(self</span><span class="s2">, </span><span class="s1">selected):</span>
        <span class="s1">self._path_element._path = selected</span>
        <span class="s1">self._path_element._path_list = self._path_element._get_strs()</span>
        <span class="s1">ycoord = self._path_element._elements[</span><span class="s5">0</span><span class="s1">].get_storer_rect().centery</span>
        <span class="s1">self._path_element._set_path_elements(ycoord)</span>
        <span class="s1">functions.refresh_current_menu()</span>
        <span class="s1">self._refresh_ddlf()</span>
        <span class="s1">self.unblit()</span>
        <span class="s1">self.blit()</span>
        <span class="s1">self.update()</span>

    <span class="s2">def </span><span class="s1">_reaction_press(self</span><span class="s2">, </span><span class="s1">event):</span>
        <span class="s1">hit_lift = </span><span class="s2">False</span>
        <span class="s2">if </span><span class="s1">self._ddlf._lift:</span>
            <span class="s2">if </span><span class="s1">self._ddlf._lift.get_fus_rect().collidepoint(event.pos):</span>
                <span class="s1">hit_lift = </span><span class="s2">True</span>
        <span class="s2">if not </span><span class="s1">hit_lift:</span>
            <span class="s1">BrowserLight._reaction_press(self</span><span class="s2">, </span><span class="s1">event)</span>
            <span class="s1">selected = self.get_value()</span>
            <span class="s1">tick = pygame.time.get_ticks()</span>
            <span class="s2">if </span><span class="s1">os.path.isdir(selected):</span>
                <span class="s2">if </span><span class="s1">tick - self._last_click &lt; parameters.DOUBLE_CLICK_DELAY:</span>
                    <span class="s1">self._go_to_dir(selected)</span>
            <span class="s1">self._last_click = tick</span></pre>
</body>
</html>